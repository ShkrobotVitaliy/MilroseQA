<apex:page standardcontroller="Proposal__c" extensions="ProposalWizardController" id="ProposalWizardPage" sidebar="false" showChat="false" title="Proposal Wizard">
  <apex:includeScript value="{!URLFOR($Resource.ProposalWizardResources, 'jquery-162.min.js')}" />
  <apex:includeScript value="{!URLFOR($Resource.ProposalWizardResources, 'jquery-ui-1816.min.js')}" />
  <apex:includeScript value="{!URLFOR($Resource.ProposalWizardResources, 'jquery-tablednd.js')}" />
  <apex:includeScript value="{!URLFOR($Resource.jqQueryTableSorter, 'jquery.tablesorter.min.js')}" /> <!-- MRS 7046 -->
  <script>function setFocusOnLoad() {}</script>

  <script type="text/javascript">
    var primaryCompanyText = ''; var billingCompanyText = ''; var accountingCompanyText = ''; var buildingText = ''; var internalReviewerText = ''; var addContactToRosterText = '';
    var currentTab = {!canShowAssignment} ? 'assignmentNotePanel' : 'proposalNotePanel';
    var currentStep;
    var changeOrderId = '';
    var virtualChangeOrderName = '';
    var activeChangeOrderId = '';
    var floorIdToRemove = '';
    var statusOfFloorVisibility = ''; // MRS 7109
    var reimbursableIdToRemove = '';
    var useDocusign = false;
    var emailType = '';

    // MRS 6915
    var extValue = '';
    var extId = '';
    var extIdxProposal = '';

	var originalServTemplateId; //MRS7335

    $(document).ready(function () {
      document.onkeypress = stopRKey;
      $('div.bPageFooter').hide();
      goToStep();
      disableInputsByStatus( {!proposal.Primary_Client_is_Billing_Client__c}, {!isAccountOrProjectOnHold} ); //MRS 6800
      poNotRequiredEditing( {!!proposal.PO_Required__c} );
      resizeFrame();
      displayTab(currentTab);
      $("#form").scroll(function() {
        $('.autoCompleteBoxScrolling').hide();
        $('#datePicker').hide();
      });
      if( {!activeChangeOrderId != null} ) {
        $('#accordionNotApproved table.generalTableStyle.header.{!activeChangeOrderId}').click();
      }
      if( getUrlParam( 'action' ) == 'Approve' && getUrlParam( 'co' ) != null ) {
        showOverlay( false );
        approveChangeOrder();
      }
      if( /*{!isAdmin}*/ true ) { // MRS 7280
        getViewState();
        setInterval( function() { getViewState(); }, 10000 );
      }
      $('#form').scrollTop( {!formPosition} );
      clearTemporaryInstructionsFields(); //MRS 6915
      recalculateCompleteness(); //MRS 7112
	  originalServTemplateId = $('[id$=serviceType]')[0].value; //MRS 7335
    });

    function clearTemporaryInstructionsFields() { //MRS 6915
      Visualforce.remoting.Manager.invokeAction( '{!$RemoteAction.ProposalWizardController.clearTemporaryInstructionsFields}', '{!proposal.Id}', function( result, event ) {
        if( event.status ) {
          return result;
        }
      }, { escape: true } );
    }

    function getUrlParam( name ) {
      name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
      var regexS = "[\\?&]"+name+"=([^&#]*)";
      var regex = new RegExp( regexS );
      var results = regex.exec( window.location.href );
      if( results == null )
        return null;
      else
        return results[1];
    }

    var counter = 0;
    function checkNewTasksExistance() {
      ProposalWizardController.checkNewTasksExistance( getUrlParam( 'co' ), function( result, event ) {
        if( event.status && counter <= 50 ) {
          if( !result ) {
            setTimeout( function() { counter++; checkNewTasksExistance(); }, 3000 ); return;
          } else {
            counter = 0;
            redirectBillingTriggers();
          }
        } else {
          addErrorMessageRedirectTriggers();
        }
      } );
    }

    function getFormPosition() {
      return Math.floor( $('#form').scrollTop() );
    }

    function initMunicipalAuthorityFeesNotesArea() {
      $('#municipalAuthorityFeesArea .multiSelectPicklistCell').mouseup(function(event) { //G300 MRS-6819
        if( event.target.id.indexOf('right_arrow') >= 0 && $('[id$=municipalAuthorityFees_unselected] option:selected').text().indexOf('Determined') >= 0 ){
          $('#projectedDOBFeeArea').show();
        } else if( event.target.id.indexOf('left_arrow') >= 0 && $('[id$=municipalAuthorityFees_selected] option:selected').text().indexOf('Determined') >= 0 ) {
          $('#projectedDOBFeeArea').hide();
          $('[id$=Projected_DOB_Fee__c] input').val('');
        }
      });
      $('[id$=municipalAuthorityFees_unselected]').unbind('dblclick').removeAttr('ondblclick');
      $('[id$=municipalAuthorityFees_selected]').unbind('dblclick').removeAttr('ondblclick');
      if($('[id$=municipalAuthorityFees_selected] option').text().indexOf('Determined') < 0){
        $('#projectedDOBFeeArea').hide();
      }
    }

    function initMunicipalAuthorityFeesNotesCOArea(){
      $('.municipalAuthorityFeesArea').each( function( i, elem ) {
        $(elem).find('.multiSelectPicklistCell').mouseup(function(event) {
          if( event.target.id.indexOf('right_arrow') >= 0 && $(elem).find('[id$=_unselected] option:selected').text().indexOf('Determined') >= 0 ){
            $(elem).find('.projectedDOBFeeArea').show();
          }else if( event.target.id.indexOf('left_arrow') >= 0 && $('[id$=_selected] option:selected').text().indexOf('Determined') >= 0 ){
            $(elem).find('.projectedDOBFeeArea').hide();
            $(elem).find('[id$=Projected_DOB_Fee__c] input').val('');
          }
        });

        $(elem).find('[id$=_unselected]').unbind('dblclick').removeAttr('ondblclick');
        $(elem).find('[id$=_selected]').unbind('dblclick').removeAttr('ondblclick');
        if($(elem).find('[id$=_selected] option').text().indexOf('Determined') < 0){
          $(elem).find('.projectedDOBFeeArea').hide();
        }

      });
    }

	var originalHideCanceledCO, originalHideCompletedSI, originalHideInactiveSI; //MRS 7357
	var switchToOptimalWasCanceled = false;
	function changeToOptimalMode() {
		$('[id$=proposalToOptimalViewArea').toggle();
		var viewState = $('#viewStatePercentage').text();
		viewState = viewState.substring(0, viewState.length - 1);
		var hideCanceledCO = $('[id$=optView_Hide_Canceled_Change_Orders__c]').attr('checked') == 'checked' ? true : false;
		var hideCompletedSI = $('[id$=optView_Hide_Completed_Services__c]').attr('checked') == 'checked' ? true : false;
		var hideInactiveSI = $('[id$=optView_Hide_Inactive_Services__c]').attr('checked') == 'checked' ? true : false;
		saveProposalAndSetOptViewMode(parseInt(viewState), hideCanceledCO, hideCompletedSI, hideInactiveSI, currentStep);
	}

	function cancelChangeToOptimalMode() {
		if(originalHideCanceledCO) {
			$('[id$=optView_Hide_Canceled_Change_Orders__c]').attr('checked', 'checked');
		} else {
			$('[id$=optView_Hide_Canceled_Change_Orders__c]').removeAttr('checked');
		}
		if(originalHideCompletedSI) {
			$('[id$=optView_Hide_Completed_Services__c]').attr('checked', 'checked');
		} else {
			$('[id$=optView_Hide_Completed_Services__c]').removeAttr('checked');
		}
		if(originalHideInactiveSI) {
			$('[id$=optView_Hide_Inactive_Services__c]').attr('checked', 'checked');
		} else {
			$('[id$=optView_Hide_Inactive_Services__c]').removeAttr('checked');
		}
		hideOverlayNoWheel();
		switchToOptimalWasCanceled = true;
		$('[id$=proposalToOptimalViewArea').toggle();
	}
	
	function saveValuesOptimalDialog() { //MRS 7356
		originalHideCanceledCO = $('[id$=editOptView_Hide_Canceled_Change_Orders__c]').attr('checked');
		originalHideCompletedSI = $('[id$=editOptView_Hide_Completed_Services__c]').attr('checked');
		originalHideInactiveSI = $('[id$=editOptView_Hide_Inactive_Services__c]').attr('checked');
	}

	function rollBackValuesOptimalDialog() {
		if(originalHideCanceledCO) {
			$('[id$=editOptView_Hide_Canceled_Change_Orders__c]').attr('checked', 'checked');
		} else {
			$('[id$=editOptView_Hide_Canceled_Change_Orders__c]').removeAttr('checked');
		}
		if(originalHideCompletedSI) {
			$('[id$=editOptView_Hide_Completed_Services__c]').attr('checked', 'checked');
		} else {
			$('[id$=editOptView_Hide_Completed_Services__c]').removeAttr('checked');
		}
		if(originalHideInactiveSI) {
			$('[id$=editOptView_Hide_Inactive_Services__c]').attr('checked', 'checked');
		} else {
			$('[id$=editOptView_Hide_Inactive_Services__c]').removeAttr('checked');
		}
	}

    function getViewState() {
      var vsminSize = 56.00;
      var vsMaxSize = 135.00;
      var vsElement = $('input#com\\.salesforce\\.visualforce\\.ViewState').val();
      var vsSize = ( vsElement == undefined ? 0 : vsElement.length / 1024 * 0.75 ).toFixed(2);
      var vsPercent = ( ( vsSize - vsminSize > 0 ? vsSize - vsminSize : 0 ) * 100 / ( vsMaxSize - vsminSize ) ).toFixed(0);
      $('span#viewState').text( vsSize + 'KB' );
      $('#viewStatePercentage').text( vsPercent +'%' );
      if( vsPercent <= 55 ) {
        $('#viewStatePercentage').css('background-color', '#40FF40');
      } else if( vsPercent >= 95 ) {
        $('#viewStatePercentage').css('background-color', '#FF4040');
      } else if( vsPercent <= 75 ) {
        $('#viewStatePercentage').css('background-color', 'rgb(' + ( ( vsPercent - 55 ) * 9.55 + 64 ).toFixed(0) + ', 255, 64)');
      } else {
        $('#viewStatePercentage').css('background-color', 'rgb(255, ' + ( ( 95 - vsPercent ) * 9.55 + 64 ).toFixed(0) + ', 64)');
      }

      if(vsPercent > '{!proposal.optView_Percents_Limit__c}' /*&& '{!proposal.optView_Percents_Limit__c}' > '{!proposal.Percents_View_State__c}'*/ && $('[id$=proposalToOptimalViewArea').css('display') == 'none' && $('#overlayContent').css('display') == 'none' && $('#transparentOverlay').css('display') == 'none' && !switchToOptimalWasCanceled) { // MRS 7280
        showOverlayNoWheel();
        $('#proposalToOptimalViewArea').toggle();
		originalHideCanceledCO = $('[id$=optView_Hide_Canceled_Change_Orders__c]').attr('checked') == 'checked' ? true : false;
		originalHideCompletedSI = $('[id$=optView_Hide_Completed_Services__c]').attr('checked') == 'checked' ? true : false;
		originalHideInactiveSI = $('[id$=optView_Hide_Inactive_Services__c]').attr('checked') == 'checked' ? true : false;
      }
    }

    function stopRKey(evt) {
      var evt = (evt) ? evt : ((event) ? event : null);
      var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null);
      if( ( evt.keyCode == 13 ) &&
        ( node.type == "text" || node.tagName == "INPUT" || node.tagName == "SELECT" || node.tagName == "OPTION" ) &&
        ( node.id != "phSearchInput" ) ) {
        return false;
      }
    }

    function attachDndToTables( table ) {
      $(table).tableDnD({ onDragClass: 'rowDnD', dragHandle: '.dragHandle' });
    }

    function calculateTableColspans( table ) {
      var fullSpan; var leftSpan;
      if( table == '.servicesTableJQ' || table == '.alternativeServicesJQ' ) {
        fullSpan = $(table + ' thead:first tr th').filter( function() { return filterVisibleForColspans(this) } ).length;
        leftSpan = $(table + ' thead:first tr th.totalServicePriceJQ').prevAll().filter( function() { return filterVisibleForColspans(this) } ).length;
      $(table + ' .fullTableColSpanJQ').attr('colspan', fullSpan );
      $(table + ' .footerLeftJQ').attr('colspan', leftSpan );
      var rightSpan = fullSpan - leftSpan - 1;
      if( rightSpan > 0 ) {
        $(table + ' .footerRightJQ').attr('colspan', rightSpan).show();
      } else {
        $(table + ' .footerRightJQ').hide();
      }
      } else {
        $(table).parent('div').each( function() {
          var fullSpan = $(this).find(table + ' thead:first tr th').filter( function() { return filterVisibleForColspans(this) } ).length;
          var leftSpan = $(this).find(table + ' thead:first tr th.totalServicePriceJQ').prevAll().filter( function() { return filterVisibleForColspans(this) } ).length;
          $(this).find('.fullTableColSpanJQ').attr('colspan', fullSpan );
          $(this).find('.footerLeftJQ').attr('colspan', leftSpan );
          var rightSpan = fullSpan - leftSpan - 1;
          if( rightSpan > 0 ) {
            $(this).find('.footerRightJQ').attr('colspan', rightSpan).show();
          } else {
            $(this).find('.footerRightJQ').hide();
          }
        } );
      }
    }

    function filterVisibleForColspans( item ) {
      var element = $( item );
      if( element.css('display') == 'none' ) {
        element.remove();
        return false;
      }
      return true;
    }

    function serializePhases() {
      var result = '';
      var tableRows = $('#phasesTable tr');
      for (var i=0; i < tableRows.length; i++) {
        if ( (tableRows[i].id).length > 0 ) {
          if( result.length > 0 ) result += '|';
          result += tableRows[i].id;
        }
      }
      return result;
    }

    function serializeServices() {
      var result = '';
      var tablesArray = ['.servicesTableJQ', '.changeOrdersTablesJQ', '.changeOrdersTablesCanceledJQ', '.alternativeServicesJQ'];
      var tableBody, tableRows;
      for( var tableIndex = 0; tableIndex < tablesArray.length; tableIndex++ ) {
        tableBody = $(tablesArray[tableIndex] + ' tbody');
        for( var tbodyIndex = 0; tbodyIndex < tableBody.length; tbodyIndex++ ) {
          if( (tableBody[tbodyIndex].id).length > 0 ) {
            result += tableBody[tbodyIndex].id + '{!changeOrderContent}';
            tableRows = $(tablesArray[tableIndex] + ' tbody#' + tableBody[tbodyIndex].id +  ' tr');
            for( var trIndex = 0; trIndex < tableRows.length; trIndex++ ) {
              if( (tableRows[trIndex].id).length > 0 ) {
                result += tableRows[trIndex].id;
                if( trIndex != tableRows.length - 1 ) result += '{!serviceItemSplitter}';
              }
            }
            if( result.lastIndexOf('{!serviceItemSplitter}') === result.length - 1 ) result = result.substr(0, result.length - 1);
            if( tbodyIndex != tableBody.length - 1 ) result += '{!changeOrderSplitter}';
          }
        }
      }
      return result;
    }

    function disableInputsByStatus( enableBillingCompany, accountingHold ) {
      // console.log('viewOnly: ' + {!viewOnly});
      // console.log('disableInputs: ' + {!disableInputs});
      // console.log('areContactButtonsEnabled: ' + {!areContactButtonsEnabled});
      // console.log('isChangeOrderAllowedOnProjectOrServiceItemLevel: ' + {!isChangeOrderAllowedOnProjectOrServiceItemLevel});
      // console.log('isThisUserCreator: ' + {!isThisUserCreator});
      // console.log('enableBillingPreferencesGroupTwo: ' + {!enableBillingPreferencesGroupTwo});
      // console.log('enableBillingCompany: ' + enableBillingCompany);
      if( {!isThisUserCreator} ) {
          $('#firstStepRosterTable select').addClass('specialDisableJQ');//this action occurred for Project Roster section on the first step if Proposal Creator User is logged on the wizard
      }
      if( {!disableInputs || viewOnly} ) {
        //$('.mainStyle').each(function(i, obj) {
          $('.mainStyle input').not('.specialDisableJQ').not(':submit').attr('disabled','disabled');
          $('.mainStyle input:submit').not('.specialDisableJQ').attr('disabled','disabled').removeClass('btn').addClass('btnDisabled');
          $('.mainStyle select').not('.specialDisableJQ').not('.codeZoningAnalystForCOJQ').not('.accountManagerJQ').attr('disabled','disabled');
          $('.mainStyle textarea').not('.specialDisableJQ').attr('disabled','disabled');
          $('.mainStyle a').not('.specialDisableJQ').not('.phasesCommandLinks').not('.multiSelectPicklistCell a').not('.sendReminderToRecipientDateFieldJQ span.dateFormat').contents().unwrap();
          $('.mainStyle span.dateFormat').not('.specialDisableJQ').not('.sendReminderToRecipientDateFieldJQ span.dateFormat').hide();
        //});
      }
      if( ( {!disableInputs} && {!!areContactButtonsEnabled} ) || {!viewOnly} ) {
        $('input.contactSpecialDisableJQ').attr('disabled','disabled');
        $('a.contactSpecialDisableJQ').hide(); //contents().unwrap();
      }
      if( enableBillingCompany != undefined ) {
        billingCompanyEnableEditing( enableBillingCompany );
      }
      if( {!(disableInputs && !enableBillingPreferences ) || viewOnly} ) {
        if( {!enableBillingPreferencesGroupTwo} ) {
          $('.billingGroupOneJQ'){!IF(hasBillingOccurredOnProject, '.not(".billingOccuredGroupTwoJQ")', '.not(".billingGroupTwoJQ")')}.not('input:submit').attr('disabled','disabled');
          $('input.billingGroupOneJQ:submit'){!IF(hasBillingOccurredOnProject, '.not(".billingOccuredGroupTwoJQ")', '.not(".billingGroupTwoJQ")')}.attr('disabled','disabled').removeClass('btn').addClass('btnDisabled');
        } else {
          $('.billingGroupOneJQ').not('input:submit').attr('disabled','disabled');
          $('input.billingGroupOneJQ:submit').attr('disabled','disabled').removeClass('btn').addClass('btnDisabled');
        }
      }
      if( {!(disableInputs && !enableAccountManager ) || viewOnly} ) {
        $('select.accountManagerJQ').attr('disabled','disabled');
      }
      if( {!disableGeneralProposalNotes} ) {
         $('[id$=generalProposalNotes]').attr('disabled','disabled');
      }
      if( {!!isClientProjectEnabled} ) {
        $('.mainStyle .clientProjectNumber').attr('disabled','disabled');
      }
      if( accountingHold ) { // MRS 6800
        $('.createNewCO').attr('disabled','disabled').removeClass('btn').addClass('btnDisabled');
        if({!!enableBillingPreferencesGroupTwo}) {
            $('.mainStyle input:submit.disableAccountingHold, .mainStyle input:button.disableAccountingHold').attr('disabled','disabled').removeClass('btn').addClass('btnDisabled');
            $('.mainStyle input.disableAccountingHold, .mainStyle div.disableAccountingHold input').not(':submit').not(':button').attr('disabled','disabled');
            $('.mainStyle select.disableAccountingHold').attr('disabled','disabled');
            $('.mainStyle textarea.disableAccountingHold').attr('disabled','disabled');
            $('.mainStyle a.disableAccountingHold, .mainStyle div.disableAccountingHold a').not('.multiSelectPicklistCell a').contents().unwrap();
            $('.mainStyle span.dateFormat.disableAccountingHold').hide();
        }
      }

    }

    function modifyOriginalApprovedCoEditability( enableOriginalApprovedCO, enableInternalCO ) {
      if( enableOriginalApprovedCO ) {
        $('tbody.originalChangeOrderJQ input.disabledByCo, tbody.approvedChangeOrderJQ input.disabledByCo').removeClass('disabledByCo').removeAttr('disabled');
        //MRS-6321 $('tbody.originalChangeOrderJQ, tbody.approvedChangeOrderJQ').parent().find('input[type=checkbox].disabledByCo').removeClass('disabledByCo').removeAttr('disabled');
        //$('tbody.originalChangeOrderJQ, tbody.approvedChangeOrderJQ').parent().find('input[type=checkbox].serviceCheckboxP.disabledByCo').removeClass('disabledByCo').removeAttr('disabled');
        $('tbody.originalChangeOrderJQ div.removeServiceButtonJQ, tbody.approvedChangeOrderJQ div.removeServiceButtonJQ').show();
      } else {
        $('tbody.originalChangeOrderJQ input[type=text]:enabled, tbody.approvedChangeOrderJQ input[type=text]:enabled').not('.receivedSignedCO').addClass('disabledByCo').attr('disabled', 'disabled');
        //MRS-6321 $('tbody.originalChangeOrderJQ, tbody.approvedChangeOrderJQ').parent().find( $('input[type=checkbox]:enabled') ).not('.receivedSignedCO').addClass('disabledByCo').removeAttr('checked').attr('disabled', 'disabled');
        serviceParentCheckboxActionJS( '.servicesTableJQ' );
        //$('tbody.originalChangeOrderJQ input[type=checkbox]:enabled, tbody.approvedChangeOrderJQ input[type=checkbox]:enabled').addClass('disabledByCo').removeAttr('checked').attr('disabled', 'disabled');
        //$('tbody.originalChangeOrderJQ, tbody.approvedChangeOrderJQ').parent().find('input[type=checkbox].serviceCheckboxP:enabled').prop('checked', false).addClass('disabledByCo').attr('disabled', 'disabled');
        $('tbody.originalChangeOrderJQ div.removeServiceButtonJQ, tbody.approvedChangeOrderJQ div.removeServiceButtonJQ').hide();
      }
      if( enableInternalCO ) {
        $('div#step1Block a.contactSpecialDisableJQ.disabledByCo').removeClass('disabledByCo').show(); //lookup buttons
        $('div#step1Block input.disabledByCo[type=button], div#step1Block input.disabledByCo[type=submit]').addClass('btn').removeClass('btnDisabled');
        $('div#step1Block .disabledByCo').removeClass('disabledByCo').removeAttr('disabled');
        $('div#step1Block .deleteFloorJQ, div#step1Block .deletePhaseJQ').show();
      } else {
        if( {!!isThisUserCreator} ) {
          $('div#step1Block a.contactSpecialDisableJQ').addClass('disabledByCo').hide(); //lookup buttons
          $('div#step1Block input.specialDisableJQ[type=button]:enabled, div#step1Block input.specialDisableJQ[type=submit]:enabled').not('.receivedSignedCO'){!IF(enableBillingPreferencesGroupTwo, '.not(".billingGroupTwoJQ")', '')}.addClass('btnDisabled').removeClass('btn');
          $('div#step1Block .specialDisableJQ:enabled').not('.additionalDocuments').not('.drawings').not('.accountManagerJQ').not('.receivedSignedCO').not('.projectTeamJQ'){!IF(enableBillingPreferencesGroupTwo, '.not(".billingGroupTwoJQ")', '')}{!IF(profileName == 'Accounting Supervisor', '.not(".displayTextOnInvoiceJQ")', '')}{!IF(profileName == 'Operations Manager' || profileName == 'Director of Operations', '.not(".fulfillmentOfficeJQ")', '')}.addClass('disabledByCo').attr('disabled', 'disabled');
          $('div#step1Block .deleteFloorJQ, div#step1Block .deletePhaseJQ').hide();
        }
      }
    }

    window.onresize = function() {
      resizeFrame();
    }
    function getHeightForResize() {
      return $(window).height() - 255 /* 145 without SF header */;
    }
    function getMessagesHeight() {
      var messagesHeight = $('[id$=\\:msgs] div').outerHeight();
      if( messagesHeight == null ) messagesHeight = 0;
      return messagesHeight;
    }
    function resizeFrame() {
      var height = getHeightForResize();
      var messagesHeight = getMessagesHeight();
      var totalHeight = height - messagesHeight;
      $("div#form").css("height", totalHeight+"px");
      $("div.rightPanelHolder").css("height", height+"px");
      if( $("div.rightInfoNoteFooterHolder").css("display") == "block" ) {
        $("div.rightInfoCurrentNoteHolder").css("height", height-67+"px");
      } else {
        $("div.rightInfoCurrentNoteHolder").css("height", height-47+"px");
      };

      $("iframe[id$=rightPanelFrame]").css("height", height-1+"px");
      resizeStep2Iframe();
    }
    function resizeStep2Iframe() {
      $('#step2Block iframe').css('height', getHeightForResize() - getMessagesHeight() );
    }

    function billingCompanyEnableEditing( value ) {
      if( $('#primaryCompanyDiv input[type=text]').attr('disabled') == 'disabled' ) {
        $('#billingCompanyDiv a').hide(); $('#billingCompanyDiv input[type=text]').attr('disabled','disabled');
      } else {
        if( value || {!(disableInputs && !areContactButtonsEnabled)} || {!viewOnly} ) {
          $('#billingCompanyDiv a').hide(); $('#billingCompanyDiv input[type=text]').attr('disabled','disabled');
        } else {
          $('#billingCompanyDiv a').show(); $('#billingCompanyDiv input[type=text]').removeAttr('disabled');
        }
      }
    }

    function poNotRequiredEditing( value ) { // MRS 7304
      if( value ) {
            $('[id$=PO_Not_Required__c]').attr('disabled','disabled');
        } else {
            $('[id$=PO_Not_Required__c]').removeAttr('disabled');
        }

    }

    function projectLocationEnableEditing(isAnyServiceItems) {
      if ( isAnyServiceItems ) {
        $('#buildingAddressFieldDiv a, #buildingAddressFieldDiv img').hide();
        $('#buildingAddressFieldDiv input').attr('disabled', true);
      } else {
        $('#buildingAddressFieldDiv a, #buildingAddressFieldDiv img').show();
        $('#buildingAddressFieldDiv input').removeAttr('disabled');
      }
    }

    function serviceParentCheckboxCheckJS( table ) {
      var checked = true;
      var hasAtLeastOneVisibleChild = false;
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' ) {
            hasAtLeastOneVisibleChild = true;
            if( checked && $(this).prop('checked') == false ) {
              checked = false;
            }
          }
        }
      );
      $(table).parent().find('.serviceCheckboxP').prop('checked', checked && hasAtLeastOneVisibleChild);
      enableMultipleActionsButton( table, '.movingServicesButton', false ); // MRS 6931
      enableMultipleActionsButton( table, '.moveServicesButton', false );
      enableMultipleActionsButton( table, '.deleteServicesButton', false );
      enableMultipleActionsButton( table, '.assignFloorsButton', false );
    }

    function serviceParentCheckboxActionJS( table ) {
      var parentTable = $(table).parent();
      $('.serviceCheckboxes, .serviceCheckboxP').not($(parentTable.find('.serviceCheckboxes'))).not($(parentTable.find('.serviceCheckboxP'))).prop('checked', false);
      var isParentCheckboxChecked = $(table).parent().find('.serviceCheckboxP').prop('checked');
      var hasAtLeastOneVisibleChild = false;
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' ) {
            hasAtLeastOneVisibleChild = true;
            $(this).prop('checked', isParentCheckboxChecked );
          }
        }
      );
      if( !hasAtLeastOneVisibleChild ) {
        $( table + ' .serviceCheckboxP' ).prop('checked', false);
      }
      enableMultipleActionsButton( table, '.movingServicesButton', true ); //MRS 6931
      enableMultipleActionsButton( table, '.moveServicesButton', true );
      enableMultipleActionsButton( table, '.deleteServicesButton', true );
      enableMultipleActionsButton( table, '.assignFloorsButton', true );
    }

    function serviceCheckboxActionJS( table ) {
      $('.serviceCheckboxes, .serviceCheckboxP').not(table + ' .serviceCheckboxes, ' + table + ' .serviceCheckboxP').prop('checked', false);
      var allChecked = true;
      var allUnchecked = true;
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' ) {
            var checkboxIsChecked = $(this).prop('checked') == true;
            allChecked = allChecked && checkboxIsChecked;
            allUnchecked = allUnchecked && !checkboxIsChecked;
          }
        }
      );
      $(table).parent().find('.serviceCheckboxP').prop('checked', allChecked).prop('indeterminate', !allChecked && !allUnchecked );
      enableMultipleActionsButton( table, '.movingServicesButton', true ); // MRS 6931
      enableMultipleActionsButton( table, '.moveServicesButton', true );
      enableMultipleActionsButton( table, '.deleteServicesButton', true );
      enableMultipleActionsButton( table, '.assignFloorsButton', true );
    }

    function enableMultipleActionsButton( table, buttonClass, uncheckOther ) {
      if( uncheckOther ) {
        $(buttonClass).not( $(table).parent().parent().find(buttonClass) ).attr('disabled', true).removeClass('btn').addClass('btnDisabled');
      }
      var disabled = true;
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( disabled && $(this).prop('checked') == true ) {
            disabled = false;
          }
        }
      )
      if( disabled ) {
        $(table).parent().parent().find(buttonClass).attr('disabled', true).removeClass('btn').addClass('btnDisabled');
      } else {
        $(table).parent().parent().find(buttonClass).removeAttr('disabled').removeClass('btnDisabled').addClass('btn');
      }
    }

    function assignServicesToFloors( table ) {
      var serviceIdsForAssignToFloors = '';
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' && $(this).prop('checked') == true ) {
            var parentRow = $(this).closest('tr');
            var editableFloorCell = $(parentRow).find( 'td.editableFloor' );
            if( $(editableFloorCell).length != 0 && $(editableFloorCell).eq(0).css('display') != 'none' ) {
              serviceIdsForAssignToFloors += $(parentRow).attr('recordid') + ';'
            }
          }
        }
      );
      serviceIdsForAssignToFloors = serviceIdsForAssignToFloors.replace(/;(\s+)?$/, '');
      if( serviceIdsForAssignToFloors != '' ) {
        prepareServiceJunctionsData( serviceIdsForAssignToFloors, serializeServices() );
      } else {
        showMessage('The selected services can not be assigned to Floors at this moment.');
      }
    }

    var isSingleServiceForPhase = true;
    var serviceIdsForMoveToPhase = '';
    function moveServicesToPhase( table, serviceId ) {
      isSingleServiceForPhase = true;
      serviceIdsForMoveToPhase = '';
      if( serviceId !== undefined && serviceId != null && serviceId != '' ) {
        isSingleServiceForPhase = true;
        serviceIdsForMoveToPhase = serviceId;
      } else {
        isSingleServiceForPhase = false;
        $(table + ' .serviceCheckboxes').each(
          function() {
            if( $(this).css('display') != 'none' && $(this).prop('checked') == true ) {
              var parentRow = $(this).closest('tr');
              var editablePhaseCell = $(parentRow).find( 'td.editablePhase' );
              if( $(editablePhaseCell).length != 0 && $(editablePhaseCell).eq(0).css('display') != 'none' ) {
                serviceIdsForMoveToPhase += $(parentRow).attr('recordid') + ';'
              }
            }
          }
        );
        serviceIdsForMoveToPhase = serviceIdsForMoveToPhase.replace(/;(\s+)?$/, '');
      }
      if( serviceIdsForMoveToPhase != '' ) {
        $('#moveServicesToPhasesPanelArea').show();
      } else {
        showMessage('The selected services can not be moved to another Phase at this moment.');
      }
    }

    function moveServiceBetweenTables( table ) { // MRS 6931
      var serviceIdsForMoving = '';
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' && $(this).prop('checked') == true ) {
            var parentRow = $(this).closest('tr');
            serviceIdsForMoving += $(parentRow).attr('recordid') + ';'
          }
        }
      );
      serviceIdsForMoving = serviceIdsForMoving.replace(/;(\s+)?$/, '');
      if( serviceIdsForMoving != '' ) {
        if ( table == '.alternativeServicesJQ')
          moveServicesBetweenTables( serviceIdsForMoving, 'MoveToServicesTable');
        else
          moveServicesBetweenTables( serviceIdsForMoving, 'MoveToAlternativeTable');
      } else {
        showMessage('The selected services can not be moved to Service Table at this moment.');
      }
    }

    // MRS 7056
    var table;
    function setSelectedReasonToSelectedServiceItems () {
      var serviceIdsForMoving = '';
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' && $(this).prop('checked') == true ) {
            var parentRow = $(this).closest('tr');
            serviceIdsForMoving += $(parentRow).attr('recordid') + ';'
          }
        }
      );
      serviceIdsForMoving = serviceIdsForMoving.replace(/;(\s+)?$/, '');
      if( serviceIdsForMoving != '' ) {
          setSelectedReasonToSelectedServicesItems( serviceIdsForMoving );
      } else {
        showMessage('None of services selected. Please, select desired services.');
      }
    }

    function deleteServices( table ) {
      var serviceIdsForDelete = '';
      $(table + ' .serviceCheckboxes').each(
        function() {
          if( $(this).css('display') != 'none' && $(this).prop('checked') == true ) {
            var parentRow = $(this).closest('tr');
            if( $(parentRow).find( '.removeServiceButtonJQ' ).eq(0).css( 'display' ) != 'none' &&
                $(parentRow).find( '.removeServiceButtonJQ .specialDisableJQ' ).eq(0).css( 'display' ) != 'none' ) {
              serviceIdsForDelete += $(parentRow).attr('recordid') + ';'
            }
          }
        }
      );
      serviceIdsForDelete = serviceIdsForDelete.replace(/;(\s+)?$/, '');
      if( serviceIdsForDelete != '' ) {
        deleteMultipleServicesAction( serviceIdsForDelete, activeChangeOrderId, serializeServices() );
      } else {
        showMessage('The selected services can not be deleted at this moment.');
      }
    }


    var floorNameToNumber = {"Attic":"ATT", "Balcony":"BAL", "Basement":"BAS", "Lobby":"LOB", "Open Space":"OSP",
                             "Roof":"ROF",  "Tower":"TOW",   "Façade":"FAÇ",   "Entire":"ENT"}; //MRS 7328

    function changeFloorNumberAndStatus() {
       $('#floorNumberInputCell input').val($('#floorNumberInputCell input').val().replace(/\.0$/g, ""));
        var value = floorNameToNumber[$('[id$=Floor_Type__c]')[0].value];
      if ( value ) {
            $('[id$=Floor_Number__c]')[0].value = value;
         $('#floorNumberInputCell input').attr('disabled','disabled');
      } else {
            $('[id$=Floor_Number__c]')[0].value = null;
         $('#floorNumberInputCell input').removeAttr('disabled');
      }
     }

    function changeTenantFloorNumberAndStatus() {
      $('#tenantNumberInputCell input').val($('#tenantNumberInputCell input').val().replace(/\.0$/g, ""));
        var value = floorNameToNumber[$('[id$=Tenant_Type__c]')[0].value];
      if (value) {
            $('[id$=Tenant_Number__c]')[0].value = value;
        $('#tenantNumberInputCell input').attr('disabled','disabled');
      } else {
            $('[id$=Tenant_Number__c]')[0].value = null;
         $('#tenantNumberInputCell input').removeAttr('disabled');
      }
    }

    function cancelAddingFloor() {
        $('[id$=floorsRightOutputPanel]').css('display', 'none');
        $('[id$=notesRightOutputPanel]').css('display', 'block');
        $('[id$=Floor_Type__c]')[0].value = '';
        $('[id$=Floor_Number__c]')[0].value = null;
        $('#floorNumberInputCell input').removeAttr('disabled');
        $('[id$=Tenant_Type__c]')[0].value = '';
        $('[id$=Tenant_Number__c]')[0].value = null;
        $('#tenantNumberInputCell input').removeAttr('disabled');
        $('[id$=floorsmsgs]').empty();
    }

    function showHideMultiplyPhaseArea() { // MRS 7330
        if($('[id$=isPhase__c]').prop('checked')) {
            $('[id$=listOfPhasesDiv').toggle();
            $('[id$=RowSeparate_Phases__c]').toggle();
        } else {
            $('[id$=phasesRightOutputPanel]').css('display', 'none');
            $('[id$=notesRightOutputPanel]').css('display', 'block');
            $('[id$=listOfPhasesDiv]').toggle();
            $('[id$=RowSeparate_Phases__c]').toggle();
            $('[id$=Separate_Phases__c]').removeAttr('checked');
        }
        disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});
    }

    function showAddNewPhaseAction() {
        $('[id$=notesRightOutputPanel]').css('display', 'none');
        $('[id$=phasesRightOutputPanel]').css('display', 'block');
        if($('[id$=phaseToCreateName__c]')[0].value.length > 0) {
            $('[id$=saveUpdatePhaseButton]').prop('value', 'Update');
            $('[id$=saveAndNewPhaseButton]').prop('style', 'display: none;');
        } else {
            $('[id$=saveUpdatePhaseButton]').prop('value', 'Save');
            $('[id$=saveAndNewPhaseButton]').prop('style', 'display: inline;');
        }
    }

    function cancelAddingPhaseAction() {
        $('[id$=phasesRightOutputPanel]').css('display', 'none');
        $('[id$=notesRightOutputPanel]').css('display', 'block');
        $('[id$=phaseToCreateName__c]')[0].value = null;
        $('[id$=phaseToCreateStart_Date__c]')[0].value = null;
        $('[id$=phaseToCreateEnd_Date__c]')[0].value = null;
        $('[id$=phasemsgs]').empty();
		cancelAddNewActionFunction(); // MRS 7385
    }

    DatePicker.prototype.position = function() {
      var datePicker = $('div.datePicker');
      var elementLeft = $(this.myElement).position().left;
      var elementTop = $(this.myElement).position().top;
      var elementHeight = $(this.myElement).outerHeight();
      var datePickerHeight = datePicker.outerHeight();
      /* var bottomFooterHeight = $('div.footerInnerPadding').outerHeight(); */
      var topHeaderHeight = $('#AppBodyHeader').outerHeight();
      var maxTop = $(window).height() - /*bottomFooterHeight -*/ topHeaderHeight - datePickerHeight - 15;
      if($(this.myElement).parents('.rightPanelHolder').length != 0 ){
        elementLeft += $('.rightPanelHolder').position().left;
        elementTop += $('.rightPanelHolder').position().top;
      } else if( $(this.myElement).parents('.changeOrderInternalReviewerPanel').length != 0 ) {
        elementLeft = $('.CO_Internal_Reviewer_Reminder__c').offset().left /*- $('.CO_Internal_Reviewer_Reminder__c').position().left*/;
        elementTop = $('.CO_Internal_Reviewer_Reminder__c').offset().top - $('.CO_Internal_Reviewer_Reminder__c').position().top - 4;
      }
      var datePickerTop = elementTop + elementHeight + 5;
      if( datePickerTop > maxTop ) datePickerTop = elementTop - datePickerHeight - 3;
      $('div.datePicker').css('top', datePickerTop);
      $('div.datePicker').css('left', elementLeft);
      $('div.datePicker').css('z-index', '10000'); // MRS 6860
    }

    AutoCompleteInputElement.prototype.getACYPosition = function(element) {
      if( $(element).parents('.changeOrderInternalReviewerPanel').length != 0 ) {
        return $(element).offset().top + $(element).outerHeight() + 1;
      } else {
        return $('#AppBodyHeader').outerHeight() + $(element).position().top + $(element).outerHeight() + 5;
      }
    };

    function displayTab( element ) {
      currentTab = element;
      $('.rightInfoNoteButtonsHolder').children('div').not('.'+element).removeClass('rightInfoNoteButtonsSelected');
      $('.rightInfoNoteButtonsHolder').children('div'+' .'+element).addClass('rightInfoNoteButtonsSelected');
      $('.rightInfoPanelNote').children('div').not('.'+element).hide();
      $('.rightInfoPanelNote').children('div'+' .'+element).show();
    }

    function disableCategoryAndType( condition ) {
      if( condition ) {
        $('.categoryInput select').attr('disabled','disabled');
        $('.typeInput select').attr('disabled','disabled');
      }
    }

    function goToStep(number) {
      if( number == null ) { currentStep = {!proposal.Step__c}; } else { currentStep = number; }
      if( currentStep == 1 ) {
        $('#step1Block').show(); $('#step2Block').hide(); $('#step3Block').hide(); $('#step4Block').hide();
        $('.step1Normal').hide(); $('.step1Blue').show(); $('.step2Normal').show(); $('.step2Blue').hide();
        $('.step3Normal').show(); $('.step3Blue').hide(); $('.step4Normal').show(); $('.step4Blue').hide();
        $('#submitButton').hide();
        goToStep1();
      }
      if( currentStep == 2 ) {
        $('#step1Block').hide(); $('#step2Block').show(); $('#step3Block').hide(); $('#step4Block').hide();
        $('.step1Normal').show(); $('.step1Blue').hide(); $('.step2Normal').hide(); $('.step2Blue').show();
        $('.step3Normal').show(); $('.step3Blue').hide(); $('.step4Normal').show(); $('.step4Blue').hide();
        if( {!isSubmitButtonVisible && !isMi3} ) { $('#submitButton').css('display', 'inline-block'); }
        goToStep2();
      }
      if( currentStep == 3 ) {
        $('#step1Block').hide(); $('#step2Block').hide(); $('#step3Block').show(); $('#step4Block').hide();
        $('.step1Normal').show(); $('.step1Blue').hide(); $('.step2Normal').show(); $('.step2Blue').hide();
        $('.step3Normal').hide(); $('.step3Blue').show(); $('.step4Normal').show(); $('.step4Blue').hide();
        $('#submitButton').hide();
        goToStep3();
        calculateTableColspans( '.servicesTableJQ' );
        calculateTableColspans( '.changeOrdersTablesJQ' );
        calculateTableColspans( '.changeOrdersTablesCanceledJQ' );
      }
      if( currentStep == 4 ) {
        $('#step1Block').hide(); $('#step2Block').hide(); $('#step3Block').hide(); $('#step4Block').show();
        $('.step1Normal').show(); $('.step1Blue').hide(); $('.step2Normal').show(); $('.step2Blue').hide();
        $('.step3Normal').show(); $('.step3Blue').hide(); $('.step4Normal').hide(); $('.step4Blue').show();
        $('#submitButton').hide();
        goToStep4();
      }
    }

    function cleanUpPurchaseServises(){
      $('#purchaseOrderServicesTableJQ input').prop('checked', false);
    }

    function disablePlanSubmissionTypeInput( status ) {
        $('.serviceRegionInput select').attr('disabled','disabled');
      if( status ) {
        $('.planSubmissionTypeInput select').attr('disabled','disabled');
      } else {
        $('.planSubmissionTypeInput select').removeAttr('disabled');
      }
    }

    var typeDelay = function() {
      var timer = 0;
      return function(delay) {
        clearTimeout( timer );
        timer = setTimeout( "searchForServiceTemplates();", delay );
      }
    }();

    function showFloorsPanel( selectedServiceFloorIds, partialServiceFloorIds ) {
      $('#selectFloorsForServices tr').removeClass('floorSelected');
      $('#selectFloorsForServices tr').removeClass('floorPartial');
      if( selectedServiceFloorIds.length ) {
        var selectedFloorIdsList = selectedServiceFloorIds.split(";");
        for( floorIndex in selectedFloorIdsList ) $('#selectFloorsForServices tr#' + selectedFloorIdsList[floorIndex]).addClass('floorSelected');
      }
      if( partialServiceFloorIds.length ) {
        var partialFloorIdsList = partialServiceFloorIds.split(";");
        for( floorIndex in partialFloorIdsList ) $('#selectFloorsForServices tr#' + partialFloorIdsList[floorIndex]).addClass('floorPartial');
      }
      $('#selectFloorsForServicesArea').show();
    }

    function showMessage( text ) {
      if( text && text != '' ) {
        $('#generalMessageText').append( text );
        $('#generalMessagePanel').show();
      }
    }

    function selectFloorsForServices() {
      var selectedServiceFloorIds = '';
      var partialServiceFloorIds = '';
      $.each( $('#selectFloorsForServices tr.floorSelected'), function() { selectedServiceFloorIds += this.id + ';' } );
      selectedServiceFloorIds = selectedServiceFloorIds.replace(/;(\s+)?$/, '');
      $.each( $('#selectFloorsForServices tr.floorPartial'), function() { partialServiceFloorIds += this.id + ';' } );
      partialServiceFloorIds = partialServiceFloorIds.replace(/;(\s+)?$/, '');
      $('#selectFloorsForServicesArea').hide();
      manageServiceFloorJunctions( selectedServiceFloorIds, partialServiceFloorIds );
    }

    function showOverlay( skipAnim ) {
      if( skipAnim == undefined || skipAnim == false ) {
        $('#overlayContent').show().fadeTo('slow', 1.0);
        $('#transparentOverlay').show().fadeTo('slow', 0.7);
      } else {
        $('#overlayContent').show().css({ 'opacity': '1.0', 'filter': 'alpha(opacity=100)' });
        $('#transparentOverlay').show().css({ 'opacity': '0.7', 'filter': 'alpha(opacity=70)' });
      }
    }
    function hideOverlay() {
      $('#transparentOverlay').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
      $('#overlayContent').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
      resizeFrame();
    }

	function showOverlayNoWheel() { //MRS 7335
        $('#transparentOverlay').show().fadeTo('slow', 0.7);
	}

	function hideOverlayNoWheel() {
        $('#transparentOverlay').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
		resizeFrame();
	}

    function showRightOverlay() {
      //$('#rightOverlayContent').show().fadeTo('slow', 1.0);
      //$('#transparentRightOverlay').css('top', $('#transparentRightOverlay').parent().scrollTop()).show().fadeTo('slow', 0.7);
      showOverlay();
    }
    function hideRightOverlay() {
      //$('#transparentRightOverlay').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
      //$('#rightOverlayContent').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
      hideOverlay();
    }

    function changeRightPanelToNotes() {
      showRightOverlay();
      changeRightPanelToNotesAction();
    }

    function hideErrorMessages() {
      var errorPanel = $('div.message.errorM3[role=alert]').parent();
      var hideStrings = '{!hideErrorCodes}'.split(' ');
      errorPanel.find('li:visible').each( function() {
        for( var i = 0; i < hideStrings.length; i++ ) {
          if( $( this ).text().indexOf( hideStrings[i] ) > -1 ) {
            $( this ).hide();
            continue;
          }
        }
      });
      if( errorPanel.find('li:visible').length == 0 ) {
        errorPanel.hide();
      }
    }

    function previewPdf( serviceIdsItem, phaseIdsItem ) {
      if( {!isSaveButtonVisible && !(viewOnly || (proposal.is_Change_Order__c && !isMaxCompleteness ))} ) {
        saveProposalAndCreatePdf( serviceIdsItem, phaseIdsItem, currentStep, true, getFormPosition() );
      } else if( {!isSaveDraftButtonVisible && !viewOnly} ) {
        saveDraftAndCreatePdf( serviceIdsItem, phaseIdsItem, currentStep, false, getFormPosition() );
      } else {
        saveProposalIfNotExists();
      }
    }

    function showPdf( proposalId, sendProposal ) {
      var targetUrl = "/apex/" + ( sendProposal ? 'proposal' : 'changeorder' ) + "?p=" + proposalId;
      if( !sendProposal ) {
        targetUrl += "&co=" + activeChangeOrderId;
        targetUrl += "&light=" + activeChangeOrderId;
      }
      var win = window.open( targetUrl, "_blank", "width=800" );
      win.focus();
    }

    function disableSubmitCOReviewer( status ) {
      if( status ) {
        $('.submitCOReviewerButton').attr('disabled', true).removeClass('btn').addClass('btnDisabled');
      } else {
        $('.submitCOReviewerButton').removeAttr('disabled').removeClass('btnDisabled').addClass('btn');
      }
    }

    function showConfirmSendToClientCOPanel( emailTypeIn, changeOrderIdIn, disableFollowUpsIn ) {
      emailType = emailTypeIn;
      changeOrderId = changeOrderIdIn;
      $('#confirmSendToClientCOPanelArea').show();
      if( emailType == '' ) {
        $('#automaticFollowUpWrapper').show();
      } else {
        $('#automaticFollowUpWrapper').hide();
      }
      if( emailType != 'Email (Follow Up)' ) {
        $('#changeOrderDocTypeWrapper').show();
      } else {
        $('#changeOrderDocTypeWrapper').hide();
      }
      $('#automaticFollowUp').prop( 'checked', disableFollowUpsIn );
      $('#changeOrderLightDocType').attr( 'checked', true );
    }

    function blockStep2() {
      $('#step2TransparentOverlay').show();
      $('#step2OverlayContent').show();
    }

    function unblockStep2() {
      $('#step2TransparentOverlay').hide();
      $('#step2OverlayContent').hide();
    }

    function modifySendReminderToRecipientEditability( useDocusignIn ) {
      if( useDocusignIn ) {
        $( '.signerColumnHeader' ).html('S');
        $( '.approverColumn' ).show();
      } else {
        $( '.signerColumnHeader' ).html('To');
        $( '.approverColumnData input[type=checkbox]' ).removeAttr('checked');
        $( '.approverColumn' ).hide();
      }
      if( useDocusignIn ) {
        $('.sendReminderToRecipientDateFieldJQ span.dateInput input.inputDateField').addClass('docusignDisabled').attr('disabled', 'disabled').val('');
        $('.sendReminderToRecipientDateFieldJQ span.dateFormat').hide();
      } else {
        $('.sendReminderToRecipientDateFieldJQ span.dateInput input.inputDateField').removeClass('docusignDisabled').removeAttr('disabled');
        $('.sendReminderToRecipientDateFieldJQ span.dateFormat').show();
      }
    }

    function hasPageErrorPOAddModifyWindow() {   // MRS-6860
      if($('[id$="purchaseOrderMessagesJQ"]')[0].innerHTML.length > 0) return true;
      return false;
    }

    function disableSendToClientIfESignAndNoSigners() { // MRS 7180
        var sendingAvaliable = true;
        if($('[id$=UseDocusign__c]').attr('checked') == 'checked') {
            sendingAvaliable = false;
            $('.signerColumnData input[type=checkbox]').each(function (index, value) {
                if($(value).attr('checked') == 'checked') sendingAvaliable = true;
            });
        }
        if(sendingAvaliable) {
            $('[id$=sendToClientProposal]').removeAttr('disabled').addClass('btn').removeClass('btnDisabled');
            $('[id$=sendToClientCO]').removeAttr('disabled').addClass('btn').removeClass('btnDisabled');
			$('[id$=sendToClientProposal]').attr("onclick", "showOverlay(); emailType = ''; sendToClientAndSaveRowPositions( 'Pending Client Approval', serializeServices(), serializePhases(), emailType, true, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;"); // MRS 7394
        } else {
            $('[id$=sendToClientProposal]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
            $('[id$=sendToClientCO]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
        }
    }

    function handlePurchaseOrderCheckboxes( checkboxThatChanges ) {
      var sizeOfServicesListPercents = 92; //MRS 6860
      if(hasPageErrorPOAddModifyWindow()) sizeOfServicesListPercents -= 10; //MRS 6860

      var color  ="#000000";
      $('#purchaseOrderAmountIsEmptyMessageJQ').hide();
      $('#purchaseOrderAmountExceededMessageJQ').hide();
      $('#purchaseOrderReimbursableNotZeroIfPONotRequiredMessageJQ').hide();
      $('#purchaseOrderAmountNotEqualsServicesAndReimbusebles').hide(); //MRS 7192
      $('#totalServicesMoreThanPOServices').hide();
      $('#totalReimbursablesMoreThanPOReimbursables').hide();
      $('#purchaseOrderTotalMunicipalFeesIsMoreThanBilledMulicipalFees').hide();//MRS-7297
      $('#purchaseOrderTotalServicePriceJQ').html('0.00').css('color', color);
      $('[id$=btnSavePurchaseOrderJQ]').removeAttr('disabled').addClass('btn').removeClass('btnDisabled');
      $('[id$=btnSaveAndNewPurchaseOrderJQ]').removeAttr('disabled').addClass('btn').removeClass('btnDisabled');
      var total = 0.00;
	  var isExcludeTaxes = $('[id$=PO_Excludes_Sales_Tax__c]')[0].checked; //MRS 6205
      $('#purchaseOrderServicesTableJQ tr:visible').not('#purchaseOrderServicesTableHeaderJQ').each( function( index, value ) {
        if( $(value).find('input[type=checkbox]')[0].checked ) {
            total += isExcludeTaxes ? +$(value).find('.purchaseOrderServicePriceJQ')[0].innerHTML : +$(value).find('.purchaseOrderServicePriceJQ')[0].innerHTML + +$(value).find('.purchaseOrderServicePriceTaxJQ')[0].innerHTML;
        }
      });
	
      var poAmount = Number($('[id$=purchaseOrderAmountJQ]' )[0].value.replace(',', ''));
      var poServicesBillingAmount = Number($('[id$=purchaseOrderServiceBillingJQ]')[0].value.replace(',', ''));
      var poServicesAmount = Number($('[id$=purchaseOrderServicesJQ]')[0].value.replace(',', ''));
      var poMunicipalFeesAmount = Number($('[id$=purchaseOrderMunicipalFeesJQ]')[0].value.replace(',', ''));
      var poMunicipalFeesAmountBilled = Number($('[id$=purchaseOrderMunicipalFeesBillingJQ]')[0].value.replace(',', ''));
      var biggerTotal = total > poServicesBillingAmount ? total : poServicesBillingAmount;
      var poReimbursableAmount = Number($('[id$=purchaseOrderReimbursablesJQ]')[0].value.replace(',', ''));
      var totalReimbursables = Number($('[id$=purchaseOrderReimbursablesOriginalJQ]')[0].value.replace(',', ''))
                             + Number($('[id$=purchaseOrderProcessingFeeOriginalJQ]')[0].value.replace(',', ''));
      if( poServicesAmount > 0 || poReimbursableAmount > 0 || poMunicipalFeesAmount > 0 ) {
        if( $('[id$=purchaseOrderServicesJQ]')[0].value == '' ) $('[id$=purchaseOrderServicesJQ]')[0].value = 0.00;
        if( $('[id$=purchaseOrderMunicipalFeesJQ]')[0].value == '' ) $('[id$=purchaseOrderMunicipalFeesJQ]')[0].value = 0.00;
        if( $('[id$=purchaseOrderReimbursablesJQ]')[0].value == '' ) $('[id$=purchaseOrderReimbursablesJQ]')[0].value = 0.00;
      }
      if( poServicesAmount == 0 && poReimbursableAmount == 0 && poMunicipalFeesAmount == 0 ) {
        $('[id$=purchaseOrderServicesJQ]')[0].value = null;
        $('[id$=purchaseOrderMunicipalFeesJQ]')[0].value = null;
        $('[id$=purchaseOrderReimbursablesJQ]')[0].value = null;
      }
	  if( ( poAmount == '' || isNaN( poAmount ) || +poAmount < 0 ) && total > 0 ) {
        $('#purchaseOrderAmountIsEmptyMessageJQ').show();
        sizeOfServicesListPercents -= 10; //MRS 6860
      } else if( total > +poAmount ) {
        color="#FF0000";
        $('#purchaseOrderAmountExceededMessageJQ').show();
        sizeOfServicesListPercents -= 10; //MRS 6860
      }else if( (poReimbursableAmount > 0 || poMunicipalFeesAmount > 0) && ($('[id$=PO_Not_Required__c]').attr('checked') == 'checked') ){
        sizeOfServicesListPercents -= 10;
        $('#purchaseOrderReimbursableNotZeroIfPONotRequiredMessageJQ').show();
        $('[id$=btnSavePurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn'); // MRS 7306
        $('[id$=btnSaveAndNewPurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
      }else if((poServicesAmount > 0 || poReimbursableAmount > 0 || poMunicipalFeesAmount > 0) && ((poServicesAmount + poReimbursableAmount + poMunicipalFeesAmount).toFixed(2)) != poAmount) { //MRS 7331
        sizeOfServicesListPercents -= 10;
        $('#purchaseOrderAmountNotEqualsServicesAndReimbusebles').show();
        $('[id$=btnSavePurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
        $('[id$=btnSaveAndNewPurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
      }else if((poServicesAmount > 0 || poReimbursableAmount > 0 || poMunicipalFeesAmount > 0)) {
            if(biggerTotal > poServicesAmount) {
                sizeOfServicesListPercents -= 10;
                $('#totalServicesMoreThanPOServices').show();
                $('[id$=btnSavePurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
                $('[id$=btnSaveAndNewPurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
            }
            if(poMunicipalFeesAmountBilled > poMunicipalFeesAmount) {
                sizeOfServicesListPercents -= 10;
                $('#purchaseOrderTotalMunicipalFeesIsMoreThanBilledMulicipalFees').show();
                $('[id$=btnSavePurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
                $('[id$=btnSaveAndNewPurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
            }
            if(totalReimbursables > poReimbursableAmount) {
                sizeOfServicesListPercents -= 10;
                $('#totalReimbursablesMoreThanPOReimbursables').show();
                $('[id$=btnSavePurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
                $('[id$=btnSaveAndNewPurchaseOrderJQ]').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn');
            }
      }
      $('#purchaseOrderTotalServicePriceJQ').html( total.toFixed(2) ).css('color', color);
      $('#listOfPOServicesAddModifyJQ').attr('style', 'height: ' + sizeOfServicesListPercents + '%'); //MRS 6860
    }

    function saveGeneralChangeOrderNotes( changeOrderId, notesValue ) {
      showOverlay();
      Visualforce.remoting.Manager.invokeAction( '{!$RemoteAction.ProposalWizardController.saveGeneralChangeOrderNotes}', changeOrderId, notesValue, function( result, event ) {
        hideOverlay();
        if( event.status ) {
          return result;
        } else {
          alert( 'Error updating Change Order Notes.' );
        }
      }, { escape: true } );
    }

    // MRS-6915
    function getPrimCInstr() { return $('[id$=primaryCInstructions]').attr("value"); }
    function getBillCInstr() { return $('[id$=billingCInstructions]').attr("value"); }
    function getAccCInstr() { return $('[id$=accountingCInstructions]').attr("value"); }
    function getBuildInstr() { return $('[id$=buildingInstructions]').attr("value"); }
    function getBillInstr() { return $('[id$=billingInstructions]').attr("value"); }

    function checkAndUpdateInstructions(obj, id, value) { // MRS-6915
      var idx = '{!proposal.Id}';
      extIdxProposal = idx;
      extValue = value;
      extId = id;
      showOverlay();
      if (!idx || 0 === idx.length) {
        saveProposalIfNotExistsForInstr();
      } else {
        instructionSaving();
      }
    }

    function instructionSaving() { // MRS-6915
      var primCompIdx = $('[id$=Primary_Company_Name__c_lkid').attr('value');
      var billCompIdx = $('[id$=Billing_Company_Name__c_lkid').attr('value');
      var acctCompIdx = $('[id$=Accounting_Contact_Company__c_lkid').attr('value');
      var buildingIdx = $('[id$=Address__c_lkid').attr('value');
      console.log('extIdxProposal = ' + extIdxProposal);
      console.log('extId = ' + extId);
      console.log('extValue = ' + extValue);
      Visualforce.remoting.Manager.invokeAction( '{!$RemoteAction.ProposalWizardController.checkAndUpdateInstructions}',
          extIdxProposal, extId, extValue, primCompIdx, billCompIdx, acctCompIdx, buildingIdx, function( result, event ) {
            hideOverlay();
            step1Rerender();
            if( event.status ) {
              return result;
            } else {
              alert( 'Error during updating proposal instructions.' );
            }
      }, { escape: true } );
    }

    function showOverlayOverAddingPOPopUp( skipAnim ) { // MRS 6860
      if( skipAnim == undefined || skipAnim == false ) {
        $('#overlayContentOverAddingPOPopUp').show().fadeTo('slow', 1.0);
        $('#transparentOverlayOverAddingPOPopUp').show().fadeTo('slow', 0.7);
      } else {
        $('#overlayContentOverAddingPOPopUp').show().css({ 'opacity': '1.0', 'filter': 'alpha(opacity=100)' });
        $('#transparentOverlayOverAddingPOPopUp').show().css({ 'opacity': '0.7', 'filter': 'alpha(opacity=70)' });
      }
    }
    function hideOverlayOverAddingPOPopUp() { // MRS 6860
      $('#transparentOverlayOverAddingPOPopUp').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
      $('#overlayContentOverAddingPOPopUp').hide().css({ 'opacity': '0.2', 'filter': 'alpha(opacity=20)' });
      resizeFrame();
    }

    function recalculateCompleteness() { // MRS 7112 7369

        var fields = ["Primary_Company_Name__c", "Primary_Company_Contact__c",
                      "Billing_Company_Name__c", "Billing_Company_Contact__c",
                      "Proposal_RFP_Request_Date__c",
                      "Salesperson__c", "Fulfillment_Office__c", "Address__c",
                      "Project_Name__c", "Description__c", "Expected_Construction_Start_Date__c",
                      "Proposal_Type__c", "Proposal_Expiration_Date__c"];
        if($('[id$=Partner_Approval_Required__c').attr('checked') == 'checked') fields.push("Internal_Reviewer__c");
        var maxCompletenessRate = 100;
        var countOfFieldsCompleted = 0;
        var countSteps = fields.length + 1;
        for(index = 0; index < fields.length; index ++) {
			countOfFieldsCompleted += $('[id$=' + fields[index] + ']').attr('value') ? ($('[id$=' + fields[index] + ']').attr('value').length > 0 ? 1 : 0) : 0;
        }
        countOfFieldsCompleted += $('[id$=floorsTable] tbody tr').size() > 0 ? 1 : 0;
        if($('[id$=mainTable] input').size() > 0) {
            countSteps++; 
            $('[id$=mainTable] input').each(function(item, index) {
                if(this.checked) {
                    countOfFieldsCompleted++;
                        return false;
                }
            });
        }
        completeness = Math.round(maxCompletenessRate * countOfFieldsCompleted / countSteps);
        document.getElementById("completenessBar").style = "width: " + completeness + "%";
        document.getElementById("completenessValue").innerHTML = completeness + "%";
    }

    function addContactToRosterSearchAction() { //MRS 7335
        if($('[id$=addContactToRoster]')[0].value.length > 0) {
            $('[id$=addToWrapperCommandButton]').addClass('btn').removeClass('btnDisabled').removeAttr('disabled');
        } else {
            $('[id$=addToWrapperCommandButton]').addClass('btnDisabled').removeClass('btn');
        }
    }

    function proposalTypeChangedJS() { //MRS7335
        console.log($('[id$=Proposal_Type__c')[0].value);
        if($('[id$=Proposal_Type__c')[0].value == 'RFP') {
            $('[id$=documentAttachments').prop('style', 'display: block;');
        } else {
            $('[id$=documentAttachments').prop('style', 'display: none;');
        }
        recalculateCompleteness();
    }

	function changeOppRemoteAction() { //MRS 7307
		var idxLkid = $('[id$=Opportunity__c_lkid]').attr('value');
		var valOppI = $('[id$=Opportunity__c]').attr('value');
		if(idxLkid != '000000000000000' && valOppI) {
			ProposalWizardController.retriveSelectedOpportunityNumber(idxLkid, function(result, event) {
				if(event.status) {
					document.getElementById('Opportunity__cLabel').innerHTML = 'Opportunity #' + result + ':';	
				}	
			});
		} else {
			document.getElementById('Opportunity__cLabel').innerHTML = 'Opportunity:';
		}
	}

	function recalculateBillingDayAndMonth() { //MRS 7335
		var frequency = $('[id$=Frequency__c]').attr('value');
		if(frequency) {
			$('[id$=BillingDayDiv]').prop('style', 'display: table !important;');
			if(frequency != 'Quarterly') {
				$('[id$=Quarterly_Month__c]').attr('value', '1st')
				$('[id$=QuarterlyMonthDiv]').prop('style', 'display: none !important;');
			} else {
				$('[id$=QuarterlyMonthDiv]').prop('style', 'display: table !important;');
			}
			ProposalWizardController.getFrequencyToBillingDayFunction(frequency, function(result, event) {
				if(event.status) {
					var billingDays = document.getElementById("ProposalWizardPage:theForm:Billing_day__c");
					var optionsNodes = billingDays.childNodes;
					for(var n = optionsNodes.length - 1; n >= 0; n--) {
						if(optionsNodes[n].nodeType == 1) {
							var elementFound = false;
							for(var nV = 0; nV < result.length; nV++) {
					 			if(optionsNodes[n].value == result[nV]) {
									elementFound = true;
									break;
								}
					 		}
							if(!elementFound) billingDays.removeChild(optionsNodes[n]);		
						}
					}

					billingDays = document.getElementById("ProposalWizardPage:theForm:Billing_day__c");
					optionsNodes = billingDays.childNodes;
					for(var nV = 0; nV < result.length; nV++) {
						var elementFound = false;
						for(var n = 0; n < optionsNodes.length; n++) {
							if(optionsNodes[n] && optionsNodes[n].firstChild && optionsNodes[n].firstChild.data == result[nV]) {
								elementFound = true;
								break;
							}
						}
						if(!elementFound && result[nV].length > 0) {
					var opt = document.createElement("option");
							opt.value = opt.text =result[nV].trim();
						billingDays.appendChild(opt);
						}
					}	
				} else {
				}	
			});
		} else {
			$('[id$=Quarterly_Month__c]').attr('value', '1st');
			$('[id$=Billing_day__c]').attr('value', '');
			$('[id$=QuarterlyMonthDiv]').prop('style', 'display: none !important;');
			$('[id$=BillingDayDiv]').prop('style', 'display: none !important;');
		}
	}

	function recalculateFrequencyAndBillingDay(oldValue, newValue) { //MRS 7335
		$('[id$=msgs]').empty();
		if($('[id$=isPhase__c]').prop('checked') && document.getElementById("ProposalWizardPage:theForm:Separate_Phases__c").checked && newValue != 'Milestone') {
			checkSeparatePhasesVoid();
		} else {
			recalculateBillingDayAndMonth();
		}
	}

	function saparatePhasesChangeJS() {
		$('[id$=msgs]').empty();
		if($('[id$=isPhase__c]').prop('checked') && document.getElementById("ProposalWizardPage:theForm:Separate_Phases__c").checked && $('[id$=Billing_Method__c]').attr('value') != 'Milestone') {
			checkSeparatePhasesVoid();
		}	
	}
	
	var serviceType, changeOrderId, selectedServiceID; // MRS 7335
	var tempRecordType, tempCategory, tempType, tempSubtype, tempPlanPermission, addAndNewSiAction;
	function changeRightPanelToServiceItem(serviceTypeP, changeOrderIdP) {
		showOverlayNoWheel();
		$('#rightPanelHolder').attr('style', $('#rightPanelHolder').attr('style')+' z-index: 1002;'); //MRS 7418
		selectedServiceID = null;
		console.log('{!building.Id}');
		console.log('{!building.Municipality__c}');
		console.log('{!building.Region__c}');
		console.log('{!proposal.Billing_Company_Name__c}');
		console.log('{!proposal.Id}');
		console.log('{!proposal.isPhase__c}');
		console.log('{!phaseList}'.length);
		if($('[id$=Billing_Company_Name__c]')[0].value.length < 1 || $('[id$=Address__c]')[0].value.length < 1 || 
		($('[id$=isPhase__c]')[0].checked && $('[id$=phasesTable] tr').size() < 2))  { //MRS 7463
			showTemplateIsNotValidError();
			return;
		}
		serviceType = serviceTypeP;
		changeOrderId = changeOrderIdP;
		$('[id$=serviceType]')[0].value = originalServTemplateId;
		populateServiceListFromUserSelection('RecordTypeId');		
		$('[id$=servicesRightOutputPanel]').css('z-index', '1002');		
		$('[id$=servicesRightOutputPanel]').css('display', 'block');
		$('[id$=notesRightOutputPanel]').css('display', 'none');
		$('[id$=quantityOfServicesToInsert]')[0].value = 1;
		document.getElementById("nameOfSelectedTemplateSpan").innerHTML = 'Please Select Service From List';
		$('[id$=nameOfSelectedTemplateSpan]').attr('style', 'vertical-align: top; font-size: 12px; width: 100%; color: #D44; font-weight: bold;');
		disablePlanSubmissionTypeInput(true);
		$('.serviceSelectBlock select').css('width', '100%'); $('.workTypeSearchInput').keypress(function(e) { if(e.which == 13) {return false;}}); if({!isSinglePermit}) { disableCategoryAndType(true); }
	}
	
	function cancelAddingNewServices() {
		$('[id$=servicesRightOutputPanel]').css('display', 'none');
		$('[id$=notesRightOutputPanel]').css('display', 'block');
		document.getElementById("nameOfSelectedTemplateSpan").innerHTML = 'Please Select Service From List';
		$('[id$=nameOfSelectedTemplateSpan]').attr('style', 'vertical-align: top; font-size: 12px; width: 100%; color: #D44; font-weight: bold;');		
		serviceType = null;
		changeOrderId = null;
		proposalId = null;
		$('[id$=Category__c]')[0].value = $('[id$=Type__c]')[0].value = $('[id$=Subtype__c]')[0].value = $('[id$=Plan_Submission_Type__c]')[0].value = null;
		$('[id$=workTypeSearchInput')[0].value = null;
		$('[id$=defineWorkTypeRow]')[0].style = 'display: none'; //MRS 7368
		$('#rightPanelHolder').attr('style', $('#rightPanelHolder').attr('style').replace(' z-index: 1002','')); //MRS 7418
		hideOverlayNoWheel();
		changeRightPanelToNotesAction();
	}

	function populateServiceListFromUserSelection(levelOfChange) {
		if(addAndNewSiAction) {
			addAndNewSiAction = false;
			$('[id$=serviceType]')[0].value = tempRecordType;
			$('[id$=Category__c]')[0].value = tempCategory == null ? '-- None --' : tempCategory;
			$('[id$=Type__c]')[0].value = tempType == null ? '-- None --' : tempType;
			$('[id$=Subtype__c]')[0].value = tempSubtype == null ? '-- None --' : tempSubtype;
			$('[id$=Plan_Submission_Type__c]')[0].value = tempPlanPermission == null ? '-- None --' : tempPlanPermission;
			if(tempPlanPermission != null) {
				levelOfChange = 'Plan_Submission_Type__c';
			} else if(tempSubtype != null) {
				levelOfChange = 'Subtype__c';
			} else if(tempType != null) {
				levelOfChange = 'Type__c';
			} else if(Category__c != null) {
				levelOfChange = 'Category__c';
			}
		}
		var sTypeID = $('[id$=serviceType]')[0].value;
		var region = '{!building.Region__c}';
		var category = $('[id$=Category__c]')[0].value == '-- None --' ? null : $('[id$=Category__c]')[0].value;
		var type = $('[id$=Type__c]')[0].value == '-- None --' ? null : $('[id$=Type__c]')[0].value;
		var subtype = $('[id$=Subtype__c]')[0].value == '-- None --' ? null : $('[id$=Subtype__c]')[0].value;
		var planPermission = $('[id$=Plan_Submission_Type__c]')[0].value == '-- None --' ? null : $('[id$=Plan_Submission_Type__c]')[0].value;
		var workTypeSearchInput = $('[id$=workTypeSearchInput')[0].value.length > 0 ? $('[id$=workTypeSearchInput')[0].value : null;
		if(levelOfChange == 'RecordTypeId') {
			category = type = subtype = planPermission = null;
		} else if(levelOfChange == 'Category__c') {
			type = subtype = planPermission = null;
		} else if(levelOfChange == 'Type__c') {
			subtype = planPermission = null;
		} else if(levelOfChange == 'Subtype__c') {
			planPermission = null;
		}
		
		ProposalWizardController.getListsForServiceItemAddDialog(levelOfChange, sTypeID, region, category, type, subtype, planPermission, workTypeSearchInput, function(result, event) {
			if(event.status) {
				if(levelOfChange == 'RecordTypeId') {
					$('[id$=Category__c]')[0].disabled = $('[id$=Type__c]')[0].disabled = $('[id$=Subtype__c]')[0].disabled = $('[id$=Plan_Submission_Type__c]')[0].disabled = true;
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Category__c", result['Category__c']);
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Type__c", result['Type__c']);
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Subtype__c", result['Subtype__c']);
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Plan_Submission_Type__c", result['Plan_Submission_Type__c']);
					$('[id$=Category__c]')[0].value = $('[id$=Type__c]')[0].value = $('[id$=Subtype__c]')[0].value = $('[id$=Plan_Submission_Type__c]')[0].value = '-- None --';
					$('[id$=Category__c]')[0].disabled = $('[id$=Type__c]')[0].disabled = $('[id$=Subtype__c]')[0].disabled = $('[id$=Plan_Submission_Type__c]')[0].disabled = false;
				} else if(levelOfChange == 'Category__c') {
					$('[id$=Type__c]')[0].disabled = $('[id$=Subtype__c]')[0].disabled = $('[id$=Plan_Submission_Type__c]')[0].disabled = true;
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Type__c", result['Type__c']);
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Subtype__c", result['Subtype__c']);
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Plan_Submission_Type__c", result['Plan_Submission_Type__c']);
					$('[id$=Type__c]')[0].value = $('[id$=Subtype__c]')[0].value = $('[id$=Plan_Submission_Type__c]')[0].value = '-- None --';
					$('[id$=Type__c]')[0].disabled = $('[id$=Subtype__c]')[0].disabled = $('[id$=Plan_Submission_Type__c]')[0].disabled = false;
				} else if(levelOfChange == 'Type__c') {
					$('[id$=Subtype__c]')[0].disabled = $('[id$=Plan_Submission_Type__c]')[0].disabled = true;
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Subtype__c", result['Subtype__c']);
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Plan_Submission_Type__c", result['Plan_Submission_Type__c']);
					$('[id$=Subtype__c]')[0].value = $('[id$=Plan_Submission_Type__c]')[0].value = '-- None --';
					$('[id$=Subtype__c]')[0].disabled = $('[id$=Plan_Submission_Type__c]')[0].disabled = false;
				} else if(levelOfChange == 'Subtype__c') {
					$('[id$=Plan_Submission_Type__c]')[0].disabled = true;
					refillSelectOptionsOfElement("ProposalWizardPage:theForm:Plan_Submission_Type__c", result['Plan_Submission_Type__c']);
					$('[id$=Plan_Submission_Type__c]')[0].value = '-- None --';
					$('[id$=Plan_Submission_Type__c]')[0].disabled = false;
				}
				refillSelectAccordinglyToSelection(result['List_Of_Services']);
			} else {
				
			}
		});
	}

	function refillSelectAccordinglyToSelection(serviceItems) {
		var servicesTableBody = document.getElementById("foundServicesesTable");
		servicesTableBody.innerHTML = '';
		for(n = 0; n < serviceItems.length; n++) {
			var newSPAN = document.createElement("span");
			newSPAN.innerHTML = serviceItems[n][1];
			newSPAN.style = 'cursor: pointer; word-break: break-all; white-space: normal;';
			var newTD_Name = document.createElement("td");
			newTD_Name.style = 'border-left: none; border-buttom: none; cursor: pointer;';
			newTD_Name.onclick = function() { refillNameOfSelectedService(this); };
			newTD_Name.appendChild(newSPAN);
			var newTD_ID = document.createElement("td");
			newTD_ID.style = 'display: none;';
			newTD_ID.innerHTML = serviceItems[n][0];
			var newTR = document.createElement("tr");
			newTR.colspan="2";
			newTR.appendChild(newTD_Name);
			newTR.appendChild(newTD_ID);
			servicesTableBody.appendChild(newTR);
			if(document.getElementById("nameOfSelectedTemplateSpan").innerHTML.length <1) {
				document.getElementById("nameOfSelectedTemplateSpan").innerHTML = 'Please Select Service From List';
				$('[id$=nameOfSelectedTemplateSpan]').attr('style', 'vertical-align: top; font-size: 12px; width: 100%; color: #D44; font-weight: bold;');
			}
		}
				
		document.getElementById("numberOfServicesFound").innerHTML = '<h3> Services found: ' + serviceItems.length + '</h3>';
		if(serviceItems.length > 0) {
			$('[id$=noServicesFoundSpan').css('display','none');
			$('[id$=foundServiceTemplates').css('display','block');
			$('[id$=selectedServiceDiv').css('display','block');
		} else {
			$('[id$=noServicesFoundSpan').css('display','block');
			$('[id$=foundServiceTemplates').css('display','none');
			$('[id$=selectedServiceDiv').css('display','none');
		}
	}
		
	function refillNameOfSelectedService(serviceNameTD) {
		if($(serviceNameTD).children('span')[0].outerText.length > 0) {
			selectedServiceID = $(serviceNameTD).next()[0].innerText;
			document.getElementById("nameOfSelectedTemplateSpan").innerHTML = $(serviceNameTD).children('span')[0].outerText;
			$('[id$=nameOfSelectedTemplateSpan]').attr('style', 'vertical-align: top; font-size: 12px; width: 100%; color: #000; font-weight: normal;')
		} else {
			document.getElementById("nameOfSelectedTemplateSpan").innerHTML = 'Please Select Service From List';
			$('[id$=nameOfSelectedTemplateSpan]').attr('style', 'vertical-align: top; font-size: 12px; width: 100%; color: #D44; font-weight: bold;');
		}
		if(selectedServiceID) {
			var selectedServiceName;
			var recordTypeID = $('[id$=serviceType]')[0].value;
			for(var n = 0; n < $('[id$=serviceType]')[0].children.length; n++) {
				if($('[id$=serviceType]')[0].children[n].value == recordTypeID) {
					selectedServiceName = $('[id$=serviceType]')[0].children[n].innerText;
					break;
				}
			}
			if(selectedServiceName)	{
				var vendorSelected = $('[id$=approvedVendor]')[0].value.length > 0 ? $('[id$=approvedVendor]')[0].value : null;
				var inspectionTypeSelected = $('[id$=inspectionTypes]')[0].value.length > 0 ? $('[id$=inspectionTypes]')[0].value : null; 
				ProposalWizardController.getCharacteristicsOfSelectedTemplate(selectedServiceID, selectedServiceName, vendorSelected, inspectionTypeSelected,  function(result, event) {
					if(event.status) {
						if(result[0] && ('{!isSIPSOnly}' != true)) { //MRS 7368
							$('[id$=defineWorkTypeRow]')[0].style = 'display: table-row';
						} else {
							$('[id$=defineWorkTypeRow]')[0].style = 'display: none';
						}
						if(result[1] && ('{!isThisUserAssignedSIPSUser}' || '{!isSIPSUserInChangeOrder}')) {
							$('[id$=approvedVendorArea]').css('display', 'block');
						} else {
							$('[id$=approvedVendorArea]').css('display', 'none');
						}
						if(result[2] && '{!(isThisUserAssignedSIPSUser || isSIPSUserInChangeOrder)}') {
							$('[id$=addServiceBtn]').addClass('btnDisabled').removeClass('btn');
							$('[id$=addAndNewServiceBtn]').addClass('btnDisabled').removeClass('btn');	
						} else {
							$('[id$=addServiceBtn]').addClass('btn').removeClass('btnDisabled');
							$('[id$=addAndNewServiceBtn]').addClass('btn').removeClass('btnDisabled');	
						}
						if(result[3]) {
							$('[id$=quantityOfServicesToIsert]').css('display', 'none');	
						} else {
							$('[id$=quantityOfServicesToIsert]').css('display', 'block');	
						}
					} else {
					}
				});
			} else {
				$('[id$=defineWorkTypeRow').css('display', 'none');
				$('[id$=approvedVendorArea').css('display', 'none');
				$('[id$=addServiceBtn]').addClass('btnDisabled').removeClass('btn');
				$('[id$=addAndNewServiceBtn]').addClass('btnDisabled').removeClass('btn');
				$('[id$=quantityOfServicesToIsert]').css('display', 'none');
			}
		} else {
			$('[id$=defineWorkTypeRow').css('display', 'none');
			$('[id$=approvedVendorArea').css('display', 'none');
			$('[id$=addServiceBtn]').addClass('btnDisabled').removeClass('btn');
			$('[id$=addAndNewServiceBtn]').addClass('btnDisabled').removeClass('btn');
			$('[id$=quantityOfServicesToIsert]').css('display', 'none');	
		}
	}

	function refillSelectOptionsOfElement(elem, options) {
		var categoryListElement = document.getElementById(elem);
		categoryListElement.innerHTML = '';
		var opt = document.createElement("option");
		opt.text = "-- None --";
		categoryListElement.appendChild(opt);
		for(var n = 0; n < options.length; n++) {
			opt = document.createElement("option");
			opt.value = opt.text = options[n][0];
			categoryListElement.appendChild(opt);
		}
	}

	function adjustAccessToButtons() {
		if($('[id$=approvedVendor]')[0].value.length > 0 && $('[id$=inspectionTypes]')[0].value.length > 0) {
			$('[id$=addServiceBtn]').addClass('btn').removeClass('btnDisabled');
			$('[id$=addAndNewServiceBtn]').addClass('btn').removeClass('btnDisabled');
		} else {
			$('[id$=addServiceBtn]').addClass('btnDisabled').removeClass('btn');
			$('[id$=addAndNewServiceBtn]').addClass('btnDisabled').removeClass('btn');
		}
	}

	function updateAddReimbMuniFeeInvStatus(idx, chk) { //MRS 7298
		ProposalWizardController.changeAddReimbMuniFeeInvStatus(idx, chk.checked, function(result, event) {
			if(event.status) {
			}	
		});
	}

  </script>

  <apex:stylesheet value="{!URLFOR($Resource.ProposalWizardResources, 'proposalWizard.css')}"/>

  <apex:form style="width: 100%; background-color: #F8F8F8;" id="theForm">
    <!-- Action Functions -->
    <span style="display: none;">
      <apex:actionFunction name="step1Rerender" reRender="step1" status="overlay"/> <!-- //G300 MRS-6845 -->
      <apex:actionFunction name="approveChangeOrder" action="{!approveChangeOrderBeforeRedirectBillingTriggers}" reRender="msgs" oncomplete="if( $('.errorM3[role=alert] span').length != 0 ) { hideOverlay(); } else { checkNewTasksExistance(); }"/>
      <apex:actionFunction name="addErrorMessageRedirectTriggers" action="{!addErrorMessageRedirectTriggers}" reRender="msgs" oncomplete="hideOverlay();"/>
      <apex:actionFunction name="redirectBillingTriggers" action="{!redirectBillingTriggers}" reRender="msgs" oncomplete="hideOverlay();"/>

      <!-- Step switch -->
      <apex:actionFunction name="goToStep1" reRender="" oncomplete="if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); resizeFrame(); } projectLocationEnableEditing({!isAnyServiceItems}); disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/>
      <apex:actionFunction name="goToStep2" reRender="" oncomplete="if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); } disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/>
      <apex:actionFunction name="goToStep3" reRender="" oncomplete="if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); } disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/>
      <apex:actionFunction name="goToStep4" reRender="" oncomplete="if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); } disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/>

      <!-- Completeness -->
      <apex:actionFunction name="rerenderCompleteness" reRender="step1, completeness, footer, servicesManagementButtonsNotApproved, msgs"/> <!-- MRS 7112 -->
      <apex:actionFunction name="rerenderCompletenessWithStatus" reRender="step1, completeness, footer, servicesManagementButtonsNotApproved, msgs"/> <!-- MRS 7112 -->

      <!-- MRS 6915 -->
      <apex:actionFunction name="saveProposalIfNotExistsForInstr" action="{!saveProposalIfNotExists}" reRender="footer, header, mainform, msgs" oncomplete="extIdxProposal='{!proposal.Id}'; instructionSaving();"/>
      <!-- Step 1 -->
	  <apex:actionFunction name="showTemplateIsNotValidError" action="{!performTemplateChecks}" reRender="msgs" status="overlay"/> <!-- MRS 7335 --> 
	  <apex:actionFunction name="checkSeparatePhasesVoid" action="{!checkSeparatePhasesVoid}" reRender="msgs" status="overlay"/>
      <apex:actionFunction name="updateProjectLocation" action="{!updateProjectLocation}" reRender="step1, msgs" oncomplete="resizeFrame(); if('{!rightPanelView}' != 'Notes') changeRightPanelToNotes();">
        <apex:param name="tabNumber" value="-1"/>
        <apex:param name="buildingId" value=""/>
      </apex:actionFunction>
      <apex:actionFunction name="addNewPhaseAction" reRender="none"> <!-- MRS 7112 7330 -->
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="editPhaseAction" action="{!editPhaseAction}" reRender="phasesRightOutputPanel, servicesRightOutputPanel, msgs" oncomplete="if( $('.errorM3[role=alert] span').length != 0 ) { } else { changeRightPanelToPhase(); }"> <!-- MRS 7112 -->
        <apex:param name="phaseEditId" assignTo="{!phaseEditId}" value=""/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="deletePhaseAction" action="{!deletePhaseAction}" reRender="step1, step3, moveServicesToPhasesPanel, phasesRightOutputPanel, servicesRightOutputPanel, msgs" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});" status="overlay">
        <apex:param name="phaseDelId" value="" assignTo="{!phaseDelId}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="primaryCompanyAction" action="{!primaryCompanyAction}" reRender="step1, completeness, footer, rightPanel, step3, step4, msgs, mainform" oncomplete="billingCompanyEnableEditing({!proposal.Primary_Client_is_Billing_Client__c});" status="overlay">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
      </apex:actionFunction>
      <apex:actionFunction name="billingCompanyAction" action="{!billingCompanyAction}" rerender="step1, completeness, footer, rightPanel, step3, step4, msgs, mainform" status="overlay">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
      </apex:actionFunction>
      <apex:actionFunction name="primaryCompanyIsBillingCompanyAction" action="{!primaryCompanyIsBillingCompanyAction}" rerender="step1, completeness, footer, rightPanel, step4, step3, msgs, mainform" oncomplete="billingCompanyEnableEditing({!proposal.Primary_Client_is_Billing_Client__c});" status="overlay">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
      </apex:actionFunction>
      <apex:actionFunction name="poRequiredAndNotRequiredLogic" action="{!poRequiredAndNotRequiredLogic}" rerender="step1, completeness, footer, rightPanel, step4, step3, msgs, mainform" oncomplete="poNotRequiredEditing({!!proposal.PO_Required__c});" status="overlay">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
      </apex:actionFunction>
      <apex:actionFunction name="accountingCompanyAction" action="{!accountingCompanyAction}" rerender="step1, step4, footer, msgs" status="overlay"/>
      <apex:actionFunction name="projectAddressAction" action="{!projectAddressAction}" reRender="step1, completeness, footer, rightPanel, loadServiceBundlePanel, step2, step3, step4, msgs" oncomplete="if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); }" status="overlay">
        <apex:param name="tabNumber" value="-1"/>
        <!-- MRS 7094 -->
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <!-- MRS 7094 -->
      <apex:actionFunction name="setConfirmServicesTune" action="{!setConfirmServiceTune}" reRender="confirmServiceTune" status="overlay">
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <apex:actionFunction name="removeFloorAction" action="{!removeFloorAction}" reRender="step1, step3, selectFloorsForServicesPanel, completeness, footer, msgs" status="overlay">
        <apex:param name="floorIdToRemove" value="" assignTo="{!floorIdToRemove}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeVisibilityOfFloor" action="{!changeVisibilityOfFloor}" reRender="step1, step3, selectFloorsForServicesPanel, completeness, footer, msgs" status="overlay">
        <apex:param name="floorIdToRemove" value="" assignTo="{!floorIdToRemove}"/>
        <apex:param name="statusOfFloorVisibility" value="" assignTo="{!statusOfFloorVisibility}"/>
      </apex:actionFunction> <!-- MRS 7109 -->
      <apex:actionFunction name="changeContactRosterRoleAction" action="{!pwr.changeContactRosterRoleAction}" reRender="msgs, recipientsPanel"> <!-- MRS 7112 -->
        <apex:param name="rosterId" value=""/>
        <apex:param name="rosterRole" value=""/>
      </apex:actionFunction>
      <apex:actionFunction name="deleteContactFromRosterAction" action="{!pwr.deleteContactFromRosterAction}" rerender="step1, step4, msgs" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"> <!-- MRS 7112 -->
        <apex:param name="rosterId" value=""/>
      </apex:actionFunction>
      <apex:actionFunction name="setProjectTeam" action="{!setProjectTeam}" status="overlay" reRender="assignProjectTeamButton, step1, step4, msgs" oncomplete="hideErrorMessages(); return false;">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>

      <!-- Step 1 document upload -->
      <apex:actionFunction name="manageDocumentsUpload" action="{!manageFileUpload}" reRender="step1, msgs, footer, step4, step1uploadAdditional, rightPanel" status="overlay">
        <apex:param name="documentsFolder" value="" assignTo="{!currentStorageFolder}"/>
      </apex:actionFunction>
      <apex:actionFunction name="manageDrawingsUpload" action="{!manageFileUpload}" reRender="step1, msgs, footer, step4, step1uploadDrawings, rightPanel" status="overlay">
        <apex:param name="documentsFolder" value="" assignTo="{!currentStorageFolder}"/>
      </apex:actionFunction>
      <apex:actionFunction name="isDisableDocumentsCheckbox" action="{!isDisableDocumentsCheckbox}" rerender="Provided_Documents__c, Provided_Drawings__c" oncomplete="manageDocumentsUpload('Additional Documents'); manageDrawingsUpload('Drawings');" />
      <apex:actionFunction name="updateArtifacts" action="{!updateArtifacts}" reRender="msgs" oncomplete="resizeFrame();">
        <apex:param name="drawingsTitle" value="" assignTo="{!drawingsTitle}"/>
        <apex:param name="drawingsDescriptioin" value="" assignTo="{!drawingsDescriptioin}"/>
        <apex:param name="drawingsNumber" value="" assignTo="{!drawingsNumber}"/>
        <apex:param name="drawingsRevisionDate" value="" assignTo="{!drawingsRevisionDate}"/>
      </apex:actionFunction>

      <!-- Step 2 -->
      <apex:actionFunction name="manageDataFromStep2" reRender="footer, completeness" oncomplete="hideOverlay();">
        <apex:param name="serializedProposal" value="" assignTo="{!serializedProposal}"/>
      </apex:actionFunction>
      <apex:actionFunction name="confirmCZRequest" reRender="confirmServiceTuneApplyButton"/>
      <!-- MRS 7094 -->
      <apex:actionFunction name="setConfirmServicesTuneSubmit" action="{!setConfirmServiceTuneSubmit}" reRender="confirmServiceTune" status="overlay">
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <!-- Step 3 -->

      <apex:actionFunction name="saveAndNewPurchaseOrderAction" action="{!saveAndNewPurchaseOrderAction}" reRender="purchaseOrderOutputPanel, changeOrderTables" oncomplete="showOverlay();" status="overlayAddingPOPopUpStatus"/> <!-- MRS 6860 -->
      <apex:actionStatus id="overlayAddingPOPopUpStatus" onstart="showOverlayOverAddingPOPopUp();" onstop="hideOverlayOverAddingPOPopUp();"/> <!-- MRS 6860 -->
      <apex:actionFunction name="setSelectedReasonToSelectedServicesItems" action="{!setSelectedReasonToSelectedServiceItems}" reRender="step3, msgs" status="overlay"><!-- MRS 7056 -->
        <apex:param name="serviceIdsForMultiAction" value="" assignTo="{!serviceIdsForMultiAction}"/>
      </apex:actionFunction>
      <apex:actionFunction name="createNonFeeProposalPDF" action="{!createNonFeeProposalPDF}" reRender="">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>
      <apex:actionFunction name="moveServicesToPhaseAction" action="{!moveServicesToPhase}" reRender="changeOrderTables, moveServicesToPhasesPanel, changePhaseOutputPanel" status="overlay">
        <apex:param name="serviceIdsForMultiAction" value="" assignTo="{!serviceIdsForMultiAction}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="moveServiceToPhaseAction" action="{!moveServiceToPhase}" reRender="changeOrderTables, moveServicesToPhasesPanel, changePhaseOutputPanel" status="overlay">
        <apex:param name="serviceIdsForMultiAction" value="" assignTo="{!serviceIdsForMultiAction}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="deleteMultipleServicesAction" action="{!deleteMultipleServices}" reRender="changeOrderTables, moveServicesToPhasesPanel, changePhaseOutputPanel" status="overlay">
        <apex:param name="serviceIdsForMultiAction" value="" assignTo="{!serviceIdsForMultiAction}"/>
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="moveServicesBetweenTables" action="{!moveServicesBetweenTables}" reRender="changeOrderTables, moveServicesToPhasesPanel, changePhaseOutputPanel, msgs" status="overlay"> <!-- MTR 6931 MRS 7134 -->
        <apex:param name="serviceIdsForMultiAction" value="" assignTo="{!serviceIdsForMultiAction}"/>
        <apex:param name="whereToMoveDestination" value="" assignTo="{!whereToMoveDestination}"/>
      </apex:actionFunction>
      <apex:actionFunction name="recalculateDiscount" action="{!recalculateDiscount}" reRender="discountPercentage, changeOrderTables" status="overlay"/>
      <apex:actionFunction name="recalculateReimbursables" action="{!recalculateReimbursables}" reRender="reimbursablePercentage, totalServiceReimbursables, totalServiceReimbursablesAlt, totalServiceCost, totalServiceCostAlt, addNewProposalReimbursableBtn" status="overlay"/>
      <apex:actionFunction name="updateChangeOrderReimbursableData" reRender="changeOrderTables" action="{!updateChangeOrderReimbursableData}"> <!-- MRS 7112 -->
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="updateChangeOrderDiscountData" reRender="changeOrderTables" action="{!updateChangeOrderDiscountData}"> <!-- MRS 7112 -->
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeServiceUnitPrice" reRender="changeOrderTables" action="{!changeUnitPriceInServiceModel}" status="overlay">
        <apex:param name="serviceIdToChange" value="" assignTo="{!serviceIdToChange}"/>
      </apex:actionFunction>
      <apex:actionFunction name="removeChangeOrderAction" action="{!removeChangeOrder}" reRender="notesRightOutputPanel, changeOrderTables, msgs" status="overlay">
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="removeServiceModel" action="{!removeServiceModel}" reRender="step1, purchaseOrderOutputPanel, changeOrderTables, addClientPurchaseOrderButton, saveServiceBundleButton, completeness, footer, servicesManagementButtonsNotApproved, msgs" status="overlay">
        <apex:param name="serviceIdToRemove" value="" assignTo="{!serviceIdToRemove}"/>
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeQuantity" action="{!changeQuantity}" reRender="changeOrderTables, saveServiceBundleButton, completeness, footer, servicesManagementButtonsNotApproved, confirmQuantityChange, msgs" status="overlay">
        <apex:param name="newQuantity" value="" assignTo="{!newQuantity}"/>
        <apex:param name="oldQuantity" value="" assignTo="{!oldQuantity}"/>
        <apex:param name="serviceIdToChange" value="" assignTo="{!serviceIdToChange}"/>
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
        <apex:param name="isDiff" value="" assignTo="{!isDiff}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction action="{!changeCOStatus}" name="changeCOStatus" reRender="notesRightOutputPanel, changeOrderTables, reasonInputNotificationPanel, step1, step3, step4, cannotSendToClientPanel, msgs" status="overlay">
        <apex:param name="changeCoStatusCoId" value="" assignTo="{!changeCoStatusCoId}"/>
        <apex:param name="changeCoStatusNewStatus" value="" assignTo="{!changeCoStatusNewStatus}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
      </apex:actionFunction>
      <apex:actionFunction action="{!changeCOStatus}" name="sendToClientAndChangeCOStatus" reRender="notesRightOutputPanel, changeOrderTables, reasonInputNotificationPanel, step1, step4, cannotSendToClientPanel, msgs" oncomplete="if( $('.errorM3[role=alert] span').length != 0 || {!showAdditionalToCcMessage}) { hideOverlay(); } else { if( {!doCreatePdf} ) { prepareAndSendProposalPdf( changeOrderId ); } }">
        <apex:param name="changeCoStatusCoId" value="" assignTo="{!changeCoStatusCoId}"/>
        <apex:param name="changeCoStatusNewStatus" value="" assignTo="{!changeCoStatusNewStatus}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="emailType" value="" assignTo="{!emailType}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="changeCoStatusDisableFollowUps" value="" assignTo="{!changeCoStatusDisableFollowUps}"/>
        <apex:param name="changeCoStatusIsLightDoc" value="" assignTo="{!changeCoStatusIsLightDoc}"/>
      </apex:actionFunction>
      <apex:actionFunction name="updateCZAnalystEmailOnChangeOrder" action="{!updateCZAnalystEmailOnChangeOrder}" reRender="msgs, changeOrderTables" status="overlay">
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="updateSIPSCoordinatorOnChangeOrder" action="{!updateSIPSCoordinatorOnChangeOrder}" reRender="msgs, changeOrderTables, assignSIPSCoordinatorForCOButton" status="overlay">
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeProposalReceivedDocumentStatus" action="{!changeProposalReceivedDocumentStatus}" reRender="" status="overlay"/>
      <apex:actionFunction name="changeCOReceivedDocumentStatus" action="{!changeCOReceivedDocumentStatus}" reRender="" status="overlay">
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="populateReminderForCreatorFields" action="{!populateReminderForCreatorFields}" status="overlay" reRender="Send_Reminder_To_Creator__c"/>
      <apex:actionFunction name="loadServiceBundleAction" action="{!loadServiceBundle}" reRender="step1, changeOrderTables, purchaseOrderOutputPanel, completeness, footer, step4, msgs" status="overlay">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
        <apex:param name="virtualChangeOrderName" value="" assignTo="{!virtualChangeOrderName}"/>
      </apex:actionFunction>
      <apex:actionFunction name="makeRerender" reRender="" status="overlay" oncomplete="if({!!serviceBundleChosenCanBeDeleted}){ $('#cannotDeleteServiceBundlePanelActionArea').show(); } else { $('#deleteServiceBundlePanelActionArea').show(); }"/>
      <apex:actionFunction name="saveServiceBundleAction" action="{!saveServiceBundle}" reRender="saveServiceBundlePanel, loadServiceBundlePanel" status="overlay">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
        <apex:param name="virtualChangeOrderName" value="" assignTo="{!virtualChangeOrderName}"/>
      </apex:actionFunction>
      <apex:actionFunction name="deleteServiceBundleAction" action="{!deleteServiceBundle}" reRender="msgs, loadServiceBundlePanel" status="overlay" oncomplete="$('#loadServiceBundlePanelActionArea').show();">
      </apex:actionFunction>
      <apex:actionFunction name="prepareServiceJunctionsData" action="{!populateServiceFloorJunctionsIds}" reRender="" status="overlay" oncomplete="showFloorsPanel( '{!selectedServiceFloorIds}', '{!partialServiceFloorIds}' );">
        <apex:param name="serviceIdsForMultiAction" assignTo="{!serviceIdsForMultiAction}" value=""/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
      </apex:actionFunction>
      <apex:actionFunction name="manageServiceFloorJunctions" action="{!manageServiceFloorJunctions}" reRender="msgs, changeOrderTables, selectFloorsForServicesPanel" status="overlay">
        <!--apex:param name="serviceIdsForMultiAction" assignTo="{!serviceIdsForMultiAction}" value=""/-->
        <apex:param name="selectedServiceFloorIds" assignTo="{!selectedServiceFloorIds}" value=""/>
        <apex:param name="partialServiceFloorIds" assignTo="{!partialServiceFloorIds}" value=""/>
      </apex:actionFunction>
      <apex:actionFunction name="deleteReimbursableAction" action="{!deleteReimbursableAction}" reRender="step3, msgs" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});" status="overlay">
        <apex:param name="reimbursableToDeleteId" value="" assignTo="{!reimbursableIdToRemove}"/>
      </apex:actionFunction>
      <apex:actionFunction name="manageFollowups" action="{!manageFollowups}" reRender="step1, step3, step4" status="overlay">
        <apex:param name="changeCoStatusCoId" value="" assignTo="{!changeCoStatusCoId}"/>
      </apex:actionFunction>

      <!-- Step 4 -->
      <apex:actionFunction name="updateAttachedDocuments" action="{!updateAttachedDocuments}" rerender="documentAttachments" status="overlay"/>
      <apex:actionFunction name="createDeleteAdditionalDocumentsFolder" action="{!createDeleteAdditionalDocumentsFolder}" rerender="step1, rightPanel, footer, step4, msgs" status="overlay" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/>
      <apex:actionFunction name="rerenderIframeRfpPage" reRender="step4" status="overlay" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/>
      <apex:actionFunction name="saveDraftAndCreatePdf" action="{!saveDraft}" reRender="footer, header, mainform, msgs" status="overlay" oncomplete="goToStep(4); showPdf('{!proposal.Id}', {!enableSendProposalPdf}); return false;">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <apex:param name="reloadPage" value="false" assignTo="{!reloadPage}"/>
      </apex:actionFunction>
      <apex:actionFunction name="saveProposalAndCreatePdf" action="{!complete}" reRender="footer, header, mainform, msgs" status="overlay" oncomplete="goToStep(4); showPdf('{!proposal.Id}', {!enableSendProposalPdf});">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <apex:param name="reloadPage" value="false" assignTo="{!reloadPage}"/>
      </apex:actionFunction>
      <apex:actionFunction name="saveProposalIfNotExists" action="{!saveProposalIfNotExists}" reRender="footer, header, mainform, msgs" status="overlay" oncomplete="goToStep(4); showPdf('{!proposal.Id}', {!enableSendProposalPdf});"/>

      <!-- Right panel -->
      <apex:actionFunction name="changeRightPanelToNotesAction" action="{!changeRightPanelToNotes}" reRender="step1, rightPanel, msgs" oncomplete="hideRightOverlay();" status="overlay"/> <!-- MRS 7335 -->
      <apex:actionFunction name="changeRightPanelToFloor" action="{!changeRightPanelToFloor}" reRender="msgs"/> <!-- MRS 7112 -->   
      <apex:actionFunction name="changeRightPanelToReimbursable" action="{!changeRightPanelToReimbursable}" reRender="rightPanel, footer, reimbursableRightOutputPanel, step1, step4, msgs" status="rightOverlay">
        <apex:param name="activeChangeOrderId" value="" assignTo="{!activeChangeOrderId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeRightPanelToPhase" action="{!changeRightPanelToPhase}" reRender="step1, rightPanel, footer, step4, msgs" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});" status="rightOverlay"/> <!-- MRS 7112 -->
      <apex:actionFunction name="changeRightPanelToSendCopyToCC" action="{!showSendCopyTo}" reRender="step1, rightPanel, footer, step4, msgs" status="overlay"/>
      <apex:actionFunction name="closeRightPanelToCopyToCC" action="{!updateSendCopyTo}" reRender="step1, rightPanel, msgs" oncomplete="resizeFrame(); hideRightOverlay();">
        <apex:param name="emailsToCC" value="" assignTo="{!emailsToCC}"/>
      </apex:actionFunction>
      <apex:actionFunction name="cancelRightPanelToCopyToCC" action="{!cancelSendCopyTo}" reRender="step1, rightPanel, msgs" oncomplete="resizeFrame(); hideRightOverlay();"/>
      <apex:actionFunction name="rerenderChangeOrderInternalReviewerData" reRender="changeOrderInternalReviewerData"/>
      <apex:actionFunction action="{!cancelChangeOrderInternalReviewer}" name="cancelChangeOrderInternalReviewer" reRender="changeOrderInternalReviewerData" status="overlay" oncomplete="$('.changeOrderInternalReviewerPanel').hide();"/>
      <apex:actionFunction name="addAllServicesToPurchaseOrder" action="{!addAllServicesToPurchaseOrder}" reRender="purchaseOrderOutputPanel" oncomplete="if('{!updateServiceTable}' == 'true') { cleanUpPurchaseServises(); }" status="overlayAddingPOPopUpStatus"/> <!-- MRS 6860 -->
      <apex:actionFunction name="blanketPOAction" action="{!blanketPOAction}" reRender="purchaseOrderOutputPanel" oncomplete="hideRightOverlay();"/>
      <apex:actionFunction name="updatePurchaseOrderAction" action="{!updatePurchaseOrderAction}" reRender="purchaseOrderOutputPanel, changeOrderTables, msgs" status="overlayAddingPOPopUpStatus"> <!-- MRS 6860 -->
        <apex:param name="purchaseOrderToUpdate" value="" assignTo="{!purchaseOrderToUpdate}"/>
      </apex:actionFunction>
      <apex:actionFunction name="deletePurchaseOrderAction" action="{!deletePurchaseOrderAction}" reRender="purchaseOrderOutputPanel, changeOrderTables, msgs" status="overlayAddingPOPopUpStatus"> <!-- MRS 6860 -->
        <apex:param name="purchaseOrderToUpdate" value="" assignTo="{!purchaseOrderToUpdate}"/>
      </apex:actionFunction>
      <apex:actionFunction name="showAddManagePOsWindow" action="{!prepareCurrentPurchaseOrder}" reRender="purchaseOrderOutputPanel, purchaseOrderUploadManager, msgs" oncomplete="$('#purchaseOrderAddModDiv').toggle();" /> <!-- MRS 6860 -->
      <apex:actionFunction name="savePurchaseOrder" action="{!savePurchaseOrderAction}" reRender="purchaseOrderOutputPanel, changeOrderTables" oncomplete="if( {!purchaseOrderCreated} ) { changeRightPanelToNotes();  $('#purchaseOrderAddModDiv').toggle(); hideOverlay();}" status="overlayAddingPOPopUpStatus"/> <!-- MRS 6860 -->
      <apex:actionFunction name="cancelPurchaseOrder" action="{!cancelPurchaseOrderAction}" oncomplete="if( $('.errorM3[role=alert] span').length == 0) {changeRightPanelToNotes();} hideOverlay();" reRender="purchaseOrderOutputPanel, changeOrderTables" status="rightOverlay"/>
      <!-- Footer -->
      <apex:actionFunction name="saveDraft" action="{!saveDraft}" reRender="footer, header, mainform, msgs" status="overlay">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <!-- MRS-6915 -->
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <apex:actionFunction name="completeProposal" action="{!complete}" reRender="footer, header, mainform, msgs" status="overlay">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <!-- MRS-6915 -->
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeProposalStatus" action="{!changeProposalStatus}" reRender="reasonInputNotificationPanel, step1, step4, footer, header, mainform, msgs" status="overlay">
        <apex:param name="proposalStatus" value="" assignTo="{!proposalStatus}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <!-- MRS-7094 -->
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <apex:actionFunction name="changeProposalStatusAndSaveRowPositions" action="{!changeProposalStatus}" reRender="reasonInputNotificationPanel, step1, step4, footer, header, mainform, msgs" oncomplete="billingCompanyEnableEditing({!proposal.Primary_Client_is_Billing_Client__c});" status="overlay">
        <apex:param name="proposalStatus" value="" assignTo="{!proposalStatus}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <!-- MRS-7094 -->
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <apex:actionFunction name="sendToClientAndSaveRowPositions" action="{!changeProposalStatus}" reRender="reasonInputNotificationPanel, step1, step4, cannotSendToClientPanel, footer, header, mainform, msgs" oncomplete="billingCompanyEnableEditing({!proposal.Primary_Client_is_Billing_Client__c}); if( {!showAdditionalToCcMessage} || $('.errorM3[role=alert] span').length != 0 ) { hideOverlay(); } else { prepareAndSendProposalPdf(''); }">
        <apex:param name="proposalStatus" value="" assignTo="{!proposalStatus}"/>
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="emailType" value="" assignTo="{!emailType}"/>
        <apex:param name="doCompletenessChecks" value="" assignTo="{!doCompletenessChecks}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <!-- MRS-7094 -->
        <apex:param name="primaryCInstructions" value="" assignTo="{!primaryCInstructions}"/>
        <apex:param name="billingCInstructions" value="" assignTo="{!billingCInstructions}"/>
        <apex:param name="accountingCInstructions" value="" assignTo="{!accountingCInstructions}"/>
        <apex:param name="buildingInstructions" value="" assignTo="{!buildingInstructions}"/>
        <apex:param name="billingInstructions" value="" assignTo="{!billingInstructions}"/>
      </apex:actionFunction>
      <apex:actionFunction name="reSendProposalPdf" action="{!reSendPdf}" reRender="step1, step4, cannotSendToClientPanel, msgs" oncomplete="if( {!showAdditionalToCcMessage} || $('.errorM3[role=alert] span').length != 0 ) { hideOverlay(); } else { prepareAndSendProposalPdf(''); }">
        <apex:param name="emailType" value="" assignTo="{!emailType}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
		<apex:param name="isFollowUp" value="" assignTo="{!isFollowUp}"/> <!-- MRS 7406 -->
      </apex:actionFunction>
      <apex:actionFunction name="prepareAndSendProposalPdf" action="{!prepareProposalPdf}" reRender="msgs" oncomplete="if( $('.errorM3[role=alert] span').length != 0 ) { hideOverlay(); } else { sendProposalPdf( changeOrderId, getFormPosition(), emailType == 'Email (Follow Up)' ); }"> <!-- MRS 7406 -->
        <apex:param name="changeCoStatusCoId" value="" assignTo="{!changeCoStatusCoId}"/>
      </apex:actionFunction>
      <apex:actionFunction name="sendProposalPdf" action="{!sendProposalPdf}" reRender="step1, recipientsPanel, notesRightOutputPanel, msgs" oncomplete="setTimeout( hideOverlay(), 5000);">
        <apex:param name="changeCoStatusCoId" value="" assignTo="{!changeCoStatusCoId}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
		<apex:param name="isFollowUp" value="" assignTo="{!isFollowUp}"/> <!-- MRS 7406 -->
      </apex:actionFunction>
      <apex:actionFunction name="createMI3Project" action="{!createMI3Project}" reRender="footer, header, mainform, msgs" oncomplete="if( $('.errorM3[role=alert] span').length == 0 ) { createMI3ProjectStage2(); } else { hideOverlay(); }">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>
      <apex:actionFunction action="{!createMI3ProjectStage2}" name="createMI3ProjectStage2" reRender="footer, header, mainform, msgs" oncomplete="hideOverlay();"/>
      <apex:actionFunction name="assignCZAnalyst" action="{!assignCZAnalyst}" status="overlay" reRender="footer, header, mainform, assignCZAnalystButton, addNewServiceOutputPanel, completeButton, notesRightOutputPanel, msgs">
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>
      <apex:actionFunction name="populateServicesFromStepTwo" action="{!populateServicesFromStepTwo}" reRender="footer, header, mainform, msgs, confirmServiceTune, rightPanel" status="overlay">
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>
      <apex:actionFunction name="sendToCZSpecialist" action="{!sendToCZSpecialist}" reRender="footer, header, mainform, msgs, confirmServiceTune" status="overlay">
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>
      <apex:actionFunction name="skipSendingToCZSpecialist" action="{!skipSendingToCZSpecialist}" reRender="notesRightOutputPanel, footer, header, mainform, msgs, confirmServiceTune" status="overlay" oncomplete="currentStep = {!proposal.Step__c}; if( currentStep != 2 ) { $('#submitButton').hide(); }"> <!-- MRS 6835 -->
        <apex:param name="formPosition" value="" assignTo="{!formPosition}"/>
      </apex:actionFunction>
      <apex:actionFunction name="saveNotes" action="{!saveNotes}" reRender="footer, header, mainform, msgs, notesRightOutputPanel" status="overlay">
        <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
        <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
        <apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
      </apex:actionFunction>
    </span>
    <apex:actionStatus id="overlay" onstart="showOverlay();" onstop="hideOverlay();"/>
    <apex:actionStatus id="rightOverlay" onstart="showRightOverlay();" onstop="hideRightOverlay();"/>


    <!-- MRS 6860 -->
    <div id="purchaseOrderAddModDiv" class="purchaseOrderAddModDiv" style="height: 88%;"> <!-- Pop up window for Add/Modify POs  -->
      <!-- Overlay effect section -->
      <div class="overlay" id="transparentOverlayOverAddingPOPopUp" style="opacity: 0.2; filter:alpha(opacity=20); z-index: 1003; width: 99%; height: 99%;"></div>
      <div class="overlayContent" id="overlayContentOverAddingPOPopUp" style="display:none; opacity:0.2; filter:alpha(opacity=20); padding: 15px 30px; border-radius: 10px; border: 2px solid #24A; background-color: #E0F2FF; top: 35%; z-index: 1003;">
        <div style="text-align: center; z-index: 1003;">
          <img src="{!URLFOR($Resource.ProposalWizardResources, 'img/WaitAnimation.gif')}" />
          <div style="color: #038; margin-bottom: 0px; font-size: 24px; padding-top: 10px; cursor: default; z-index: 1003;">Please wait</div>
        </div>
      </div>
      <!-- Add/Modify Purchase Order Panel -->
      <apex:outputPanel layout="block" id="purchaseOrderOutputPanel" style="display: block; height: 100%;">
        <table class="generalTableStyle" style="height: 100%; width: 100%; border-collapse: collapse; margin-bottom: 0px;">
          <tbody>
            <tr style="height: 60%;">
              <td style="width: 25%; height: 60%; vertical-align: top; background-color: #F8F8F8; padding: 0px; border: 2px solid #3887A8;"> <!-- Existing Purchase Order SECTION -->
                <div style="height: 100%; overflow: auto;">
                  <table style="width: 100%; padding: 0px; margin: 0px; border-collapse: collapse;">
                    <tr>
                      <th colspan="4" class="pbTitle"> <!-- MRS 7364 -->
                        <h2 class="mainTitle">Existing Purchase Orders</h2>
                      </th>
                    </tr>
                    <tr> <!-- MRS 7104 -->
                      <th>PO#</th>
                      <th>Created Date</th>
					  <th>Unallocated<br/>Service<br/>Balance</th> <!-- MRS 7364 -->
                      <th>Action</th>
                    </tr>
                    <apex:repeat value="{!sortedPurchaseOrdersByCreatedDateDESC}" var="purchaseOrder">
                      <tr>
                        <td>
                            <apex:outputLink value="/{!purchaseOrder.Id}" target="_blank"> <!-- MRS 7192 -->
                                {!existingPurchaseOrders[purchaseOrder.Id].Name}
                            </apex:outputLink>
                        </td>
                        <td> <!-- MRS 7046 -->
                          <apex:outputText value="{0,date,MM/dd/yyyy}">
                            <apex:param value="{!existingPurchaseOrders[purchaseOrder.Id].CreatedDate}"/>
                          </apex:outputText>
                        </td>
						<td style="text-align: right;"> <!-- MRS 7364 -->
							{!existingPurchaseOrders[purchaseOrder.Id].Unallocated_Balance_Services__c}
						</td>
                        <td>
                          <apex:commandLink value="Edit" onclick="showOverlay(); updatePurchaseOrderAction('{!purchaseOrder.Id}'); return false;"/>
                          <span style="color:#888;">&nbsp;|&nbsp;</span>
                          <apex:commandLink value="Delete" onclick="if(confirm('Are you sure that you want to delete this PO ?')) { showOverlay(); deletePurchaseOrderAction('{!purchaseOrder.Id}'); } return false;"/>
                        </td>
                      </tr>
                    </apex:repeat>
                  </table>
                </div>
              </td>
              <td style="width: 25%; height: 60%; vertical-align: top; background-color: #F8F8F8; padding: 0px; border: 2px solid #3887A8;"> <!-- Edit / Create Purchase Orders SECTION-->
                <div style="height: 100%; overflow: auto;">
                  <table class="detailList purchaseOrderMainTable" style="width: 100%; padding: 0px; margin: 0px; border-collapse: collapse;">
                    <tr>
                      <th colspan="2" class="pbTitle">
                        <h2 class="mainTitle">{!editPurchaseOrderBlockTitle}</h2>
                      </th>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">PO #:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                        <apex:inputField value="{!currentPurchaseOrder.Name}" style="width: 100%; box-sizing: border-box;"/>
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">PO Amount:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                        <apex:inputField id="purchaseOrderAmountJQ" value="{!currentPurchaseOrder.Purchase_Order_Amount__c}" style="width: 100%; box-sizing: border-box;" onchange="handlePurchaseOrderCheckboxes();"/>
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">Services:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">  <!-- MRS 7192 -->
                        <apex:inputField id="purchaseOrderServicesJQ" value="{!currentPurchaseOrder.Services__c}" style="width: 100%; box-sizing: border-box;" onFocus="this.priorValue=this.value;" onChange="if( parseFloat(this.value) >= 0 || this.value == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; } handlePurchaseOrderCheckboxes();"/> <!-- MRS 7383 -->
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">Municipal Fees:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">  <!-- MRS 7192 -->
                        <apex:inputField id="purchaseOrderMunicipalFeesJQ" value="{!currentPurchaseOrder.Municipal_Fees__c}" style="width: 100%; box-sizing: border-box;" onFocus="this.priorValue=this.value;" onChange="if( parseFloat(this.value) >= 0 || this.value == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; } handlePurchaseOrderCheckboxes();"/> <!-- MRS 7383 -->
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">Reimbursables:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputField id="purchaseOrderReimbursablesJQ" value="{!currentPurchaseOrder.Reimbursables__c}" style="width: 100%; box-sizing: border-box;" onFocus="this.priorValue=this.value;" onChange="if( parseFloat(this.value) >= 0 || this.value == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; } handlePurchaseOrderCheckboxes();"/> <!-- MRS 7383 -->
                        <apex:inputField id="purchaseOrderReimbursablesOriginalJQ" value="{!currentPurchaseOrder.Reimbursable_Billing__c}" style="display: none;"/>
                        <apex:inputField id="purchaseOrderProcessingFeeOriginalJQ" value="{!currentPurchaseOrder.Check_Processing_Fee_billing__c}" style="display: none;"/>
                        <apex:inputField id="purchaseOrderServiceBillingJQ" value="{!currentPurchaseOrder.Service_Billing__c}" style="display: none;"/>
                        <apex:inputField id="purchaseOrderMunicipalFeesBillingJQ" value="{!currentPurchaseOrder.Municipal_Fees_Billing__c}" style="display: none;"/>
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">PO Issue Date:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                        <apex:inputField value="{!currentPurchaseOrder.Purchase_Order_Date__c}" style="width: 70px;" />
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">Revision Date:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputField value="{!currentPurchaseOrder.Revision_Date__c}" style="width: 70px;" />
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">PO Expiration Date:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputField value="{!currentPurchaseOrder.PO_Expiration_Date__c}" style="width: 70px;" />
                      </td>
                    </tr>
                    <tr>  <!-- MRS 7046 -->
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">Created By:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;"> <!-- MRS 7104 -->
                        <apex:inputField value="{!currentPurchaseOrder.CreatedById}" style="width: 70px;" rendered="{!!ISBLANK(currentPurchaseOrder.CreatedById)}"/>
                        <apex:outputText value="{!$User.FirstName + ' ' + $User.LastName}" rendered="{!ISBLANK(currentPurchaseOrder.CreatedById)}"/>
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label class="labelText" style="font-size: 92%;">PO Notes:</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputField value="{!currentPurchaseOrder.Notes__c}" style="width: 100%; resize: vertical; height: 76px; box-sizing: border-box;" /> <!-- MRS 7046 -->
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label for="ProposalWizardPage:theForm:Blanket_PO__c" class="labelText" style="font-size: 92%;">Blanket PO</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputCheckbox value="{!currentPurchaseOrder.Blanket_PO__c}" id="Blanket_PO__c" onclick="showRightOverlay(); blanketPOAction();" />
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label for="ProposalWizardPage:theForm:Received_and_Verified__c" class="labelText" style="font-size: 92%;">Received and Verified</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputCheckbox value="{!currentPurchaseOrder.Received_and_Verified__c}" id="Received_and_Verified__c" />
                      </td>
                    </tr>
                    <tr>
                      <td class="labelCol" style="border-right: none; border-bottom: 1px solid #DDD; padding-right: 10px; text-align: right; border-top: none;">
                        <label for="ProposalWizardPage:theForm:Reimbursables_Only__c" class="labelText" style="font-size: 92%;">Reimbursables Only</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: 1px solid #DDD; border-top: none;">
                        <apex:inputCheckbox value="{!currentPurchaseOrder.Reimbursables_Only__c}" id="Reimbursables_Only__c" />
                      </td>
                    </tr>
					<tr> <!-- MRS 6205 -->
                      <td class="labelCol" style="border-right: none; border-bottom: none; padding-right: 10px; text-align: right; border-top: none;">
                        <label for="ProposalWizardPage:theForm:PO_Excludes_Sales_Tax__c" class="labelText" style="font-size: 92%;" title="Select this option if the client will pay for the sales tax, but does not include the tax value in their PO.">PO Excludes Sales Tax</label>
                      </td>
                      <td class="data2Col" style="border-left: none; border-bottom: none; border-top: none;">
                        <apex:inputCheckbox value="{!currentPurchaseOrder.PO_Excludes_Sales_Tax__c}" id="PO_Excludes_Sales_Tax__c" title="Select this option if the client will pay for the sales tax, but does not include the tax value in their PO." onclick="handlePurchaseOrderCheckboxes();"/>
                      </td>
                    </tr>
                  </table>
                </div>
              </td>
              <td rowspan="2" style="border: 2px solid #3887A8; padding: 0px; vertical-align: top; border: none !important;"> <!-- List of Service Items + Errors SECTIONs -->
                <div class="apexp individualPalette Custom43Block bPageBlock apexDefaultPageBlock secondaryPalette" style="display: block; height: 99.2%; box-sizing: border-box; position: relative; border: none !important;">
                  <apex:pageMessages id="purchaseOrderMessagesJQ"/>
                  <!-- Error Messages Sub-SECTION -->
                  <span style="display: none;" id="purchaseOrderAmountIsEmptyMessageJQ">
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>Please enter the Purchase Order Amount.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>
                  <span style="display: none;" id="purchaseOrderAmountExceededMessageJQ">
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>Total services price can not exceed Purchase Order Amount.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>
                  <span style="display: none;" id="purchaseOrderReimbursableNotZeroIfPONotRequiredMessageJQ">
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>If the "PO Not Required for Reimbursables" is checked non-zero value of Reimbursables or Municipal Fees is not allowed.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>
                  <span style="display: none;" id="purchaseOrderAmountNotEqualsServicesAndReimbusebles"> <!--  MRS 7192 -->
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>Sum of Services and Reimbursables has to be equal Purchase Order Amount.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>
                  <span style="display: none;" id="purchaseOrderTotalMunicipalFeesIsMoreThanBilledMulicipalFees"> <!--  MRS 7297 -->
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>There are already more municipal fees linked to this PO than the Municipal Fees amount.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>
                  <span style="display: none;" id="totalServicesMoreThanPOServices">
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>There are already more services linked to this PO than the Services amount.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>
                  <span style="display: none;" id="totalReimbursablesMoreThanPOReimbursables">
                    <div class="message errorM3">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tbody>
                          <tr valign="top">
                            <td>
                              <img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/>
                            </td>
                            <td class="messageCell">
                              <div class="messageText">
                                <span style="color:#cc0000">
                                  <h4>Error:</h4>
                                </span>There are already more reimbursables linked to this PO than the Reimbursables amount.<br/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </span>

                  <!-- List of Service Items Sub-SECTION -->
                  <div id="listOfPOServicesAddModifyJQ" class="pbBody" style="vertical-align: top;">
                    <table style="height: 100%; border-collapse: collapse; border: none;">
                      <tr>
                        <td colspan="2" style="height: 100%; padding: 0px; border: none;">
                          <div style="height: 100%; overflow: auto; width: 100%; margin: 0px;">
                            <table style="width: 100%; padding: 0px; margin: 0px; border-collapse: collapse; border: none;" id="purchaseOrderServicesTableJQ" styleClass="dataTable">
                              <thead> <!-- MRS 7046 -->
                                <tr id="purchaseOrderServicesTableHeaderJQ">
                                  <th><img src="/img/checkbox_checked.gif" title="Select All Unlinked Services" onclick="showOverlay(); addAllServicesToPurchaseOrder();"/></th>
                                  <th><div style="padding-left: 14px">PS#</div></th>
                                  <th><div style="padding-left: 14px">Service Name</div></th>
                                  <th><div style="padding-left: 14px">Service<br/>Price</div></th>
                                  <th><div style="padding-left: 14px">PO#</div></th>
                                  <th><div style="padding-left: 14px">Svc<br/>Grp</div></th>
                                  <th><div style="padding-left: 14px">Job#</div></th>
                                  <th><div style="padding-left: 14px">Source</div></th>
                                </tr>
                              </thead>
                              <tbody> <!-- MRS 7046 -->
                                <apex:repeat value="{!pwm.serviceModels}" var="poServiceModelId">
                                  <tr style="display: {!IF( pwm.serviceModels[poServiceModelId].isAlternative || ( pwm.serviceModels[poServiceModelId].changeOrderId != null && ( ( pwm.serviceModels[poServiceModelId].isAmendmendDeleted && pwm.changeOrderModelMap[pwm.serviceModels[poServiceModelId].changeOrderId].status == 'Change Order Approved' ) || ( !pwm.serviceModels[poServiceModelId].isOriginal && !pwm.serviceModels[poServiceModelId].isAmendmendDeleted && pwm.changeOrderModelMap[pwm.serviceModels[poServiceModelId].changeOrderId].status != 'Change Order Approved' && pwm.serviceModels[poServiceModelId].serviceItemRecord.Quantity_Old__c == 0 ) || ( pwm.changeOrderModelMap[pwm.serviceModels[poServiceModelId].changeOrderId].status == 'Canceled' ) ) || ( pwm.serviceModels[poServiceModelId].changeOrderId != null && pwm.changeOrderModelMap[pwm.serviceModels[poServiceModelId].changeOrderId].status != 'Change Order Approved' ) ), 'none', 'table-row' )};"> <!-- MRS 7073 -->
                                    <td style="border-left: none;" width="1%">
                                      <apex:inputCheckbox value="{!pwm.serviceModels[poServiceModelId].isAddedToPurchaseOrder}" id="serviceItemRowJQ" disabled="{!currentPurchaseOrder.Blanket_PO__c}" onclick="handlePurchaseOrderCheckboxes();"/>
                                    </td>
                                    <td width="15%">
                                      <span>{!serviceInfo[poServiceModelId].Name}</span>
                                    </td>
                                    <td width="49%">
                                      <span>{!serviceInfo[poServiceModelId].Service_Name_Full__c}</span>
                                    </td>
                                    <td style="border-right: none;" width="5%">
                                      <span class="purchaseOrderServicePriceJQ">{!ROUND(pwm.serviceModels[poServiceModelId].totalDiscountedServicePrice, 2)}</span>
                                    </td>
                                    <td width="10%">
                                      <span>{!pwm.serviceModels[poServiceModelId].purchaseOrderNumber}</span>
                                    </td>
                                    <td width="5%">
                                      <span>{!serviceInfo[poServiceModelId].Service_Group__c}</span>
                                    </td>
                                    <td width="5%">
                                      <span>{!serviceInfo[poServiceModelId].Municipal_Agency_ID__c}
                                      </span>
                                    </td>
                                    <td width="5%">
                                      <span>
                                        {!IF( serviceInfo[poServiceModelId].Original__c, 'Proposal', IF( serviceInfo[poServiceModelId].Change_Order_Old__c != null, 'CO' + TEXT( serviceInfo[poServiceModelId].Change_Order_Old__r.Number__c ), 'CO' + TEXT( serviceInfo[poServiceModelId].Change_Order__r.Number__c ) ) )}
                                      </span>
                                    </td>
                                    <td style="border-right: none; display: none;" width="5%">
                                      <span class="purchaseOrderServicePriceTaxJQ">{!ROUND(pwm.serviceModels[poServiceModelId].salesTax, 2)}</span>
                                    </td>
                                  </tr>
                                </apex:repeat>
                              </tbody>
                            </table>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td colspan="2" class="footer" style="padding-right: 50px; border-right: none; border-left: none;">
                          Total Services Price:&nbsp;<span style="margin-left: 10px; color: #000000;" id="purchaseOrderTotalServicePriceJQ">0.00</span>
                        </td>
                      </tr>
                    </table>
                    <script type="text/javascript">
                      handlePurchaseOrderCheckboxes();
                    </script>
                  </div>
                  <style> /* MRS 7046 */
                    #purchaseOrderServicesTableJQ thead tr th.header {
                      background-image: url('{! URLFOR($Resource.DataTables, 'DataTables-1.9.4/media/images/sort_both.png') }');
                      background-repeat: no-repeat;
                    }
                    #purchaseOrderServicesTableJQ thead tr th.headerSortUp {
                      background-image: url('{! URLFOR($Resource.DataTables, 'DataTables-1.9.4/media/images/sort_desc.png') }');
                      background-repeat: no-repeat;
                    }
                    #purchaseOrderServicesTableJQ thead tr th.headerSortDown {
                      background-image: url('{! URLFOR($Resource.DataTables, 'DataTables-1.9.4/media/images/sort_asc.png') }');
                      background-repeat: no-repeat;
                    }
                  </style>
                  <script>
                    $( function() {
                      $('#purchaseOrderServicesTableJQ').tablesorter( {
                        headers: {
                          0: { sorter: false  }, 1: { sorter: "text"  }, 2: { sorter: "text" }, 3: { sorter: "digit" },
                          4: { sorter: "text" }, 5: { sorter: "digit" }, 6: { sorter: "text" }, 7: { sorter: "text"  }
                        },
                        sortList: [0, 0]
                      } );
                    } );
                  </script>
                  <!-- Buttons Purchasing Order Section -->
                  <div style="text-align: center; height: 35px; position: absolute; bottom: 0; width: 100%">
                    <div style="text-align: center;">
                      <apex:commandButton id="btnSavePurchaseOrderJQ" value="{!addPurchaseOrderButtonTitle}" onclick="showOverlay(); savePurchaseOrder(); return false;"/> <!--MRS 7192-->
                      <apex:commandButton id="btnSaveAndNewPurchaseOrderJQ" value="{!addAndNewPurchaseOrderButtonTitle}" onclick="saveAndNewPurchaseOrderAction();" reRender="none"/>
                      <apex:commandButton value="Cancel" onclick="$('#purchaseOrderAddModDiv').toggle(); showOverlay(); cancelPurchaseOrder(); return false;"/>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="2" style="vertical-align: top; background-color: #F8F8F8; padding: 0px; border: 2px solid #3887A8;"> <!-- documents Uploader Section -->
                <div style="height: 100%; overflow: auto; vertical-align: top;">
                  <table style="width: 100%; height: 100%; padding: 0px; margin: 0px; border-collapse: collapse;">
                    <tr>
                      <th style="height: 14px;">
                        <h2 class="mainTitle">Upload Files</h2>
                      </th>
                    </tr>
                    <tr>
                      <td style="padding: 0px; vertical-align: top; margin: 0px; border: none;">
                        <apex:outputPanel layout="block" id="purchaseOrderUploadManager" style="height: 100%; margin: 0px; padding-top: 5px; overflow: auto; box-sizing: border-box;">
                            <apex:iframe scrolling="true" height="100%" src="{!purchaseOrderStorageIframe}"/>
                        </apex:outputPanel>
                      </td>
                    </tr>
                  </table>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </apex:outputPanel>
    </div>

    <!-- MRS 7056 -->
    <style type="text/css">
      .showSettingNonBillableReasonWnd {
        background-color: #E0F0F9;
        z-index: 1002;
        display: none;
        position:fixed;
        left:25%;
        top:25%;
        opacity:1.0;
        width: 90%;
        height: 80%;
        overflow: auto;
        border-radius: 5px 5px 5px 5px;
        box-shadow: 5px 5px 30px 5px rgba(0,0,0,0.71);
        padding: 5px;
        border: none;
      }
    </style>

    <!-- MRS 7280 7357 7371 Proposal will be switched to Optimal View Mode -->
    <apex:actionFunction name="saveProposalAndSetOptViewMode" action="{!saveProposalAndSetOptViewMode}" reRender="none">
        <apex:param id="viewStateValue" name="viewStateValue" assignTo="{!proposal.Percents_View_State__c}" value=""/>
		<apex:param id="Hide_Canceled_Change_Orders__c" name="optView_Hide_Canceled_Change_Orders__c" assignTo="{!proposal.optView_Hide_Canceled_Change_Orders__c}" value=""/>
		<apex:param id="Hide_Completed_Services__c" name="optView_Hide_Completed_Services__c" assignTo="{!proposal.optView_Hide_Completed_Services__c}" value=""/>
		<apex:param id="Hide_Inactive_Services__c" name="optView_Hide_Inactive_Services__c" assignTo="{!proposal.optView_Hide_Inactive_Services__c}" value=""/>
		<apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
    </apex:actionFunction>
    <div id="proposalToOptimalViewArea" class="showSettingNonBillableReasonWnd" style="left:30%; top:30%; height: 40%; width: 40%">
        <apex:outputPanel >
		<table style="height: 100%; width: 100%;">
			<tr>
				<td>
					<div>
						<p style="text-align: center;"><span style="font-size:13px;"><strong>The ViewState of current Proposal has reached allowed {!proposal.optView_Percents_Limit__c}%.</strong></span></p>
						<p style="text-align: center;"><strong><span style="font-size:13px;">Please select the elements that can be temporarily hidden.</span></strong></p>
						<p style="text-align: center; margin-bottom: 0px;"><strong><span style="font-size:13px;">Proposal will be displayed in Optimal View.</span></strong></p>
					</div>
				</td>
			</tr>
			<tr>
				<td>
                <div style="display:flex;justify-content:center;align-items:center;">
                    <table>
                        <tr>
                            <td style="width: 100%;">
                                <apex:inputField id="optView_Hide_Canceled_Change_Orders__c" value="{!proposal.optView_Hide_Canceled_Change_Orders__c}"/>
                                <label for="ProposalWizardPage:theForm:optView_Hide_Canceled_Change_Orders__c" class="labelText">Hide Canceled COs</label>
                            </td>
						</tr>
						<tr>
                            <td style="width: 100%;">
                                <apex:inputField id="optView_Hide_Completed_Services__c" value="{!proposal.optView_Hide_Completed_Services__c}"/>
                                <label for="ProposalWizardPage:theForm:optView_Hide_Completed_Services__c" class="labelText">Hide Completed Services</label>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 100%;">
                                <apex:inputField id="optView_Hide_Inactive_Services__c" value="{!proposal.optView_Hide_Inactive_Services__c}"/>
                                <label for="ProposalWizardPage:theForm:optView_Hide_Inactive_Services__c" class="labelText">Hide Deleted Services</label>
                            </td>
                        </tr>
                    </table>
                </div>
				</td>
			</tr>
			<tr>
			<td>
	            <div style="text-align: center;"> <!-- style="position: absolute; right:0px; bottom:0px; left: 0px; height: 35px; text-align: center;" -->
                <apex:commandButton value="Save" onclick="changeToOptimalMode(); return false;" reRender="none"/>
				<apex:commandButton value="Cancel" onclick="cancelChangeToOptimalMode(); return false;" reRender="none"/>
            </div>
			</td>
			</tr>
			</table>

        </apex:outputPanel>
    </div>
    <apex:actionFunction name="saveOptimalViewSettings" action="{!saveProposalAndSetOptViewMode}" reRender="none">
		<apex:param name="currentStep" value="" assignTo="{!currentStep}"/>
	</apex:actionFunction>	
    <div id="proposalEditOptimalViewArea" class="showSettingNonBillableReasonWnd" style="left:40%; top:37%; height: 26%; width: 20%">
        <apex:outputPanel >
            <div style="width: 100%; height: 85%; overflow: auto;">
                <br/>
                <p style="text-align: center;"><span style="font-size:14px;"><strong>Modify Optimal View</strong></span></p>
                <div style="display:flex;justify-content:center;align-items:center;">
                    <table>
                        <tr>
                            <td style="width: 100%;">
                                <apex:inputCheckBox id="editOptView_Hide_Canceled_Change_Orders__c" value="{!proposal.optView_Hide_Canceled_Change_Orders__c}"/>
                                <label for="ProposalWizardPage:theForm:editOptView_Hide_Canceled_Change_Orders__c" class="labelText">Hide Canceled COs</label>
                            </td>
						</tr>
						<tr>
                            <td style="width: 100%;">
                                <apex:inputCheckBox id="editOptView_Hide_Completed_Services__c" value="{!proposal.optView_Hide_Completed_Services__c}"/>
                                <label for="ProposalWizardPage:theForm:editOptView_Hide_Completed_Services__c" class="labelText">Hide Completed Services</label>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 100%;">
                                <apex:inputCheckBox id="editOptView_Hide_Inactive_Services__c" value="{!proposal.optView_Hide_Inactive_Services__c}"/>
                                <label for="ProposalWizardPage:theForm:editOptView_Hide_Inactive_Services__c" class="labelText">Hide Deleted Services</label>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div style="position: absolute; right:0px; bottom:0px; left: 0px; height: 35px; text-align: center;">
				<apex:commandButton value="Save" onclick="$('[id$=proposalEditOptimalViewArea').toggle(); saveOptimalViewSettings(currentStep); return false;" reRender="none"/>
                <apex:commandButton value="Cancel" onclick="rollBackValuesOptimalDialog(); $('[id$=proposalEditOptimalViewArea').toggle(); hideOverlayNoWheel(); return false;" reRender="none"/>
            </div>
        </apex:outputPanel>
    </div>
    
    <div id="showSettingNonBillableReasonWnd" class="showSettingNonBillableReasonWnd" style="height: 50%; width: 50%">
      <apex:outputPanel >
        <apex:selectList style="width: 100%; height: 85%" value="{!reasonForNonPayable}">
          <apex:selectOptions value="{!optionsForNonPayableReasons}">
          </apex:selectOptions>
        </apex:selectList>
        <div style="position: absolute; right:0px; bottom:0px; left: 0px; height: 35px; text-align: center;">
            <apex:commandButton value="Confirm Selection" onclick="$('#showSettingNonBillableReasonWnd').toggle(); hideOverlay(); setSelectedReasonToSelectedServiceItems()" reRender="none" />
            <apex:commandButton value="Cancel Selection" onclick="$('#showSettingNonBillableReasonWnd').toggle(); hideOverlay();" reRender="none"/>
        </div>
      </apex:outputPanel>
    </div>

    <div class="overlayHolder" style="position: relative; overflow: initial; -webkit-overflow-scrolling: touch;">
      <div class="overlay" id="transparentOverlay" style="opacity: 0.2; filter:alpha(opacity=20);"></div>
      <div class="overlayContent" id="overlayContent" style="display:none; opacity:0.2; filter:alpha(opacity=20); padding: 15px 30px; border-radius: 10px; border: 2px solid #24A; z-index: 1001; background-color: #E0F2FF; top: 35%;">
        <div style="text-align: center;">
          <img src="{!URLFOR($Resource.ProposalWizardResources, 'img/WaitAnimation.gif')}" />
          <div style="color: #038; margin-bottom: 0px; font-size: 24px; padding-top: 10px; cursor: default;">Please wait</div>
        </div>
      </div>

      <table cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed;">
        <tr>
          <td style="width: 69%; vertical-align: top;">
            <!-- header -->
            <apex:outputPanel layout="block" id="header">
              <div class="header">
                <div class="innerpadding">
                  <div onclick="goToStep(1); return false;" class="stepHolder step1Normal" style="display: {!IF(proposal.Step__c != 1, 'block', 'none')};">
                    <div class="step">
                      <div class="nodownarrow">Step 1:<br/>Project Information</div>
                    </div>
                  </div>
                  <div class="stepHolder step1Blue" style="display: {!IF(proposal.Step__c == 1, 'block', 'none')};">
                    <div class="step blue">
                      <div class="downarrow">Step 1:<br/>Project Information</div>
                    </div>
                  </div>
                    <div class="blankspace"><div class="arrowholder"><div class="rightarrow"></div></div></div>
                  <div onclick="{!IF(!isMi3, 'goToStep(2);', '')} return false;" class="stepHolder step2Normal" style="display: {!IF(proposal.Step__c != 2, 'block', 'none')};">
                    <div class="{!IF(!isMi3, 'step', 'stepDisabled')}">
                      <div class="nodownarrow">Step 2:<br/>Scope of Work</div>
                    </div>
                  </div>
                  <div class="stepHolder step2Blue" style="display: {!IF(proposal.Step__c == 2, 'block', 'none')};">
                    <div class="step blue">
                      <div class="downarrow">Step 2:<br/>Scope of Work</div>
                    </div>
                  </div>
                    <div class="blankspace"><div class="arrowholder"><div class="rightarrow"></div></div></div>
                  <div onclick="goToStep(3); return false;" class="stepHolder step3Normal" style="display: {!IF(proposal.Step__c != 3, 'block', 'none')};">
                    <div class="step">
                      <div class="nodownarrow">Step 3:<br/>Services and Fees</div>
                    </div>
                  </div>
                  <div class="stepHolder step3Blue" style="display: {!IF(proposal.Step__c == 3, 'block', 'none')};">
                    <div class="step blue">
                      <div class="downarrow">Step 3:<br/>Services and Fees</div>
                    </div>
                  </div>
                    <div class="blankspace"><div class="arrowholder"><div class="rightarrow"></div></div></div>
                  <div onclick="goToStep(4); return false;" class="stepHolder step4Normal" style="display: {!IF(proposal.Step__c != 4, 'block', 'none')};">
                    <div class="step">
                      <div class="nodownarrow">Step 4:<br/>Review and Send</div>
                    </div>
                  </div>
                  <div class="stepHolder step4Blue" style="display: {!IF(proposal.Step__c == 4, 'block', 'none')};">
                    <div class="step blue">
                      <div class="downarrow">Step 4:<br/>Review and Send</div>
                    </div>
                  </div>
                  <!-- <div class="blankspace"></div> -->
                </div>
              </div>
            </apex:outputpanel>
            <apex:pageMessages id="msgs"/>

          </td>

          <td rowspan="2" style="vertical-align: top;">
            <!-- Completeness -->
            <div class="header">
              <div class="innerpadding">
                <div class="completenessholder"><div class="completenesscenter"><div class="completenesstext">
                  <table style="width: 100%"> <!-- MRS 7280 -->
                    <tr colspan="2">
                        <td>Completeness:</td>
                        <td style="font-size: 24px; text-align: center; display: {!IF(isOptimalView, 'block;', 'none;')}" onclick="saveValuesOptimalDialog(); showOverlayNoWheel(); $('[id$=proposalEditOptimalViewArea]').toggle();"><div style="background-color: yellow; width: 180px; border-style: outset;" onmouseover="this.style.background='Khaki'" onmouseout="this.style.background='yellow'"><strong>OPTIMAL VIEW</strong></div></td>
                    </tr>
                  </table>
                  <div class="percentageholder"><div class="percentagebg">
                    <apex:outputPanel id="completeness">
                      <div id="completenessBar" class="percentage" style="width: 0%;"><div class="percentagetextholder"><div id="completenessValue" class="percentagetext"></div></div></div> <!-- MRS 7112 -->
                      <script>
                        recalculateCompleteness();
                      </script>
                    </apex:outputPanel>
                  </div></div>
                </div></div></div>
              </div>
            </div>

            <!-- Right Panel -->
            <div id="rightPanelHolder" class="rightPanelHolder" style="position: relative; overflow: auto; -webkit-overflow-scrolling: touch;"> <!-- MRS 7418 -->
              <div class="overlay" id="transparentRightOverlay" style="opacity: 0.2; filter:alpha(opacity=20);"></div>
              <div class="overlayContent" id="rightOverlayContent" style="left: 22%; display:none; opacity:0.2; filter:alpha(opacity=20); padding: 15px 30px; border-radius: 10px; border: 2px solid #24A; z-index: 1001; background-color: #E0F2FF; top: 35%;">
                <div style="text-align: center;">
                  <img src="{!URLFOR($Resource.ProposalWizardResources, 'img/WaitAnimation.gif')}" />
                  <div style="color: #038; margin-bottom: 0px; font-size: 24px; padding-top: 10px; cursor: default;">Please wait</div>
                </div>
              </div>
              <apex:outputPanel layout="block" id="rightPanel" styleClass="rightPanel" style="display: inline;">
                <apex:outputPanel rendered="{!rightPanelView != 'Notes' && rightPanelView != 'Phase' && rightPanelView != 'Floor' && rightPanelView != 'ServiceItem' && rightPanelView != 'PurchaseOrder' && rightPanelView != 'Reimbursable'}">
                  <div><apex:iframe id="rightPanelFrame" src="{!iFrameRightPageReference}" scrolling="true" height="100"/></div>
                </apex:outputPanel>
                <!-- Service Right Output Panel -->
                <apex:actionStatus id="inlineStatus" onstart="$('.serviceSelectBlock select').css('width', '100%'); $('.inlineStatus').css('display', 'inline-block');" onstop="$('.inlineStatus').css('display', 'none');"/>

                <apex:actionFunction name="addServiceActionSave" action="{!addServiceAction}" reRender="step1, type_In_Work_Type, servicemsgs, changeOrderTables, purchaseOrderOutputPanel, addClientPurchaseOrderButton, saveServiceBundleButton, completeness, footer, servicesRightOutputPanel" oncomplete="if( $('.errorM3[role=alert] span').length != 0 ) { hideRightOverlay(); } else { hideRightOverlay(); cancelAddingNewServices(); }"> <!-- MRS 7335 7368 -->
                  <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
				  <apex:param name="serviceTypeTo" value="" assignTo="{!serviceTypeToAdd}"/>
				  <apex:param name="changeOrderIdTo" value="" assignTo="{!changeOrderIdToAdd}"/>
				  <apex:param name="selectedServiceID" value="" assignTo="{!selectedServiceIDToAdd}"/>
                </apex:actionFunction>
                <apex:actionFunction name="addServiceActionSaveAndNew" action="{!addServiceAction}" reRender="step1, type_In_Work_Type, servicemsgs, changeOrderTables, purchaseOrderOutputPanel, approvedVendorArea ,addClientPurchaseOrderButton, saveServiceBundleButton, completeness, footer" oncomplete="if( $('.errorM3[role=alert] span').length != 0 ) { hideRightOverlay(); } else { hideRightOverlay(); $('[id$=quantityOfServicesToInsert]')[0].value = 1; document.getElementById('nameOfSelectedTemplateSpan').innerHTML = 'Please Select Service From List'; $('[id$=nameOfSelectedTemplateSpan]').attr('style', 'vertical-align: top; font-size: 12px; width: 100%; color: #D44; font-weight: bold;'); $('[id$=defineWorkTypeRow]')[0].style = 'display: none'; $('[id$=servicesRightOutputPanel]').css('z-index', '1002'); changeRightPanelToServiceItem(serviceType, changeOrderId); }"> <!-- MRS 7335 7368-->
                  <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
				  <apex:param name="serviceTypeTo" value="" assignTo="{!serviceTypeToAdd}"/>
				  <apex:param name="changeOrderIdTo" value="" assignTo="{!changeOrderIdToAdd}"/>
				  <apex:param name="selectedServiceID" value="" assignTo="{!selectedServiceIDToAdd}"/>
                </apex:actionFunction>
                <apex:actionFunction name="searchForServiceTemplates" reRender="servicesInternalRightOutputPanel" status="rightOverlay"/> <!-- MRS 7112 -->
                <apex:outputPanel id="servicesRightOutputPanel" styleClass="servicesRightOutputPanel" style="display: none; z-index: 1002; position: relative;"> <!-- MRS 7112 7335 -->
                  <apex:outputPanel id="servicesInternalRightOutputPanel"> <!-- MRS 7112 -->
                  <div class="serviceSelectBlock">
                    <div class="apexp"> <!-- Add Service to Proposal -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: none !important;">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Add Service to Proposal</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <apex:pageMessages id="servicemsgs"/>
                        <div class="pbBody" style="display: {!IF(proposal.isPhase__c, 'block', 'none')};"> <!-- MRS 7335 -->
                          <div class="pbSubheader brandTertiaryBgr first tertiaryPalette">
                            <h3>Choose Phase:</h3>
                          </div>
                          <div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell">
                                  <label class="labelText">Phase:</label>
                                </td>
                                <td class="dataCol dataCell">
                                  <apex:selectList value="{!selectedPhase}" multiselect="false" size="1" style="width: 100%;" id="Phase__c">
                                    <apex:selectOptions value="{!availablePhases}"/>
                                  </apex:selectList>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                        <div class="pbBody" style="display: block;"> <!-- MRS 7335 -->
                          <div class="pbSubheader brandTertiaryBgr tertiaryPalette">
                            <h3>Service Selection:</h3>
                          </div>
                          <div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr style="display: {!IF(!isSIPSOnly, 'table-row', 'none')};">
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:serviceType" class="labelText">Service Type:</label>
                                </td>
                                <td class="dataCol" style="padding-top: 0px;">
                                  <apex:selectList disabled="{!isRecordTypeSelectionDisabled || isSinglePermit}" size="1" multiselect="false" style="width: 100%;" value="{!serviceTemplateForAddPanel.RecordTypeId}" onchange="populateServiceListFromUserSelection('RecordTypeId');" id="serviceType"> <!-- MRS 7335 -->
                                    <apex:selectOptions value="{!serviceTypeOption}"/>
                                  </apex:selectList>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label class="labelText">Region:</label>
                                </td>
                                <td class="dataCol serviceRegionInput" style="padding-top: 0px;">
                                  <span>{!building.Region__c}</span> <!-- MRS 7335 -->
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:Category__c" class="labelText">Category:</label>
                                </td>
                                <td class="dataCol categoryInput" style="padding-top: 0px;">
                                  <apex:selectList value="{!serviceTemplate.Category__c}" size="1" styleClass="inputFieldExt" id="Category__c" onchange="populateServiceListFromUserSelection('Category__c');" rendered="{!!isSIPSOnly}"/> <!-- MRS 7335 -->
                                  <apex:outputText value="{!serviceTemplate.Category__c}" rendered="{!isSIPSOnly}"/>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:Type__c" class="labelText">Type:</label>
                                </td>
                                <td class="dataCol typeInput" style="padding-top: 0px;">
                                  <apex:selectList value="{!serviceTemplate.Type__c}" onchange="populateServiceListFromUserSelection('Type__c');" size="1" styleClass="inputFieldExt" id="Type__c" rendered="{!!isSIPSOnly}"/> <!-- MRS 7335 -->
                                  <apex:outputText value="{!serviceTemplate.Type__c}" rendered="{!isSIPSOnly}"/>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:Subtype__c" class="labelText">Subtype:</label>
                                </td>
                                <td class="dataCol" style="padding-top: 0px;">
                                  <apex:selectList value="{!serviceTemplate.Subtype__c}" onchange="populateServiceListFromUserSelection('Subtype__c');" size="1" styleClass="inputFieldExt" id="Subtype__c"/> <!-- MRS 7335 -->
                                </td>
                              </tr>
                              <tr id="defineWorkTypeRow" style="display: none;">  <!-- MRS 7335 7368 -->
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:typeInWorkType" class="labelText" style="display: block;">Define the Work Type:</label>
                                </td>
                                <td class="dataCol typeInWorkType" style="padding-top: 0px;">
									<apex:outPutPanel id="type_In_Work_Type">
                                		<apex:inputField id="typeInWorkType" styleClass="appendedServiceNameJQ" value="{!serviceTemplatesForNewServices.Work_Type_CWP_LOC__c}" />
									</apex:outPutPanel>
                                </td>
                              </tr>
                              <tr style="display: {!IF(!isSIPSOnly, 'table-row', 'none')};">
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:Plan_Submission_Type__c" class="labelText">Plan Submission Type:</label>
                                </td>
                                <td class="dataCol planSubmissionTypeInput" style="padding-top: 0px;">
                                  <apex:selectList value="{!serviceTemplate.Plan_Submission_Type__c}" onchange="populateServiceListFromUserSelection('Plan_Submission_Type__c');" size="1" styleClass="inputFieldExt" id="Plan_Submission_Type__c"> <!-- MRS 7335 -->
									<apex:selectOption itemValue="" itemLabel="-- None --"/>
                                  </apex:selectList>
                                </td>
                              </tr>
                              <tr style="display: {!IF(!isSIPSOnly, 'table-row', 'none')};">
                                <td class="dataCol" style="width: 100px; padding-top: 0px;">
                                  <label for="ProposalWizardPage:theForm:workTypeSearchInput" class="labelText">Service Search:</label>
                                </td>
                                <td class="dataCol" style="padding-top: 0px;">
                                  <div>
                                    <apex:inputText value="{!searchField}" style="width: 100%;" styleClass="workTypeSearchInput" id="workTypeSearchInput"/> <!-- MRS 7112 -->
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td colspan="2" style="text-align: center;">
                                    <apex:commandButton value="Search" onclick="populateServiceListFromUserSelection('Search_fild_Action');" reRender="none"/> <!-- MRS 7112 MRS 7335-->
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>

                        <div class="pbBody" style="display: block;"> <!-- Services Select List --> <!-- MRS 7335 --> 
                          <div id="numberOfServicesFound" class="pbSubheader brandTertiaryBgr first tertiaryPalette"/>
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell" style="padding-left: 0px;">
                                    <span id="noServicesFoundSpan" style="display: none; font-size: 12px; width: 100%; color: #D44; font-weight: bold;">No Services Found</span>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <apex:outputPanel id="foundServiceTemplates" style="display: none;">
                                      <table class="generalTableStyle">
                                        <tr>
                                          <td colspan="2">
                                            <div style="max-height: 200px; overflow:auto; width: 100%; margin:0px;">
                                              <table style="width:100%; padding: 0px; margin: 0px; border-collapse: collapse; border: none;" Id="foundServicesesTable"/>
                                            </div>
                                          </td>
                                        </tr>
                                      </table>
                                    </apex:outputPanel>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>

                        <div id="selectedServiceDiv" class="pbBody" style="display: none;"> <!-- MRS 7335 -->
                          <div class="pbSubheader brandTertiaryBgr tertiaryPalette">
                            <h3>Selected Service:</h3>
                          </div>
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span>
                                      <label class="labelText">Service Name:</label>
                                      <div class="inlineStatus" style="display: none;">
                                        <img src="/img/loading32.gif" width="16" height="16"/>&nbsp;
                                      </div>
                                    </span>
                                    <span id="nameOfSelectedTemplateSpan" style="vertical-align: top; font-size: 12px; width: 100%; color: #D44; font-weight: bold;"/> <!-- MRS 7335 -->
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>

                        <div id="approvedVendorArea" class="pbBody" style="display: none;"> <!-- MRS 7335 -->
                          <div class="pbSubheader brandTertiaryBgr tertiaryPalette">
                            <h3>SIPS Service:</h3>
                          </div>
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <div>
                                      <label for="ProposalWizardPage:theForm:approvedVendor" class="labelText">Vendor:</label>
                                    </div>
                                    <div>
                                      <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                      <apex:selectList value="{!selectedVendor}" size="1" styleClass="inputFieldExt" id="approvedVendor" onchange="adjustAccessToButtons(); return false;"> <!-- MRS 7335 -->
                                        <apex:selectOptions value="{!approvedVendorsOptions}"/>
                                      </apex:selectList>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <div>
                                      <label for="ProposalWizardPage:theForm:inspectionTypes" class="labelText">Inspection Types:</label>
                                    </div>
                                    <span>
                                      <div>
                                        <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                        <apex:inputField id="inspectionTypes" value="{!serviceTemplate.Inspection_Type__c}" onchange="adjustAccessToButtons(); return false;"/> <!-- MRS 7335 -->
                                      </div>
                                    </span>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>

                        <div id="quantityOfServicesToIsert" class="pbBody" style="display: none;"> <!-- MRS 7335 -->
                          <div class="pbSubheader brandTertiaryBgr tertiaryPalette">
                            <h3>Number Of Services To Add:</h3>
                          </div>
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <div style="text-align: center; padding-top: 6px; display: inline; padding-right: 5px;">
                                      <label for="ProposalWizardPage:theForm:quantityOfServicesToInsert" class="labelText">Number Of Services:</label>
                                    </div>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <div style="text-align: center; padding-top: 6px; display: inline;">
                                      <apex:inputText value="{!quantityOfServicesToInsert}" id="quantityOfServicesToInsert" style="text-align: center;" onFocus="this.priorValue = this.value;" onChange="if( this.value != '' && this.value.replace(/^([1-9][0-9]{0,2})$/g, '') == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; }">
                                      </apex:inputText>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>

                        <div class="pbBody">
                          <div class="pbSubheader brandTertiaryBgr tertiaryPalette">
                            <h3>Actions:</h3>
                          </div>
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <div style="text-align: center; padding-top: 6px;">
                                      <apex:outputPanel id="serviceRightPannelCommandButtons">
                                        <apex:commandButton id="addServiceBtn" value="Add" styleClass="btnDisabled" onclick="$('#rightPanelHolder').attr('style', $('#rightPanelHolder').attr('style').replace(' z-index: 1002','')); showRightOverlay(); $('[id$=servicesRightOutputPanel]').css('z-index', '0'); $('[id$=Category__c]')[0].value = $('[id$=Type__c]')[0].value = $('[id$=Subtype__c]')[0].value = $('[id$=Plan_Submission_Type__c]')[0].value = null; addServiceActionSave(serializeServices(), serviceType, changeOrderId, selectedServiceID); return false;"/> <!--  MRS 7335 7418 -->
                                        <apex:commandButton id="addAndNewServiceBtn" value="Add and New" styleClass="btnDisabled" onclick="$('#rightPanelHolder').attr('style', $('#rightPanelHolder').attr('style').replace(' z-index: 1002','')); showRightOverlay(); $('[id$=servicesRightOutputPanel]').css('z-index', '0'); addAndNewSiAction = true; tempRecordType = $('[id$=serviceType]')[0].value; tempCategory = $('[id$=Category__c]')[0].value == '-- None --' ? null : $('[id$=Category__c]')[0].value; tempType = $('[id$=Type__c]')[0].value == '-- None --' ? null : $('[id$=Type__c]')[0].value; tempSubtype = $('[id$=Subtype__c]')[0].value == '-- None --' ? null : $('[id$=Subtype__c]')[0].value; tempPlanPermission = $('[id$=Plan_Submission_Type__c]')[0].value == '-- None --' ? null : $('[id$=Plan_Submission_Type__c]')[0].value; $('[id$=Category__c]')[0].value = $('[id$=Type__c]')[0].value = $('[id$=Subtype__c]')[0].value = $('[id$=Plan_Submission_Type__c]')[0].value = null; addServiceActionSaveAndNew(serializeServices(), serviceType, changeOrderId, selectedServiceID); return false;"/> <!--  MRS 7335 7418-->
                                        <apex:commandButton value="Cancel" onclick="cancelAddingNewServices(); return false;"/> <!--  MRS 7335 -->
                                      </apex:outputPanel>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div></div></div>
                    </div>
                  </div>
                  </apex:outputPanel>
                </apex:outputPanel>

                <!-- Add New Reimbursable -->
                <apex:actionFunction name="addReimbursableAction" action="{!addReimbursableAction}" reRender="step3, reimbursablesmsgs, reimbursableRightOutputPanel" oncomplete="if( $('.errorM3[role=alert] span').length != 0 || '{!rightPanelView}' == 'Notes' ) { hideRightOverlay(); } else { changeRightPanelToNotes(); }">
                  <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
                </apex:actionFunction>
                <apex:actionFunction name="addAndNewReimbursableAction" action="{!addAndNewReimbursableAction}" reRender="step3, reimbursablesmsgs, reimbursableRightOutputPanel" oncomplete="hideRightOverlay();">
                  <apex:param name="serviceIdsSerialized" value="" assignTo="{!serviceIdsSerialized}"/>
                </apex:actionFunction>
                <apex:outputPanel id="reimbursableRightOutputPanel">
                  <div style="display: {!IF(rightPanelView == 'Reimbursable', 'block', 'none')};">
                    <div class="apexp">
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Add New Additional Reimbursable</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <apex:pageMessages id="reimbursablesmsgs"/>
                        <div class="pbBody">
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="checkboxLabelText">Description:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker" style="height: 55px;"></div></div>
                                    <apex:inputTextArea value="{!reimbursableToCreate.Description__c}" styleClass="textAreaDesc" style="height: 50px; width: 95%; resize: none;" cols="25" rows="11" id="reimbursable_description"/> <!-- MRS 7098 -->
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="checkboxLabelText">Amount:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <apex:inputField value="{!reimbursableToCreate.Amount__c}" style="width: 150px;" onFocus="this.priorValue = this.value;" onChange="if( this.value.match(/^[+-]?[0-9]{1,9}(?:\.[0-9]{1,2})?$/)) { this.priorValue = this.value; } else { this.value = this.priorValue;}" /> <!-- MRS 6997 -->
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                        <div class="pbBody">
                          <div class="pbSubheader brandTertiaryBgr tertiaryPalette">
                            <h3>Actions:</h3>
                          </div>
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <div style="text-align: center; padding-top: 6px;">
                                      <apex:commandButton value="Add" onclick="showRightOverlay(); addReimbursableAction(serializeServices()); return false;"/>
                                      <apex:commandButton value="Add and New" onclick="showRightOverlay(); addAndNewReimbursableAction(serializeServices()); return false;"/>
                                      <apex:commandButton value="Cancel" onclick="if('{!rightPanelView}' != 'Notes') changeRightPanelToNotes(); return false;"/>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div></div></div>
                    </div>
                  </div>
                  <script type="text/javascript">$('[id$=reimbursable_description]').attr('maxlength', 255);</script> <!-- MRS 7098 -->
                </apex:outputPanel>

				<apex:actionFunction name="cancelAddNewActionFunction" action="{!newPhaseAction}" reRender="step1, moveServicesToPhasesPanel, phasesRightOutputPanel, changeOrderTables, phasemsgs" status="rightOverlay"/> <!-- MRS 7385 -->
                <apex:actionFunction name="savePhaseAction" action="{!savePhaseAction}" reRender="step1, moveServicesToPhasesPanel, phasesRightOutputPanel, changeOrderTables, phasemsgs" oncomplete="if({!isSavePhase}){ cancelAddingPhaseAction(); } disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});" status="rightOverlay"> <!-- MRS 7330 -->
                  <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
                </apex:actionFunction>
                <apex:actionFunction name="newPhaseAction" action="{!savePhaseAction}" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold}); if({!isSavePhase}){ $('[id$=phasesRightOutputPanel]').css('display', 'none'); $('[id$=notesRightOutputPanel]').css('display', 'block'); $('[id$=phaseToCreateName__c]')[0].value = null; $('[id$=phaseToCreateStart_Date__c]')[0].value = null; $('[id$=phaseToCreateEnd_Date__c]')[0].value = null; $('[id$=phasemsgs]').empty(); } showAddNewPhaseAction();" reRender="step1, moveServicesToPhasesPanel, phasesRightOutputPanel, changeOrderTables, phasemsgs" status="rightOverlay"> <!-- MRS 7330 7385 -->
                  <apex:param name="phaseIdsSerialized" value="" assignTo="{!phaseIdsSerialized}"/>
                </apex:actionFunction>

                <apex:outputPanel id="phasesRightOutputPanel" style="display: {!IF(rightPanelView == 'Phase', 'block', 'none')};"> <!-- MRS 7330 7385 -->
                  <div>
                    <div class="apexp"> <!-- Phases Right Panel -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">{!IF(ISBLANK(phaseEditId), 'New Phase', 'Edit Phase')}</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <apex:pageMessages id="phasemsgs" />
                        <div class="pbBody">
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="labelText">Name:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <apex:inputField id="phaseToCreateName__c" value="{!phaseToCreate.Name__c}"> <!-- MRS 7330 -->
                                      <div class="requiredBlockWrapper"><div class="requiredBlockMarker" style="top: -20px;"></div></div>
                                    </apex:inputField>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="labelText">Start Date:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <apex:inputField id="phaseToCreateStart_Date__c" value="{!phaseToCreate.Start_Date__c}"/> <!-- MRS 7330 -->
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="labelText">End Date:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <apex:inputField id="phaseToCreateEnd_Date__c" value="{!phaseToCreate.End_Date__c}"/> <!-- MRS 7330 -->
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                        <div id="phaseButtonsSection" class="pbBottomButtons" style="margin-top: 0px;">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td style="text-align: center; padding-top: 5px; padding-bottom: 5px;" class="pbButtonb">
                                  <apex:commandButton id="saveUpdatePhaseButton" onclick="savePhaseAction(serializePhases()); return false;"/>
                                  <apex:commandButton id="saveAndNewPhaseButton" onclick="newPhaseAction(serializePhases()); return false;" value="Save & New"/>
                                  <apex:commandButton value="Cancel" onclick="cancelAddingPhaseAction(); return null;" reRender="phaseButtonsSection"/> <!-- MRS 7112 7330 7385 -->
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <script>
                            if($('[id$=phaseToCreateName__c]')[0].value.length > 0) { //MRS 7330
                                $('[id$=saveUpdatePhaseButton]').prop('value', 'Update');
                                $('[id$=saveAndNewPhaseButton]').prop('style', 'display: none;');
                            } else {
                                $('[id$=saveUpdatePhaseButton]').prop('value', 'Save');
                                $('[id$=saveAndNewPhaseButton]').prop('style', 'display: inline;');
                            }
                          </script>
                        </div>
                      </div></div></div>
                    </div>
                  </div>
                </apex:outputPanel>

                <apex:outputPanel id="floorsRightOutputPanel" style="display: {!IF(rightPanelView == 'Floor', 'block', 'none')};"> <!-- MRS 7112 -->
                  <div>
                    <div class="apexp"> <!-- Add New Floor -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Add New Floor</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <apex:pageMessages id="floorsmsgs"/>
                        <div class="pbBody">
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="checkboxLabelText">Construction Floor type:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <apex:selectList id="Floor_Type__c" value="{!floorToCreate.Floor_Type__c}" size="1" styleClass="inputPickList" style="margin: 0px;" onchange="changeFloorNumberAndStatus();"> <!-- MRS 7112 7328 -->
                                      <apex:selectOptions value="{!floorTypeOptions}" />
                                    </apex:selectList>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="checkboxLabelText">Construction Floor #:</span>
                                  </td>
                                  <td class="dataCol dataCell" id="floorNumberInputCell">
                                    <span>
                                      <div class="requiredBlockWrapper"><div class="requiredBlockMarker" style="display: {!IF( OR (floorToCreate.Floor_Type__c == 'Mezzanine', floorToCreate.Floor_Type__c == 'Penthouse', floorToCreate.Floor_Type__c == 'Subcellar', floorToCreate.Floor_Type__c == 'Cellar'), 'none !important', 'block')};"></div></div>
                                    </span>
                                    <div style="display: inline;">
                                        <apex:outputPanel id="floorNumberInputCellPanel"> <!-- MRS 7112 MRS 7328 -->
                                            <apex:inputField id="Floor_Number__c" value="{!floorToCreate.Floor_Number__c}" style="width: 150px;" />
                                        </apex:outputPanel>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="checkboxLabelText">Tenant Floor type:</span>
                                  </td>
                                  <td class="dataCol dataCell">
                                    <apex:selectList id="Tenant_Type__c" value="{!floorToCreate.Tenant_Type__c}" size="1" styleClass="inputPickList" style="margin: 0px;" onchange="changeTenantFloorNumberAndStatus();"> <!-- MRS 7112 7328 -->
                                      <apex:selectOptions value="{!tenantFloorTypeOptions}" />
                                    </apex:selectList>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell">
                                    <span class="checkboxLabelText">Tenants Floor #</span>
                                  </td>
                                  <td class="dataCol dataCell" id="tenantNumberInputCell">
                                    <apex:outputPanel id="tenantNumberInputCellPanel"> <!-- MRS 7112 7328 -->
                                        <apex:inputField id="Tenant_Number__c" value="{!floorToCreate.Tenant_Number__c}" style="width: 150px;" />
                                    </apex:outputPanel>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell" colspan="2">
                                    <div style="text-align: center; padding-top: 6px;">
                                      <apex:commandButton value="Add" action="{!saveFloorAndCloseTab}" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});" reRender="step1, selectFloorsForServicesPanel, rightPanel, completeness, footer, floorsmsgs" status="rightOverlay"/>
                                      <apex:commandButton value="Add and New" action="{!saveFloorAndDoNotCloseTab}" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});" reRender="step1, selectFloorsForServicesPanel, rightPanel, completeness, footer, floorsmsgs" status="rightOverlay"/>
                                      <apex:commandButton value="Cancel" action="{!cancelFloorAction}" onclick="cancelAddingFloor(); return false;" rerender="none"/> <!-- MRS 7112 7329 7324-->
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div></div></div>
                    </div>
                  </div>
                </apex:outputPanel>

                <apex:outputPanel id="notesRightOutputPanel" style="display: {!IF(rightPanelView == 'Notes', 'block', 'none')};"> <!-- MRS 7112 -->
                  <div class="rightInfoPanel">
                    <div class="rightInfoNoteHolder">
                      <div class="rightInfoNote">
                        <div class="rightInfoNoteHeader">
                          <div>
                            <div class="rightInfoNoteButtonsHolder">
                              <div class="rightInfoNoteButtons proposalNotePanel" onclick="displayTab('proposalNotePanel');">
                                <div onclick="displayTab('proposalNotePanel');">Proposal Notes</div>
                              </div>
                              <div class="rightInfoNoteButtons buildingNotePanel" onclick="displayTab('buildingNotePanel');">
                                <div onclick="displayTab('buildingNotePanel');">Projects History</div>
                              </div>
                              <div class="rightInfoNoteButtons changeHistoryNotePanel" onclick="displayTab('changeHistoryNotePanel');">
                                <div onclick="displayTab('changeHistoryNotePanel');">Change History</div>
                              </div>
                              <div class="rightInfoNoteButtons assignmentNotePanel" onclick="displayTab('assignmentNotePanel');" style="display: {!IF( ('Awarded' == proposal.Status__c && canShowAssignment), 'table-cell', 'none')};">
                                <div onclick="displayTab('assignmentNotePanel');">Assignment</div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="rightInfoPanelNote">
                          <div class="proposalNotePanel" style="overflow: auto; height: 100%;">
                            <div class="rightInfoCurrentNoteHolder">
                              <div style="height: 75%; background-color: #F8F8F8; overflow: auto;">
                                <apex:outputText value="{!totalNotesText}" escape="false"/>
                              </div>
                              <textarea id="foolChromeAutofillProposalNotes" style="display: none;" name="ProposalWizardPage:theForm:proposalNotes"></textarea>
                              <apex:inputTextArea id="proposalNotes" style="height: 25%;" value="{!noteBody}"/>
                              <script type="text/javascript">
                                $('[id$=proposalNotes]').attr('placeholder', 'Notes');
                              </script>
                            </div>
                          </div>

                          <div class="buildingNotePanel" style="overflow: auto; height: 100%;">
                            <div class="rightInfoCurrentNoteHolder" style="border: none;">
                              <span>
                                <table class="generalTableStyle" style="height: 100%; margin-bottom: 0px;">
                                  <apex:outputPanel layout="none" rendered="{!buildingProjectsData.size > 0}">
                                    <tr style="height: 19px;">
                                      <th style="text-align: center; border: none; border-top: 1px solid #AED4E4;">
                                        Projects that have ever been done on current building
                                      </th>
                                    </tr>
                                    <tr>
                                      <td style="border: none; vertical-align: top; padding: 0;">
                                        <div style="overflow: auto; width: 100%; margin: 0px; display: {!IF(buildingProjectsData.size > 0, 'block', 'none')}; vertical-align: top;">
                                          <table class="changeHistoryTable">
                                            <tr>
                                              <th style="text-align: left; vertical-align: top; border-left: none;"><span style="margin-left: 5px;">Project Number</span></th>
                                              <th style="text-align: left; vertical-align: top; border-right: none;"><span style="margin-left: 5px;">Project Name</span></th>
                                            </tr>
                                            <apex:repeat value="{!buildingProjectsData}" var="projectData">
                                              <tr>
                                                <td style="text-align: left; vertical-align: top;">
                                                  <apex:outputLink value="/{!projectData.recordId}" target="_blank" style="margin-left: 5px; border-left: none;">{!projectData.recordNumber}</apex:outputLink>
                                                </td>
                                                <td style="text-align: left; border-right: none;"><span style="margin-left: 5px;">{!projectData.recordName}</span>
                                                </td>
                                              </tr>
                                            </apex:repeat>
                                          </table>
                                        </div>
                                      </td>
                                    </tr>
                                  </apex:outputPanel>
                                </table>
                              </span>
                            </div>
                          </div>

                          <div class="changeHistoryNotePanel" style="overflow: auto; height: 100%;">
                            <div class="rightInfoCurrentNoteHolder" style="border: none;" Id="changeHistoryNoteHolder">
                              <span>
                                <table class="generalTableStyle">
                                  <tr>
                                    <td class="header" style="text-align: left; width: 15%; border: none;">Date</td>
                                    <td class="header" style="text-align: left; width: 10%; border: none;">Version</td>
                                    <td class="header" style="text-align: left; width: 26%; border: none;">Status</td>
                                    <td class="header" style="text-align: left; width: 24%; border: none;">Change Requestor</td>
                                    <td class="header" style="text-align: left; width: 19%; border: none;">Change Order</td>
                                    <td class="header" style="text-align: left; width: 6%; border: none;">CO#</td>
                                  </tr>
                                  <tr>
                                    <td colspan="6" style="border: none; ">
                                      <div style="overflow: auto; width: 100%; margin: 0px;">
                                        <table class="changeHistoryTable">
                                          <apex:repeat value="{!changeHistory}" var="historyRecord">
                                            <tr>
                                              <td style="border-left: none; border-bottom: none; width: 14%; text-align: left; padding: 0px;">
                                                <apex:outputText value="{0,date,MM/dd/yyyy}" style="padding-left: 2px;">
                                                  <apex:param value="{!historyRecord.Date__c}"/>
                                                </apex:outputText>
                                              </td>
                                              <td style="border-bottom: none; width: 10%; text-align: left; padding: 0px;">
                                                <div style="padding-left: 2px;">{!historyRecord.Version_Text__c}</div>
                                              </td>
                                              <td style="border-right: none; width: 27%; border-bottom: none; text-align: left; padding: 0px;">
                                                <div style="padding-left: 2px;">{!historyRecord.Status__c}</div>
                                              </td>
                                              <td style="border-right: none; width: 25%; border-bottom: none; text-align: left; padding: 0px;">
                                                <div style="padding-left: 2px;">{!historyRecord.User__c}</div>
                                              </td>
                                              <td style="border-right: none; width: 18%; border-bottom: none; text-align: left; padding: 0px;">
                                                <div style="padding-left: 2px;">
                                                  <span style="display: {!IF(historyRecord.Type__c != 'Change Order', 'inline', 'none')};">N/A</span>
                                                  <apex:outputText rendered="{!historyRecord.Type__c == 'Change Order'}" value="{!historyRecord.Link__c}" escape="false"/>
                                                </div>
                                              </td>
                                              <td style="border-right: none; width: 6%; border-bottom: none; text-align: left; padding: 0px;">
                                                <div style="padding-left: 2px;">
                                                  {!IF(historyRecord.Status__c != 'Draft', historyRecord.Change_Order__r.Number__c, '')}
                                                </div>
                                              </td>
                                            </tr>
                                          </apex:repeat>
                                        </table>
                                      </div>
                                    </td>
                                  </tr>
                                </table>
                              </span>
                            </div>
                          </div>

                          <apex:actionFunction name="sortAssignment" reRender="assignmentNotePanel, msgs" status="rightOverlay">
                            <apex:param name="assignmentSortField" value="" assignTo="{!assignmentSortField}"/>
                          </apex:actionFunction>
                          <apex:actionFunction name="sortFrep" reRender="assignmentNotePanel, msgs" status="rightOverlay">
                            <apex:param name="frepSortField" value="" assignTo="{!frepSortField}"/>
                          </apex:actionFunction>

                          <apex:outputPanel id="assignmentNotePanel" layout="block" styleClass="assignmentNotePanel" style="overflow: auto; height: 100%;">
                            <div class="rightInfoCurrentNoteHolder" Id="assignmentHolder" style="overflow: auto; border: none;">
                              <div>
                                <table class="generalTableStyle" style="margin-bottom: 0px;">
                                  <tr>
                                    <th colspan="4" style="text-align: center;">
                                      {!IF(canAssignProjectTeam, 'Project Team Workload', 'Resource Workload')}
                                    </th>
                                  </tr>
                                  <tr>
                                    <th style="text-align: left; white-space: normal; min-width: 85px;">
                                      <a href="#" onclick="sortAssignment('n'); return false;">{!IF(canAssignProjectTeam, 'Team Name', 'Resource Name')}{!IF(assignmentSortField == 'n', assignmentDirectionMark, '')}</a>
                                    </th>
                                    <th style="text-align: left; white-space: normal;">
                                      <a href="#" onclick="sortAssignment('c'); return false;">Client Factor{!IF(assignmentSortField == 'c', assignmentDirectionMark, '')}</a>
                                    </th>
                                    <th style="text-align: left; white-space: normal;">
                                      <a href="#" onclick="sortAssignment('b'); return false;">Building Factor{!IF(assignmentSortField == 'b', assignmentDirectionMark, '')}</a>
                                    </th>
                                    <th style="text-align: left; white-space: normal;">
                                      <a href="#" onclick="sortAssignment('w'); return false;">Total Workload Factor{!IF(assignmentSortField == 'w', assignmentDirectionMark, '')}</a>
                                    </th>
                                  </tr>
                                  <apex:repeat value="{!assignments}" var="assignment">
                                    <tr>
                                      <td style="border-bottom: none; text-align: left; padding: 0px; {!IF(assignment.isQualified, '', 'background-color: #DDD;')}">
                                        <span style="padding-left: 2px;">{!assignment.teamName}</span>
                                      </td>
                                      <td style="border-right: none; border-bottom: none; text-align: left; padding: 0px; {!IF(assignment.isQualified, '', 'background-color: #DDD;')}">
                                        <span style="padding-left: 2px;">{!assignment.clientFactor}</span>
                                      </td>
                                      <td style="border-right: none; border-bottom: none; text-align: left; padding: 0px; {!IF(assignment.isQualified, '', 'background-color: #DDD;')}">
                                        <span style="padding-left: 2px;">{!assignment.buildingFactor}</span>
                                      </td>
                                      <td style="border-right: none; border-bottom: none; text-align: left; padding: 0px; {!IF(assignment.isQualified, '', 'background-color: #DDD;')}">
                                        <span style="padding-left: 2px;">{!assignment.totalWorkloadFactor}</span>
                                      </td>
                                    </tr>
                                  </apex:repeat>
                                </table>
                              </div>
                              <div>
                                <table class="generalTableStyle" style="margin-bottom: 0px; border-top: none;">
                                  <tr>
                                    <th colspan="3" style="text-align: center; border-top: none;">
                                      FREP Workload
                                    </th>
                                  </tr>
                                  <tr>
                                    <th style="text-align: left; white-space: normal; min-width: 85px;">
                                      <a href="#" onclick="sortFrep('n'); return false;">Name{!IF(frepSortField == 'n', frepDirectionMark, '')}</a>
                                    </th>
                                    <th style="text-align: left; white-space:normal;">
                                      <a href="#" onclick="sortFrep('r'); return false;">Region{!IF(frepSortField == 'r', frepDirectionMark, '')}</a>
                                    </th>
                                    <th style="text-align: left; white-space:normal;">
                                      <a href="#" onclick="sortFrep('w'); return false;">Workload{!IF(frepSortField == 'w', frepDirectionMark, '')}</a>
                                    </th>
                                  </tr>
                                  <apex:repeat value="{!frepAssignments}" var="assignment">
                                    <tr>
                                      <td style="border-bottom: none; text-align: left; padding: 0px;">
                                        <span style="padding-left: 2px;">{!assignment.teamName}</span>
                                      </td>
                                      <td style="border-right: none; border-bottom: none; text-align: left; padding: 0px;">
                                        <span style="padding-left: 2px;">{!assignment.regionName}</span>
                                      </td>
                                      <td style="border-right: none; border-bottom: none; text-align: left; padding: 0px;">
                                        <span style="padding-left: 2px;">{!assignment.totalWorkloadFactor}</span>
                                      </td>
                                    </tr>
                                  </apex:repeat>
                                </table>
                              </div>
                            </div>
                          </apex:outputPanel>
                        </div>
                        <script type="text/javascript">
                          if( {!!canShowAssignment} && currentTab == 'assignmentNotePanel' ) currentTab = 'proposalNotePanel';
                          displayTab( currentTab );
                        </script>
                      </div>
                    </div>
                  </div>
                </apex:outputPanel>
                <script type="text/javascript">
                  resizeFrame();
                </script>
              </apex:outputPanel>
            </div>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <div style="overflow: auto; -webkit-overflow-scrolling: touch;" id="form">
              <apex:outputPanel id="mainform">

                <div class="message infoM3" style="display: {!IF(billingAccount.Accounting_Hold__c, 'block', 'none')}; margin: 4px 4px 4px 4px;"> <!-- MRS 7240 -->
                  <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                    <tr valign="top">
                      <td><img alt="INFO" class="msgIcon" src="/s.gif" title="INFO"/></td>
                      <td class="messageCell">
                        <div class="messageText">
                          <span style="color:#0000cc; display:inline-block; font-weight:bold;">Information:</span>
                          <ul style="padding-left: 0px; margin: 0px;">
                            <li>Accounting Hold.</li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>

                <!-- step 1 -->
                <div style="display: {!IF(proposal.Step__c == 1, 'block', 'none')};" class="mainStyle" id="step1Block">
                  <apex:outputPanel id="step1" layout="block">
                    <div class="apexp"> <!-- Client Information -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Client Information</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody">
                          <div class="pbSubsection">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                              <tbody>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Primary Company Name -->
                                    <label for="ProposalWizardPage:theForm:Primary_Company_Name__c" class="labelText">Primary Company Name:</label>
                                    <div id="primaryCompanyDiv">
                                      <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                      <apex:inputField value="{!proposal.Primary_Company_Name__c}" styleClass="inputFieldStd specialDisableJQ contactSpecialDisableJQ" id="Primary_Company_Name__c" onfocus="primaryCompanyText = this.value;" onblur="var $elem = $('[id$=Primary_Company_Name__c_autoCompleteBoxId]'); if( this.tagName != 'A' && ( $elem.length == 0 || ( $elem.eq(0).css('display') == 'none' && ( primaryCompanyText == this.value || primaryCompanyText == '' || this.value == '' ) ) ) ) { primaryCompanyAction( currentStep ); }">
                                      </apex:inputField>
                                    </div>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- Billing Company Name -->
                                    <label for="ProposalWizardPage:theForm:Billing_Company_Name__c" class="labelText">Billing Company Name:</label>
                                    <div id="billingCompanyDiv">
                                      <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                      <apex:inputField value="{!proposal.Billing_Company_Name__c}" styleClass="inputFieldStd specialDisableJQ contactSpecialDisableJQ" id="Billing_Company_Name__c" onfocus="billingCompanyText = this.value;" onblur="var $elem = $('[id$=Billing_Company_Name__c_autoCompleteBoxId]'); if( this.tagName != 'A' && ( $elem.length == 0 || ( $elem.eq(0).css('display') == 'none' && ( billingCompanyText == this.value || billingCompanyText == '' || this.value == '' ) ) ) ) { billingCompanyAction( currentStep ); }">
                                      </apex:inputField>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Primary Company Contact -->
                                    <label for="ProposalWizardPage:theForm:Primary_Company_Contact__c" class="labelText">Primary Company Contact:</label>
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <apex:selectList value="{!proposal.Primary_Company_Contact__c}" size="1" styleClass="inputFieldExt specialDisableJQ contactSpecialDisableJQ" id="Primary_Company_Contact__c" onblur="recalculateCompleteness();">
                                      <apex:actionSupport event="onchange" rerender="footer, step4, msgs" action="{!changePrimaryContactAction}"/> <!-- MRS 7112 -->
                                      <apex:selectOptions value="{!primaryContacts}"/>
                                    </apex:selectList>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- Billing Company Contact -->
                                    <label for="ProposalWizardPage:theForm:Billing_Company_Contact__c" class="labelText">Billing Client Contact:</label>
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <apex:selectList value="{!proposal.Billing_Company_Contact__c}" size="1" styleClass="inputFieldExt specialDisableJQ contactSpecialDisableJQ" id="Billing_Company_Contact__c">
                                      <apex:actionSupport event="onchange" rerender="step1, completeness, footer, step4, msgs" action="{!changeBillingContactAction}" status="overlay"/>
                                      <apex:selectOptions value="{!billingContacts}"/>
                                    </apex:selectList>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- MRS 7114 Client Instructions -->
                                    <label for="" class="labelText">Primary Client Instructions:</label>
                                    <!-- <apex:inputTextArea id="primaryCInstructions" onchange="checkAndUpdateInstructions(this, this.id, this.value);" value="{!proposalOwnInstructions[1]}" styleClass="textAreaDesc primClientInstructions specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;"/> -->
                                    <apex:inputTextArea value="{!pwm.primaryClientInstructions}" styleClass="textAreaDesc specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;" readonly="true"/>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- MRS 7114 Billing Client Instructions -->
                                    <label for="" class="labelText">Billing Client Instructions:</label>
                                    <!-- <apex:inputTextArea id="billingCInstructions" onchange="checkAndUpdateInstructions(this, this.id, this.value);" value="{!proposalOwnInstructions[2]}" styleClass="textAreaDesc billClientInstructions specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;"/> -->
                                    <apex:inputTextArea value="{!pwm.billingClientInstructions}" styleClass="textAreaDesc specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;" readonly="true"/>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Primary Client is Billing Client -->
                                    <apex:inputField styleClass="specialDisableJQ contactSpecialDisableJQ" value="{!proposal.Primary_Client_is_Billing_Client__c}" id="Primary_Client_is_Billing_Client__c" onchange="primaryCompanyIsBillingCompanyAction( currentStep );"/>
                                    <label for="ProposalWizardPage:theForm:Primary_Client_is_Billing_Client__c" class="checkboxLabelText">Primary Client is Billing Client</label>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- Send Invoices to Different Contact -->
                                    <apex:inputField styleClass="specialDisableJQ contactSpecialDisableJQ" value="{!proposal.Send_Invoices_to_Different_Contact__c}" id="Send_Invoices_to_Different_Contact__c">
                                      <apex:actionSupport event="onclick" rerender="step1, step4, footer, msgs" status="overlay" action="{!sendInvoicesToDifferentContactAction}"/>
                                    </apex:inputField> <!-- MRS 7112 -->
                                    <label for="ProposalWizardPage:theForm:Send_Invoices_to_Different_Contact__c" class="checkboxLabelText">Send Invoices to Different Contact</label>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Proposal / RFP Requested By -->
                                    <span class="helpButton" style="color: #4A4A56; font-weight: bold;">
                                      <label for="ProposalWizardPage:theForm:Requested_By__c" title="This refers to the external party requesting Proposal/RFP" class="labelText">Proposal / RFP Requested By:</label>
                                      <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltipTop').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltipTop').hide();"/>
                                      <span class="helpTooltipTop">This refers to the external party requesting Proposal/RFP</span>
                                    </span>
                                    <apex:inputField value="{!proposal.Requested_By__c}" styleClass="inputFieldStd disableAccountingHold" id="Requested_By__c"/>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- Accounting Contact Company -->
                                    <div id="accountingContactCompany" style="display: {!IF(proposal.Send_Invoices_to_Different_Contact__c, 'block', 'none')};"> <!-- MRS 7112 -->
                                      <label for="ProposalWizardPage:theForm:Accounting_Contact_Company__c" class="labelText" style="display: block;">Accounting Contact Company:</label>
                                      <apex:inputField value="{!proposal.Accounting_Contact_Company__c}" styleClass="inputFieldStd specialDisableJQ contactSpecialDisableJQ" id="Accounting_Contact_Company__c" onfocus="accountingCompanyText = this.value;" onblur="var $elem = $('[id$=Accounting_Contact_Company__c_autoCompleteBoxId]'); if( this.tagName != 'A' && ( $elem.length == 0 || ( $elem.eq(0).css('display') == 'none' && ( accountingCompanyText == this.value || accountingCompanyText == '' || this.value == '' ) ) ) ) { accountingCompanyAction(); }">
                                      </apex:inputField>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Proposal / RFP Request Date -->
                                    <label for="ProposalWizardPage:theForm:Proposal_RFP_Request_Date__c" class="labelText">Proposal / RFP Request Date:</label>
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <div class="inputDateFieldWrapper">
                                       <apex:inputField rendered="{!isPS || isAdmin}" value="{!proposal.Proposal_RFP_Request_Date__c}" styleClass="inputDateField disableAccountingHold" onchange="recalculateCompleteness();" id="Proposal_RFP_Request_Date__c"/>
                                       <apex:inputText id="TextProposal_RFP_Request_Date__c" disabled="true" rendered="{!!(isPS || isAdmin)}" value="{!proposalRfpRequestDate}" styleClass="inputDateField"/> <!-- MRS 7369 -->
                                    </div>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- Accounting Contact -->
                                    <div id="accountingContact" style="display: {!IF(proposal.Send_Invoices_to_Different_Contact__c, 'block', 'none')};"> <!-- MRS 7112 -->
                                      <label for="ProposalWizardPage:theForm:Accounting_Contact__c" class="labelText">Accounting Contact:</label>
                                      <apex:selectList value="{!proposal.Accounting_Contact__c}" size="1" styleClass="inputFieldExt specialDisableJQ contactSpecialDisableJQ" id="Accounting_Contact__c">
                                        <apex:actionSupport event="onchange" rerender="footer, step4, msgs" action="{!changeAccountingContactAction}"/>
                                        <apex:selectOptions value="{!accountingContacts}"/>
                                      </apex:selectList>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Proposal Request --> <!-- G300 MRS-6889 -->
                                    <!--label for="ProposalWizardPage:theForm:Proposal_Request__c" class="labelText" style="display: block;">Proposal Request:</label>
                                    <apex:inputField value="{!proposal.Proposal_Request__c}" styleClass="inputFieldStd disableAccountingHold" id="Proposal_Request__c"/-->
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- MRS 7114 Accounting Client Instructions -->
                                    <div id="accountingClientInstructions" style="display: {!IF(proposal.Send_Invoices_to_Different_Contact__c, 'block', 'none')};"> <!-- MRS 7112 -->
                                      <label for="" class="labelText">Accounting Client Instructions :</label>
                                      <!-- <apex:inputTextArea id="accountingCInstructions" onchange="checkAndUpdateInstructions(this, this.id, this.value);" value="{!proposalOwnInstructions[3]}" styleClass="textAreaDesc specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;"/> -->
                                      <apex:inputTextArea value="{!pwm.accountingClientInstructions}" styleClass="textAreaDesc specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;" readonly="true"/>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td class="dataCol dataCell"> <!-- Opportunity --> <!-- G300 MRS-6898 -->
									<apex:outputpanel id="OpportunityOutputPanel"> <!-- MRS 7307 -->
                                    	<label id="Opportunity__cLabel" for="ProposalWizardPage:theForm:Opportunity__c" class="labelText" style="display: block;">Opportunity{!opportunityNumber}:</label>
									</apex:outputpanel>
                                    <apex:inputField value="{!proposal.Opportunity__c}" styleClass="inputFieldStd disableAccountingHold" id="Opportunity__c" onchange="changeOppRemoteAction();"/>
                                  </td>
                                  <td class="splitter"></td>
                                  <td class="dataCol dataCell"> <!-- Empty section -->
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div></div></div>
                    </div>

                    <div class="apexp"> <!-- Assignment -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Assignment</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Partner -->
                                  <label for="ProposalWizardPage:theForm:Partner__c" style="display: block;" class="labelText">Partner:</label>
                                  <apex:selectList value="{!proposal.Partner__c}" size="1" styleClass="inputFieldExt disableAccountingHold" id="Partner__c">
                                    <apex:selectOptions value="{!partners}"/>
                                    <apex:actionSupport event="onchange" rerender="step1, completeness, footer, step4, msgs" action="{!changePartnerAction}"/> <!-- MRS 7112 -->
                                  </apex:selectList>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Salesperson -->
                                  <label for="ProposalWizardPage:theForm:Salesperson__c" class="labelText">Salesperson:</label>
                                  <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                  <apex:selectList value="{!proposal.Salesperson__c}" size="1" styleClass="inputFieldExt disableAccountingHold" id="Salesperson__c" onclick="recalculateCompleteness();">
                                    <apex:selectOptions value="{!salespersons}"/>
                                    <apex:actionSupport event="onchange" rerender="footer, step4, msgs" action="{!changeSalespersonAction}"/> <!-- MRS 7112 -->
                                  </apex:selectList>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Account Relationship Manager -->
                                  <label for="ProposalWizardPage:theForm:Account_Executive__c" class="labelTextBlock">Account Relationship Manager:</label>
                                  <apex:selectList value="{!proposal.Account_Executive__c}" size="1" styleClass="inputFieldExt accountManagerJQ specialDisableJQ disableAccountingHold" id="Account_Executive__c">
                                    <apex:selectOptions value="{!accountManagers}"/>
                                    <apex:actionSupport event="onchange" rerender="step4, msgs" action="{!changeAccountManagerAction}"/> <!-- MRS 7112 -->
                                  </apex:selectList>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Fulfillment Office -->
                                  <label for="ProposalWizardPage:theForm:Fulfillment_Office__c" class="labelText">Fulfillment Office:</label>
                                  <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                  <apex:selectList value="{!proposal.Fulfillment_Office__c}" size="1" styleClass="inputFieldExt specialDisableJQ fulfillmentOfficeJQ disableAccountingHold" id="Fulfillment_Office__c"  disabled="{!!isFulfillmentOfficeEnabled}" onclick="recalculateCompleteness();">
                                    <apex:selectOptions value="{!fulfillmentOffices}"/>
                                    <apex:actionSupport event="onchange" rerender="footer"/> <!-- MRS 7112 -->
                                  </apex:selectList>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Project Team -->
                                  <div style="display: {!IF(canAssignProjectTeam, 'block', 'none')};">
                                    <label for="ProposalWizardPage:theForm:Set_Project_Team" class="labelText">Project Team:</label>
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <apex:selectList value="{!proposal.Project_Team__c}" size="1" styleClass="inputFieldExt EnableSelectList specialDisableJQ projectTeamJQ disableAccountingHold" id="Set_Project_Team" disabled="{!!ISBLANK(proposal.Project_Profile__r.Project_Team__c) && !ISBLANK(proposal.Project_Profile__c)}">
                                      <apex:selectOptions value="{!projectTeams}"/>
                                      <apex:actionSupport event="onchange" action="{!setDefaultFrep}" rerender="step1, footer, notesRightOutputPanel" status="overlay"/>
                                      <apex:actionSupport event="onchange" action="{!setDefaultProdManager}" rerender="step1, footer, notesRightOutputPanel" status="overlay"/>
                                    </apex:selectList>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Created By -->
                                  <label class="labelText">Proposal Creator:</label>                                <!-- MRS 6648 -->
                                  <apex:inputText rendered="{!!ISBLANK(proposal.OwnerId)}" disabled="true" value="{!proposalCreator}" styleClass="inputFieldStd" style="display: block;"/>
                                  <apex:inputText rendered="{!ISBLANK(proposal.OwnerId)}" disabled="true" value="{!userName}" styleClass="inputFieldStd" style="display: block;"/>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- FREP -->
                                  <div style="display: {!IF(canAssignProjectTeam, 'block', 'none')};">
                                    <label for="ProposalWizardPage:theForm:Frep" class="labelText">FREP:</label>
                                    <apex:selectList value="{!proposal.FREP__c}" size="1" styleClass="inputFieldExt EnableSelectList specialDisableJQ projectTeamJQ disableAccountingHold" id="Frep" style="display: block;" disabled="{!ISBLANK(proposal.Project_Team__c) || !ISBLANK(proposal.Project_Profile__c)}">
                                      <apex:selectOptions value="{!freps}"/>
                                    </apex:selectList>

                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell">
                                  <div style="display: {!IF(isCZAssignmentVisible, 'block', 'none')}">
                                    <label for="ProposalWizardPage:theForm:Code_Zoning_Analyst__c" class="labelTextBlock">Code &amp; Zoning Analyst:</label>
                                    <apex:selectList value="{!proposal.Code_Zoning_Analyst__c}" size="1" styleClass="inputFieldExt specialDisableJQ disableAccountingHold" id="Code_Zoning_Analyst__c" disabled="{!!canAssignCZAnalyst}">
                                      <apex:selectOptions value="{!cZAnalysts}"/>
                                      <apex:actionSupport event="onchange" rerender="msgs" reRender="footer"/> <!-- MRS 7112 -->
                                    </apex:selectList>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Production Manager -->
                                  <div style="display: {!IF(canAssignProjectTeam || (profileName == 'Production Manager'), 'block', 'none')};">
                                    <label for="ProposalWizardPage:theForm:Production_Manager__c" class="labelText">Production Manager:</label>
                                    <apex:selectList value="{!proposal.Production_Manager__c}" size="1" styleClass="inputFieldExt EnableSelectList specialDisableJQ projectTeamJQ disableAccountingHold" id="Production_Manager__c" style="display: block;" disabled="{!!ISBLANK(proposal.Project_Profile__r.Project_Team__c) && !ISBLANK(proposal.Project_Profile__c)}">
                                      <apex:selectOptions value="{!prodManagers}"/>
                                      <apex:actionSupport event="onchange" rerender="step1, step4, msgs" action="{!changeProductionManagerAction}"/> <!-- MRS 7112 -->
                                    </apex:selectList>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- SIPS Coordinator -->
                                  <div style="display: {!IF(isSIPSAssignmentVisible, 'block', 'none')}">
                                    <label for="ProposalWizardPage:theForm:SIPS_Coordinator__c" class="labelTextBlock">SIPS Coordinator:</label>
                                    <apex:selectList value="{!proposal.SIPS_Coordinator__c}" size="1" styleClass="inputFieldExt specialDisableJQ disableAccountingHold" id="SIPS_Coordinator__c" disabled="{!!canAssignSIPSCoordinator}">
                                      <apex:selectOptions value="{!sipsCoordinators}"/>
                                      <apex:actionSupport event="onchange" rerender="msgs" reRender="footer"/> <!-- MRS 7112 -->
                                    </apex:selectList>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>

                    <div class="apexp"> <!-- Project Location -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Project Location</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell">
                                  <div style="padding-bottom: 5px;"> <!-- Address -->
                                    <label for="ProposalWizardPage:theForm:Address__c" class="labelText">Address:</label>
                                    <div id="buildingAddressFieldDiv">
                                      <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                      <apex:inputField value="{!proposal.Address__c}" styleClass="inputFieldExt disableAccountingHold" id="Address__c" onfocus="buildingText = this.value;" onblur="var $elem = $('[id$=Address__c_autoCompleteBoxId]'); if( this.tagName != 'A' && ( $elem.length == 0 || ( $elem.eq(0).css('display') == 'none' && ( buildingText == this.value || buildingText == '' || this.value == '' ) ) ) ) { blockStep2(); projectAddressAction( -1, getPrimCInstr(), getBillCInstr(), getAccCInstr(), '', getBillInstr() ); }"> <!-- MRS 7094 -->
                                      </apex:inputField>
                                    </div>
                                  </div>
                                  <div style="padding-bottom: 5px;"> <!-- Building AKA -->
                                    <span class="helpButton" style="color: #4A4A56; font-weight: bold;">
                                      <label for="ProposalWizardPage:theForm:Building_AKA__c" class="labelText">Building AKA:</label>
                                      <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltipTop').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltipTop').hide();"/>
                                      <span class="helpTooltipTop">Alternate address for this building that the client prefers to see on documentation.</span>
                                    </span>
                                    <div>
                                      <apex:selectList size="1" value="{!building_AKA_Id}" styleClass="inputFieldExt disableAccountingHold" id="Building_AKA__c">
                                        <apex:selectOptions value="{!buildingAKAs}"/>
                                        <!-- <apex:actionSupport event="onchange" action="{!fillBuildingAKA}" reRender="" status="overlay"/> -->
                                      </apex:selectList>
                                    </div>
                                  </div>
                                  <div style="padding-bottom: 0px; width: 94%;"> <!-- City, State, Zip Code -->
                                    <div style="display: inline-block; width: 42%; padding-right: 2.5%;">
                                      <label for="ProposalWizardPage:theForm:City__c" class="labelText">City:</label>
                                      <apex:inputText value="{!building.City__c}" disabled="true" style="width: 100%;" id="City__c"/>
                                    </div>
                                    <div style="display: inline-block; width: 21%; padding-right: 2.5%;">
                                      <label for="ProposalWizardPage:theForm:State__c" class="labelText">State:</label>
                                      <apex:inputText value="{!building.State__c}" disabled="true" style="width: 100%;" id="State__c"/>
                                    </div>
                                    <div style="display: inline-block; width: 25.5%;">
                                      <label for="ProposalWizardPage:theForm:PostalCode__c" class="labelText">Zip Code:</label>
                                      <apex:inputText value="{!building.PostalCode__c}" disabled="true" style="width: 100%;" id="PostalCode__c"/>
                                    </div>
                                  </div>
                                  <div style="padding-bottom: 0px; width: 94%;"> <!-- Municipality, Owner Company -->
                                    <div style="display: inline-block; width: 38.5%; padding-right: 2.5%;">
                                      <label for="ProposalWizardPage:theForm:Municipality__r" class="labelText">Municipality:</label>
                                      <apex:inputText value="{!building.Municipality_Name__c}" disabled="true" style="width:100%;" id="Municipality__r"/>
                                    </div>
                                    <div style="display: inline-block; width: 53.5%;">
                                      <label for="ProposalWizardPage:theForm:Owner_Company__c" class="labelText">Owner Company:</label>
                                      <apex:inputText value="{!building.Owner_Company_Name__c}" disabled="true" style="width:100%;" id="Owner_Company__c"/>
                                    </div>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell" style="width: 50%; vertical-align: top;">
                                  <div style="float: left; padding-top: 10px; padding-bottom: 0px; width: 100%;"> <!-- Is MTA -->
                                    <apex:inputCheckbox value="{!building.Is_MTA__c}" disabled="true" id="is_MTA__c"/>
                                    <span class="helpButton" style="color: #4A4A56; font-weight: bold;">
                                      <label for="ProposalWizardPage:theForm:is_MTA__c" title="Above train station or within 200 feet of an MTA facility" class="checkboxLabelText">Transit Authority</label> <!-- MRS 7486 -->
                                      <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltipTop').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltipTop').hide();"/>
                                      <span class="helpTooltipTop" style="width: 9em;">Above train station or within 200 feet of an MTA facility</span>
                                    </span>
                                  </div>
                                  <div style="float:left; padding-bottom: 0px; width: 100%;"> <!-- Is Landmark -->
                                    <apex:inputCheckbox value="{!building.Is_Landmark__c}" disabled="true" id="is_Landmark__c"/>
                                    <label for="ProposalWizardPage:theForm:is_Landmark__c" class="checkboxLabelText">NYC Landmark</label> <!-- MRS 7486 -->
                                  </div>
                                  <div style="float:left; padding-bottom: 0px; width: 100%;"> <!-- 'Little E' Designation -->
                                    <apex:inputCheckbox value="{!building.Little_E_Designation__c}" disabled="true" id="Little_E_Designation__c"/>
                                    <label for="ProposalWizardPage:theForm:Little_E_Designation__c" class="checkboxLabelText">'Little E' Designation</label>
                                  </div>
                                  <div style="float:left; padding-bottom: 0px; width: 100%;"> <!-- Loft Board Authority -->
                                    <apex:inputCheckbox value="{!building.Loft_Board_Authority__c}" disabled="true" id="Loft_Board_Authority__c"/>
                                    <label for="ProposalWizardPage:theForm:Loft_Board_Authority__c" class="checkboxLabelText">Loft Board Authority</label>
                                  </div>
                                  <br/>
                                  <div style="float:left; padding-bottom: 0px; width: 100%;"> <!-- MRS 7114 Building Proposal Instructions -->
                                    <label for="" class="labelText">Building Instructions:</label>
                                     <!-- <apex:inputTextArea id="buildingInstructions" value="{!proposalOwnInstructions[0]}" onchange="checkAndUpdateInstructions(this, this.id, this.value);" styleClass="textAreaDesc buildingInstructions specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;"/> -->
                                     <apex:inputTextArea value="{!pwm.buildingInstructions}" styleClass="textAreaDesc specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;" readonly="true"/>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol" colspan="3"> <!-- Floor(s) -->
                                  <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                  <table id="floorsTable" class="generalTableStyle" style="margin-bottom: 0px;">
                                    <thead>
                                      <tr>
                                        <th></th> <!-- MRS 7109 -->
                                        <th>Construction Floor Type</th>
                                        <th>Construction Floor #</th>
                                        <th>Tenant Floor Type</th>
                                        <th>Tenant Floor #</th>
                                        <th>Action</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <apex:repeat value="{!FloorWrapperList}" var="floor">
                                        <tr>
                                          <td width="10px"> <!-- MRS 7109 -->
                                            <apex:inputCheckbox styleClass="deleteLinkFloor specialDisableJQ disableAccountingHold" value="{!floor.floorIsShown}" onchange="floorIdToRemove = '{!floor.floorId}'; statusOfFloorVisibility = '{!!floor.floorIsShown}'; changeVisibilityOfFloor(floorIdToRemove,statusOfFloorVisibility); floorIdToRemove = ''; statusOfFloorVisibility = '';">
                                            </apex:inputCheckbox>
                                          </td>
                                          <td>{!floor.floorType}</td>
                                          <td>{!floor.specificationName}</td>
                                          <td>{!floor.tenantType}</td>
                                          <td>{!floor.specificationTenantName}</td>
                                          <td style="text-align: center; padding-top: 0px; padding-bottom: 0px;"> <!-- Associate Floors With Services -->
                                            <div style="display: {!IF(areFloorButtonsEnabled && !viewOnly, 'block', 'none')};">
                                              <div class="deleteFloorJQ">
                                                <apex:commandLink onclick="floorIdToRemove = '{!floor.floorId}'; $('#removeFloorActionArea').show(); return false;" styleClass="deleteLinkFloor specialDisableJQ disableAccountingHold" rerender="selectFloorsForServicesPanel">
                                                  <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                                  <apex:param name="floorIdToRemove" value="{!floor.floorId}" assignTo="{!floorIdToRemove}"/>
                                                </apex:commandLink>
                                              </div>
                                            </div>
                                          </td>
                                        </tr>
                                      </apex:repeat>
                                    </tbody>
                                  </table>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell">
                                  <apex:inputCheckbox styleClass="specialDisableJQ disableAccountingHold" value="{!proposal.Is_Floors_To_Services__c}" disabled="{!!areFloorButtonsEnabled || viewOnly}" id="Is_Floors_To_Services__c">
                                    <apex:actionSupport event="onchange" action="{!associateFloorsWithServicesAction}" reRender="changeOrderTables, msgs" status="overlay"/>
                                  </apex:inputCheckbox>
                                  <label for="ProposalWizardPage:theForm:Is_Floors_To_Services__c" class="checkboxLabelText disableAccountingHold">Do you want to associate floors with services</label>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Empty -->
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                        <div class="pbBottomButtons" style="margin-top: 0px;">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td style="text-align: right; padding-top: 5px; padding-bottom: 5px;" class="pbButtonb">
                                  <span style="display: {!IF(areFloorButtonsEnabled, 'inline', 'none')};">
                                    <apex:commandButton value="+ Add New Floor" styleClass="addNewFloorCommandButton specialDisableJQ disableAccountingHold" onclick="$('[id$=floorsRightOutputPanel]').css('display', 'block'); $('[id$=notesRightOutputPanel]').css('display', 'none'); disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold}); changeRightPanelToFloor(); return false;" disabled="{!viewOnly}" reRender="none" /> <!-- MRS 7112 -->
                                  </span>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div></div></div>
                    </div>

                    <div class="apexp"> <!-- Project Details -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Project Details</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Project Name -->
                                  <span class="helpButton" style="color: #4A4A56; font-weight: bold;">
                                    <label for="ProposalWizardPage:theForm:Project_Name__c" title="Please use the Client's Project Name here when available" class="labelText">Project Name:</label>
                                    <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltipTop').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltipTop').hide();"/>
                                    <span class="helpTooltipTop">Please use the Client&#39;s Project Name here when available</span>
                                  </span>
                                  <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                  <apex:inputField value="{!proposal.Project_Name__c}" styleClass="inputFieldStd disableAccountingHold" onchange="recalculateCompleteness();" id="Project_Name__c"/>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Client Project # -->
                                  <div style="padding-top: 5px;">
                                    <label for="ProposalWizardPage:theForm:Client_Project__c" class="labelTextBlock">Client Project #:</label>
                                    <apex:inputField value="{!proposal.Client_Project__c}" styleClass="inputFieldStd specialDisableJQ clientProjectNumber disableAccountingHold" id="Client_Project__c"/>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell" colspan="3"> <!-- Description -->
                                  <label for="ProposalWizardPage:theForm:Description__c" class="labelTextBlock">Description:</label>
                                  <div class="requiredBlockWrapper"><div class="requiredBlockMarker" style="height: 56px; top: -2px;"></div></div>
                                  <apex:inputTextArea value="{!proposal.Description__c}" styleClass="textAreaDesc disableAccountingHold" style="height: 50px; width: 95%; resize: none;" onchange="recalculateCompleteness();" id="Description__c" />
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Expected Construction Start Date -->
                                  <apex:actionFunction name="setServiceTypesOverrideAction" action="{!setServiceTypesOverride}" reRender="step2, footer, step4, msgs" oncomplete="if( $('.errorM3[role=alert] span').length != 0 ) { } else { recalculateCompleteness(); }"/> <!-- MRS 7112 -->
                                  <label for="ProposalWizardPage:theForm:Expected_Construction_Start_Date__c" class="labelText">Expected Construction Start Date:</label>
                                  <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                  <div class="inputDateFieldWrapper">
                                     <apex:inputField value="{!proposal.Expected_Construction_Start_Date__c}" onchange="$('[id$=step2Iframe]').hide(); recalculateCompleteness(); blockStep2(); setServiceTypesOverrideAction();" styleClass="inputDateField disableAccountingHold" id="Expected_Construction_Start_Date__c"/> <!-- MRS 7112 -->
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Expected Construction Cost -->
                                  <label for="ProposalWizardPage:theForm:Expected_Construction_Cost__c" class="labelTextBlock">Expected Construction Cost:</label>
                                  <apex:inputField value="{!proposal.Expected_Construction_Cost__c}" styleClass="inputFieldStd disableAccountingHold" id="Expected_Construction_Cost__c"/>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Expected Construction End Date -->
                                  <label for="ProposalWizardPage:theForm:Expected_Construction_End_Date__c" class="labelText">Expected Construction End Date:</label>
                                  <div class="inputDateFieldWrapper">
                                    <apex:inputField value="{!proposal.Expected_Construction_End_Date__c}" styleClass="inputDateField disableAccountingHold" onchange="recalculateCompleteness();" id="Expected_Construction_End_Date__c"/>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Expected Occupancy Date -->
                                  <label for="ProposalWizardPage:theForm:Expected_Occupancy_Date__c" class="labelText">Expected Occupancy Date:</label>
                                  <div class="inputDateFieldWrapper">
                                     <apex:inputField value="{!proposal.Expected_Occupancy_Date__c}" styleClass="inputDateField disableAccountingHold" onchange="recalculateCompleteness();" id="Expected_Occupancy_Date__c"/>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell" style="vertical-align: top;">
                                  <apex:inputCheckbox value="{!proposal.isPhase__c}" id="isPhase__c" styleClass="multiplePhaseExclude specialDisableJQ disableAccountingHold" disabled="{!disablePhasesCheckbox || !arePhasesButtonsEnabled || viewOnly}" onchange="showHideMultiplyPhaseArea()"/> <!-- MRS 7330 -->
                                  <label for="ProposalWizardPage:theForm:isPhase__c" class="labelText">Multiple Phase Project</label>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell">
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell" style="vertical-align: top;" colspan="3">
                                  <div id="listOfPhasesDiv" style="display: {!IF(proposal.isPhase__c, 'block', 'none')};"> <!-- Phases Table--> <!-- MRS 7330 -->
                                    <table id="phasesTable" class="generalTableStyle">
                                      <tr class="nodrop nodrag">
                                        <th>Name</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th class="tdPhaseAction">Action</th>
                                      </tr>
                                      <apex:repeat value="{!phaseList}" var="phase">
                                        <tr id="{!phase.Id}">
                                          <td class="name dragHandle">
                                            <div>
                                              <span>{!phase.Name__c}</span>
                                              <span class="helpButton" style="display: {!IF(phase.Is_default__c, 'inline-block', 'none')}; color: #4A4A56; font-weight: bold;">
                                                <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltip').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltip').hide();"/>
                                                <span class="helpTooltip" style="width: 120px;">This is default phase.</span>
                                              </span>
                                            </div>
                                          </td>
                                          <td class="data dragHandle">
                                            <apex:outputField value="{!phase.Start_Date__c}"/>
                                          </td>
                                          <td class="data dragHandle">
                                            <apex:outputField value="{!phase.End_Date__c}"/>
                                          </td>
                                          <td class="data tdPhaseAction" style="width: 60px;">
                                            <div style="display: {!IF(arePhasesButtonsEnabled && proposal.isPhase__c && !viewOnly, 'block', 'none')};" styleClass="deletePhaseJQ"> <!-- MRS 7112 -->
                                              <apex:commandLink styleClass="phasesCommandLinks specialDisableJQ disableAccountingHold" value="Edit" title="Edit" onclick="showOverlay(); editPhaseAction('{!phase.Id}', serializePhases()); return false;"/><!--
                                              --><span style="color:#888;">&nbsp;|&nbsp;</span><!--
                                              --><apex:commandLink styleClass="phasesCommandLinks specialDisableJQ disableAccountingHold" value="Del" title="Del" onclick="showOverlay(); deletePhaseAction('{!phase.Id}', serializePhases()); return false;"/>
                                            </div>
                                          </td>
                                        </tr>
                                      </apex:repeat>
                                    </table>
                                    <script type="text/javascript">
                                      if( '{!arePhasesButtonsEnabled && proposal.isPhase__c}' == 'true' ) attachDndToTables('#phasesTable');
                                    </script>
                            
                                    <div class="pbBottomButtons" style="margin-top: 0px;"> <!-- MRS 7330 -->        
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td style="text-align: right; padding-top: 5px; padding-bottom: 5px;" class="pbButtonb">
                                                        <apex:commandButton value="+ Add New Phase" onclick="showAddNewPhaseAction(); addNewPhaseAction(serializePhases()); return false;" styleClass="addNewPhaseCommmandButton specialDisableJQ disableAccountingHold" disabled="{!viewOnly}" reRender="none"/> <!-- MRS 7112 7330 -->
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>

                    <div class="apexp"> <!-- Billing Preferences -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">
                                    Billing Preferences
                                  </h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell" style="vertical-align: top;">
                                  <table class="inlineTableLeft">
                                    <tr>
                                      <td>
                                        <div>
                                          <div>
                                            <label for="ProposalWizardPage:theForm:Delivery_Method__c" class="labelTextInline">Delivery Method:</label>
                                          </div>
                                          <apex:selectList value="{!proposal.Delivery_Method__c}" size="1" styleClass="valueTextInline specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" id="Delivery_Method__c">
                                            <apex:selectOptions value="{!deliveryMethods}"/>
                                            <apex:actionSupport event="onchange" rerender="step1, msgs"/>
                                          </apex:selectList>
                                        </div>
                                        <div style="display: {!IF(proposal.Delivery_Method__c == 'Email', 'block', 'none')}">
                                          <div>
                                            <label for="ProposalWizardPage:theForm:copyToEmail" class="labelTextInline">Invoice CC:</label>
                                          </div>
                                          <apex:inputTextarea style="margin: 0px; width: 100%; padding: 0px; resize: none;" id="copyToEmail" value="{!proposal.Send_Copy_To__c}" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" disabled="{!rightPanelView == 'sendToCopy'}"/>
                                        </div>
                                        <div style="text-align: right; display: {!IF(!isChangeOrder && proposal.Delivery_Method__c == 'Email', 'block', 'none')}">
                                          <apex:commandButton value="Add Contact To CC" onclick="changeRightPanelToSendCopyToCC(); return false;" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        </div>
                                        <div>
                                          <div>
                                            <label for="ProposalWizardPage:theForm:Billing_Method__c" class="labelTextInline">Billing Method:</label>
                                          </div>
                                          <apex:selectList value="{!proposal.Billing_Method__c}" onfocus="this.priorValue = this.value;" onchange="recalculateFrequencyAndBillingDay(this.priorValue, this.value);" size="1" styleClass="valueTextInline specialDisableJQ billingGroupOneJQ billingGroupTwoJQ disableAccountingHold" id="Billing_Method__c"> <!-- MRS 7335 -->
                                            <apex:selectOptions value="{!billingMethods}"/>
                                          </apex:selectList>
                                        </div>
                                        <div>
                                          <div>
                                            <label for="ProposalWizardPage:theForm:Frequency__c" class="labelTextInline">Frequency:</label>
                                          </div>
                                          <apex:selectList value="{!proposal.Frequency__c}" size="1" styleClass="valueTextInline specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" onchange="recalculateBillingDayAndMonth();" id="Frequency__c"> <!-- MRS 7335 -->
                                            <apex:selectOptions value="{!frequencies}"/>
                                          </apex:selectList>
                                        </div>
                                        <div id="QuarterlyMonthDiv" style="display: {!IF(renderQuarterlyMonthPicklist, 'table !important', 'none !important')};"> <!-- MRS 7335 -->
                                          <div>
                                            <label for="ProposalWizardPage:theForm:Quarterly_Month__c" class="labelTextInline">Quarterly Month:</label>
                                          </div>
                                          <apex:selectList value="{!proposal.Quarterly_Month__c}" size="1" styleClass="valueTextInline specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" id="Quarterly_Month__c">
                                            <apex:selectOptions value="{!quarterlyMonths}"/>
                                          </apex:selectList>
                                        </div>
                                        <div id="BillingDayDiv" style="display: {!IF(renderBillingDayPicklist, 'table !important', 'none !important')};"> <!-- MRS 7335 -->
                                          <div>
                                            <label for="ProposalWizardPage:theForm:Billing_day__c" class="labelTextInline">Billing day:</label>
                                          </div>
                                          <apex:selectList value="{!proposal.Billing_day__c}" size="1" styleClass="valueTextInline specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" id="Billing_day__c">
                                            <apex:selectOptions value="{!billingDaysAllPossible}"/>
                                          </apex:selectList>
										  <script>
											recalculateBillingDayAndMonth();
										  </script>	
                                        </div>
                                        <div>
                                          <div>
                                            <label for="ProposalWizardPage:theForm:Invoice_Format__c" class="labelTextInline">Invoice Format:</label>
                                          </div>
                                          <apex:selectList value="{!proposal.Invoice_Format__c}" size="1" styleClass="valueTextInline specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" id="Invoice_Format__c">
                                            <apex:selectOptions value="{!invoiceFormats}"/>
                                          </apex:selectList>
                                        </div>

                                        <!-- Display Text on Invoice -->
                                        <div>
                                          <span class="helpButton" style="color: #4A4A56; font-weight: bold;">
                                              <label for="ProposalWizardPage:theForm:Display_Text_on_Invoice__c" class="labelTextInline">Display Text on Invoice:</label>
                                              <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltipTop').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltipTop').hide();"/>
                                              <span class="helpTooltipTop">Additional text that the client has requested to be displayed on invoices.</span>
                                          </span>
                                          <apex:inputField id="Display_Text_on_Invoice__c" styleClass="specialDisableJQ displayTextOnInvoiceJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold" value="{!proposal.Display_Text_on_Invoice__c}" style="margin: 0px; width: 100%; padding: 0px; resize: none;" />
                                        </div>
                                      </td>
                                    </tr>
                                  </table>
                                  <table style="width: 100%; padding: 0px 1px;">
                                    <tr>
                                      <td>
                                        <!-- Mail All Invoices To Account -->
                                        <div>
                                          <div>
                                            <label class="labelText" for="Mail_All_Invoices_To_Account__c">Accounting Company - (E)Mail Invoice To:</label>
                                          </div>
                                          <div>
                                            <input class="disableAccountingHold" type="text" value="{!IF(billingAccount.Mail_All_Invoices_To_Contact__c != null, IF(billingAccount.Mail_All_Invoices_To_Account__c != null, billingAccount.Mail_All_Invoices_To_Account__r.Name, billingAccount.Mail_All_Invoices_To_Contact__r.Account.Name), '')}" disabled="true" id="Mail_All_Invoices_To_Account__c" style="width: 99%;"/>
                                          </div>
                                        </div>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>
                                        <!-- Mail All Invoices To Contact -->
                                        <div>
                                          <div>
                                            <label class="labelText" for="Mail_All_Invoices_To_Contact__c">Accounting Contact - (E)Mail Invoice To:</label>
                                          </div>
                                          <div>
                                            <input class="disableAccountingHold" type="text" value="{!IF(billingAccount.Mail_All_Invoices_To_Contact__c != null, billingAccount.Mail_All_Invoices_To_Contact__r.Name, '')}" disabled="true" id="Mail_All_Invoices_To_Contact__c" style="width: 99%;"/>
                                          </div>
                                        </div>
                                      </td>
                                    </tr>
                                    <tr> <!-- A/R Coordinator field --> <!-- G300 MRS-6845  -->
                                      <td>
                                        <div>
                                          <div>
                                            <label class="labelText" for="">A/R Coordinator</label>
                                          </div>
                                          <div>
                                            <input class="specialDisableJQ" type="text" value="{!proposalInstructions[5].recordName}" disabled="true" style="width: 99%;"/>
                                          </div>
                                        </div>
                                      </td>
                                    </tr>
                                  </table>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell" style="vertical-align: top;">
                                  <table class="inlineTableRight">
                                    <tr id="RowSeparate_Phases__c" style="display: {!IF(proposal.isPhase__c || isChangeOrder, 'table-row', 'none')};"> <!-- Separate Phases --> <!-- MRS 6349 MRS 7330-->
                                      <td>
                                        <apex:inputField value="{!proposal.Separate_Phases__c}" id="Separate_Phases__c" styleClass="specialDisableJQ billingGroupOneJQ disableAccountingHold" onchange="saparatePhasesChangeJS();"/> <!-- MRS 7335 -->
                                        <label for="ProposalWizardPage:theForm:Separate_Phases__c" class="checkboxLabelText">Separate Phases</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- Separate Reimbursables -->
                                      <td>
                                        <apex:inputField value="{!proposal.Separate_Reimbursables__c}" id="Separate_Reimbursables__c" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:Separate_Reimbursables__c" class="checkboxLabelText">Separate Reimbursables</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- No Document Shredding -->
                                      <td>
                                        <apex:inputField value="{!proposal.No_Document_Shredding__c}" id="No_Document_Shredding__c" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:No_Document_Shredding__c" class="checkboxLabelText">No Document Shredding</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- No Met Data Scanning -->
                                      <td>
                                        <apex:inputField value="{!proposal.No_Met_Data_Scanning__c}" id="No_Met_Data_Scanning__c" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:No_Met_Data_Scanning__c" class="checkboxLabelText">No Met Data Scanning</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- No Messenger/Fedex -->
                                      <td>
                                        <apex:inputField value="{!proposal.No_Messenger_Fedex__c}" id="No_Messenger_Fedex__c" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:No_Messenger_Fedex__c" class="checkboxLabelText">No Messenger/Fedex</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- Interval -->
                                      <td>
                                        <apex:inputField value="{!proposal.Interval__c}" id="Interval__c" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:Interval__c" class="checkboxLabelText">Interval</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- No Retainer -->
                                      <td>
                                        <apex:inputCheckbox disabled="true" value="{!proposal.No_Retainer__c}" id="No_Retainer__c" styleClass="specialDisableJQ billingGroupOneJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:No_Retainer__c" class="checkboxLabelText">No Retainer</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- PO Required -->
                                      <td>
                                        <apex:inputField value="{!proposal.PO_Required__c}" id="PO_Required__c" onchange="poRequiredAndNotRequiredLogic( currentStep );" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:PO_Required__c" class="checkboxLabelText">PO Required</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- PO Not Required -->
                                      <td>
                                        <apex:inputField value="{!proposal.PO_Not_Required__c}" id="PO_Not_Required__c" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:PO_Not_Required__c" class="checkboxLabelText">PO Not Required for Reimbursables</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- MSA -->
                                      <td>
                                        <apex:inputField value="{!proposal.MSA__c}" id="MSA__c" styleClass="specialDisableJQ billingGroupOneJQ disableAccountingHold"/>
                                        <span class="helpButton" style="color: #4A4A56; font-weight: bold;">
                                          <label for="ProposalWizardPage:theForm:MSA__c" class="checkboxLabelText">MSA</label>
                                          <img src="/s.gif" alt="" class="helpOrb" title="" onmouseover="$(this).parent().find('.helpTooltipTop').css('display', 'inline');" onmouseout="$(this).parent().find('.helpTooltipTop').hide();"/>
                                          <span class="helpTooltipTop">A Master Service Agreement exists for this Account. Services/Pricing outlined on the MSA must be honored until contract agreement expires.</span>
                                        </span>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>
                                        <table>
                                          <tr> <!-- MSA Start Date -->
                                            <td style="width:20%">
                                              <apex:inputField value="{!proposal.MSA_Start_Date__c}" id="MSA_Start_Date__c" styleClass="specialDisableJQ billingGroupOneJQ disableAccountingHold"/>
                                            </td>
                                            <td>
                                              <label for="ProposalWizardPage:theForm:MSA_Start_Date__c" class="checkboxLabelText">MSA Start Date</label>
                                            </td>
                                          </tr>
                                          <tr> <!-- MSA End Date -->
                                            <td style="width:20%">
                                              <apex:inputField value="{!proposal.MSA_End_Date__c}" id="MSA_End_Date__c" styleClass="specialDisableJQ billingGroupOneJQ disableAccountingHold"/>
                                            </td>
                                            <td>
                                              <label for="ProposalWizardPage:theForm:MSA_End_Date__c" class="checkboxLabelText">MSA End Date</label>
                                            </td>
                                          </tr>
                                        </table>
                                      </td>
                                    </tr>
                                    <tr> <!-- Retainer Amount -->
                                      <td>
                                        <apex:inputField value="{!proposal.Retainer_Amount__c}" id="Retainer_Amount__c" onFocus="this.priorValue=this.value;" onChange="if( this.value >= 0 && this.value <= 100 ) { this.priorValue = this.value; } else { this.value = this.priorValue; }" styleClass="specialDisableJQ billingGroupOneJQ billingGroupTwoJQ billingOccuredGroupTwoJQ disableAccountingHold"/>
                                        <label for="ProposalWizardPage:theForm:Retainer_Amount__c" class="checkboxLabelText">Retainer Amount</label>
                                      </td>
                                    </tr>
                                    <tr> <!-- MRS 7114 Billing Instructions -->
                                      <td>
                                        <div>
                                          <div>
                                            <label class="labelTextInline">Billing Instructions:</label>
                                          </div>
                                          <!-- <apex:inputTextArea id="billingInstructions" onchange="checkAndUpdateInstructions(this, this.id, this.value);" value="{!proposalOwnInstructions[4]}" styleClass="textAreaDesc billingInstructions specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;"/> -->
                                          <apex:inputTextArea value="{!pwm.billingInstructions}" styleClass="textAreaDesc specialDisableJQ contactSpecialDisableJQ" style="height: 50px; width: 95%; resize: none; color: green;" readonly="true"/>
                                        </div>
                                      </td>
                                    </tr>
                                  </table>
                                  <script type="text/javascript">
                                    poNotRequiredEditing({!!proposal.PO_Required__c}); //MRS 7304
                                    //MRS-5289
                                    if($('[id$=No_Retainer__c]').attr('checked')) {
                                      $('[id$=Retainer_Amount__c]').attr('disabled','disabled');
                                    }
                                  </script>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>

                    <div class="apexp"> <!-- Roster -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Roster</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell" colspan="3">
                                  <table class="generalTableStyle" style="margin-bottom: 0px;" id="firstStepRosterTable">
                                    <thead>
                                      <tr>
                                        <th>Full Name</th>
                                        <th>Primary Profession</th>
                                        <th>Role</th>
                                        <th>DND</th>
                                        <th style="display: {!IF( ( isThisUserCreator || !disableInputs ), 'table-cell', 'none')};">Action</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <apex:repeat value="{!pwr.contactRosters}" var="roster">
                                        <tr>
                                          <td>{!roster.contactName}</td>
                                          <td>{!roster.contact.Primary_Profession__c}</td>
                                          <td style="text-align: left;">
                                            <div style="display: {!IF(!roster.record.Is_Read__c && !isAccountOrProjectOnHold, 'block', 'none')}; margin-left: 10px;"> <!-- MRS 7159  -->
                                              <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                              <apex:inputField value="{!roster.record.User_Type__c}" style="display: none;"/>
                                              <apex:inputField id="rosterInputValue" value="{!roster.record.Role__c}" styleClass="{!IF(isThisUserCreator, 'specialDisableJQ', '')}}" onchange="changeContactRosterRoleAction( '{!roster.record.Id}', this.value );" onclick="disableNotAllowedRolesRosters();"/> <!-- MRS 7454 -->
                                            </div>
                                            <div style="display: {!IF(roster.record.Is_Read__c || isAccountOrProjectOnHold, 'block', 'none')};"> <!-- MRS 7159 -->
                                              {!roster.record.Role__c}
                                            </div>
                                          </td>
                                          <td style="text-align: center;">
                                            <input type="checkbox" disabled="disabled" checked="checked" style="display: {!IF(roster.contact.DND__c, 'inline-block', 'none')};"/>
                                            <input type="checkbox" disabled="disabled" style="display: {!IF(roster.contact.DND__c, 'none', 'inline-block')};"/>
                                          </td>
                                          <td style="display: {!IF( ( isThisUserCreator || !disableInputs ), 'table-cell', 'none')}; text-align: center;">
                                            <span style="display: {!IF(!roster.record.Is_Read__c && roster.record.Id != null, 'inline', 'none')}">
                                              <a href="#" class="specialDisableJQ disableAccountingHold" onclick="if( confirm( 'Are you sure you want to delete the Contact from the Project Roster?' ) ) { deleteContactFromRosterAction( '{!roster.record.Id}' ); } return false;">
                                                <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                              </a>
                                            </span>
                                          </td>
                                        </tr>
                                      </apex:repeat>
										<script type="text/javascript"> //MRS 7454
											function disableNotAllowedRolesRosters() {
												var allSelectOptions = $('[id$=rosterInputValue').children();
												for(var i = 0; i < allSelectOptions.length; i++) {
												if(allSelectOptions[i].value == 'Primary Client Contact' || allSelectOptions[i].value == 'Billing Client Contact (Bill To)' || allSelectOptions[i].value == 'Accounting Contact (Mail To)') allSelectOptions[i].disabled="true;";
												} 
											}
											setTimeout(function() { disableNotAllowedRolesRosters(); }, 2000);
										</script>
                                    </tbody>
                                  </table>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                        <div class="pbBottomButtons" style="margin-top: 0px; display: {!IF(isThisUserCreator, 'block', 'none')}">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td style="text-align: left; padding-top: 5px; padding-bottom: 15px;" class="pbButtonb">
                                  <div style="display: inline-block;">
                                    <span class="labelText">Search:</span>
                                    <apex:inputField id="addContactToRoster" value="{!pwr.rosterToAdd.Contact_Filter__c}" styleClass="specialDisableJQ disableAccountingHold" style="width: 65%; margin-left: 4px;" onfocus="addContactToRosterText = this.value;" onblur="var $elem = $('[id$=addContactToRoster_autoCompleteBoxId]'); if( this.tagName != 'A' && ( $elem.length == 0 || ( $elem.eq(0).css('display') == 'none' && ( addContactToRosterText == this.value || addContactToRosterText == '' || this.value == '' ) ) ) ) { addContactToRosterSearchAction(); }"/> <!-- MRS 7335 -->
                                  </div>
                                  <div style="display: inline-block;">
                                    <apex:commandButton id="addToWrapperCommandButton" action="{!addContactToRosterAction}" status="overlay" value="Add contact to roster" rerender="step1, step4, footer, rightPanel, msgs" style="width: 135px;" styleClass="{!IF(ISBLANK(pwr.rosterToAdd.Contact_Filter__c), 'specialDisableJQ disableAccountingHold btnDisabled', 'specialDisableJQ disableAccountingHold')}" oncomplete="disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});"/> <!-- MRS 7335 -->
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div></div></div>
                    </div>
                    <script type="text/javascript">
                      disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});
                    </script>
                  </apex:outputPanel>

                  <div class="apexp"> <!-- Upload Documents and Drawings -->
                    <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                      <div class="pbHeader">
                        <table border="0" cellpadding="0" cellspacing="0">
                          <tbody>
                            <tr>
                              <td class="pbTitle" style="width: 50%;">
                                <h2 class="mainTitle">Upload Documents and Drawings</h2>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="pbBody"><div class="pbSubsection">
                        <apex:outputPanel id="step1uploadAdditional" layout="block">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell">
                                  <div> <!-- Additional Documents -->
                                    <apex:inputCheckbox disabled="{!isDisableAdditionalDocuments}" value="{!proposal.Provided_Documents__c}" styleClass="additionalDocuments specialDisableJQ" onclick="manageDocumentsUpload('Additional Documents');" id="Provided_Documents__c"/>
                                    <label for="ProposalWizardPage:theForm:Provided_Documents__c" class="checkboxLabelText">Additional Documents</label>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell">
                                  <apex:iframe scrolling="true" height="300" src="{!iFrameDocumentsPageReference}" rendered="{!proposal.Provided_Documents__c}"/>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </apex:outputPanel>
                        <apex:outputPanel id="step1uploadDrawings" layout="block">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell">
                                  <div> <!-- Drawings -->
                                    <apex:inputCheckbox disabled="{!isDisableDrawings}" value="{!proposal.Provided_Drawings__c}" styleClass="drawings specialDisableJQ" onclick="manageDrawingsUpload('Drawings');" id="Provided_Drawings__c"/>
                                    <label for="ProposalWizardPage:theForm:Provided_Drawings__c" class="checkboxLabelText">Drawings</label>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell">
                                  <apex:iframe scrolling="true" height="300" src="{!iFrameDrawingsPageReference}" rendered="{!proposal.Provided_Drawings__c}"/>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </apex:outputPanel>
                      </div></div>
                    </div></div></div>
                  </div>
                </div>

                <!-- step 2 -->
                <div style="display: {!IF(proposal.Step__c == 2, 'block', 'none')};" class="mainStyle" id="step2Block">
                  <apex:outputPanel id="step2" layout="block">
                    <div class="step2OverlayHolder" style="position: relative; overflow: auto; -webkit-overflow-scrolling: touch;">
                      <div class="overlay" id="step2TransparentOverlay" style="opacity: 0.7; filter:alpha(opacity=70); display:block;"></div>
                      <div class="overlayContent" id="step2OverlayContent" style="display:block; opacity:1.0; filter:alpha(opacity=100); padding: 15px 30px; border-radius: 10px; border: 2px solid #24A; z-index: 1001; background-color: #E0F2FF; top: 35%;">
                        <div style="text-align: center;">
                          <img src="{!URLFOR($Resource.ProposalWizardResources, 'img/WaitAnimation.gif')}" />
                          <div style="color: #038; margin-bottom: 0px; font-size: 24px; padding-top: 10px; cursor: default;">Please wait</div>
                        </div>
                      </div>
                      <apex:iframe src="/apex/ProposalWizardStep2?accountingHold={!IF(isAccountOrProjectOnHold != null && isAccountOrProjectOnHold == true, 'true', 'false')}{!IF(proposal.Id != null, '&Id=' + proposal.Id, '')}" height="600" scrolling="true" id="step2Iframe"/>
                      <script type="text/javascript">
                        resizeStep2Iframe();
                      </script>
                    </div>
                  </apex:outputPanel>
                </div>

                <!-- step 3 -->
                <div style="display: {!IF(proposal.Step__c == 3, 'block', 'none')};" class="mainStyle" id="step3Block">
                  <apex:outputPanel id="step3" layout="block">

                    <div style="display: {!IF(isCreateNewChangeOrderVisible, 'block', 'none')}; padding: 10px;"> <!-- MRS 6800 -->
                      <apex:commandButton value="Create New Change Order" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold createNewCO" action="{!addChangeOrder}" reRender="notesRightOutputPanel, step4, changeOrderTables, msgs" oncomplete="$('#accordionNotApproved table.generalTableStyle.header').last().click(); if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); }" status="overlay" disabled="{!viewOnly}"/>
                    </div>

                    <div class="message infoM3" style="display: {!IF(showBuildingHint, 'block', 'none')}; margin: 4px 4px 4px 4px;">
                      <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                        <tr valign="top">
                          <td><img alt="INFO" class="msgIcon" src="/s.gif" title="INFO"/></td>
                          <td class="messageCell">
                            <div class="messageText">
                              <span style="color:#0000cc; display:inline-block; font-weight:bold;">Information:</span>
                              <ul style="padding-left: 0px; margin: 0px;">
                                <li>Please mind that you selected a {!buildingHint} building. Make sure to add the appropriate service(s).</li>
                              </ul>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </div>

                    <div class="apexp" style="display: {!IF(!enableStep2Summary, 'block', 'none')};">
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: 2px solid #3887A8 !important; border-bottom: none !important;">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Fees Summary</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td style="width: 50%;"> <!-- Apply Discount -->
                                  <div>
                                    <apex:inputField styleClass="disableAccountingHold" value="{!proposal.Apply_Discount__c}" onclick="recalculateDiscount();" id="Apply_Discount__c"/>
                                    <label for="ProposalWizardPage:theForm:Apply_Discount__c" style="padding-right: 5px;" class="checkboxLabelText">Apply Discount</label>
                                    <apex:outputPanel id="discountPercentage">
                                      <div style="display: {!IF(proposal.Apply_Discount__c, 'inline-block', 'none')};">
                                        <apex:inputText value="{!retrieveDiscountQuantity}" size="4" style="text-align: center;" onChange="recalculateDiscount();" styleClass="disableAccountingHold" />%
                                      </div>
                                    </apex:outputPanel>
                                  </div>
                                </td>
                                <td style="width: 50%;"> <!-- Include Reimbursable Costs -->
                                  <div>
                                    <apex:inputField styleClass="disableAccountingHold" value="{!proposal.Reimbursable_Items_Basis__c}" onclick="recalculateReimbursables();" id="Reimbursable_Items_Basis__c"/>
                                    <label for="ProposalWizardPage:theForm:Reimbursable_Items_Basis__c" style="padding-right: 5px;" class="checkboxLabelText">Include Reimbursable Costs</label>
                                    <apex:outputPanel id="reimbursablePercentage">
                                      <div style="display: {!IF(proposal.Reimbursable_Items_Basis__c, 'inline-block', 'none')};">
                                        <apex:inputText styleClass="disableAccountingHold" value="{!retrieveReimbursableQuantity}" size="4" style="text-align: center;" onChange="recalculateReimbursables();"/>%
                                      </div>
                                    </apex:outputPanel>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;"><!-- Additional Reimbursables -->
                            <tbody>
                              <tr>
                                <td colspan="2">
                                  <span class="checkboxLabelText">Additional Reimbursables:</span>
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <table class="generalTableStyle" style="margin-bottom: 0px;">
                                    <thead>
                                        <tr>
                                            <th style="width: 500px;">Description</th>
                                            <th style="width: 120px;">Amount</th>
											<th style="width: 120px;">Send Muni Fee Invoice</th> <!-- MRS 7298 -->
                                            <th style="width: 50px;">Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <apex:repeat value="{!changeOrderReimbursableMap['Original']}" var="reimbursableRecord">
                                            <tr>
                                                <td>{!reimbursableRecord.Description__c}</td>
                                                <td>{!reimbursableRecord.Amount__c}</td>
												<td style="text-align: center;">
													<apex:inputCheckbox value="{!reimbursableRecord.Send_Muni_Fee_Invoice__c}" onchange="updateAddReimbMuniFeeInvStatus('{!reimbursableRecord.Id}', this);"/> <!-- MRS 7298 -->
												</td>
                                                <td style="text-align: center; padding-top: 0px; padding-bottom: 0px;">
                                                  <div style="display: {!IF(!pwm.originalChangeOrders[0].enableAddNewService || !isThisUserAssignedCZAnalyst || viewOnly,  'none', 'block')};">
                                                    <div>
                                                      <apex:commandLink onclick="reimbursableIdToRemove = '{!reimbursableRecord.Id}'; $('#removeReimbursableActionArea').show(); return false;" styleClass="deleteLinkFloor specialDisableJQ disableAccountingHold">
                                                        <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                                      </apex:commandLink>
                                                    </div>
                                                  </div>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </tbody>
                                  </table>
                                  <apex:repeat value="{!pwm.approvedChangeOrders}" var="coModel" >
                                    <apex:variable var="count" value="{!0}"/>
                                    <apex:repeat value="{!changeOrderReimbursableMap[coModel.changeOrderRecord.Id]}" var="item">
                                      <apex:variable var="count" value="{!count + 1}"/>
                                    </apex:repeat>
                                    <table class="generalTableStyle" style="margin-bottom: 0px; display: {!IF(count == 0, 'none', 'table')};">
                                      <thead>
                                          <tr>
                                            <th colspan="3">Change Order {!changeOrderInfo[coModel.changeOrderRecord.Id].Number__c}</th>
                                          </tr>
                                      </thead>
                                      <tbody>
                                          <apex:repeat value="{!changeOrderReimbursableMap[coModel.changeOrderRecord.Id]}" var="reimbursableRecord">
                                              <tr>
                                                <td style="width: 500px;">{!reimbursableRecord.Description__c}</td>
                                                <td style="width: 120px;">{!reimbursableRecord.Amount__c}</td>
                                                <td style="text-align: center; padding-top: 0px; padding-bottom: 0px; width: 50px;">
                                                  <div style="display: {!IF(!pwm.originalChangeOrders[0].enableAddNewService || !isThisUserAssignedCZAnalyst || viewOnly,  'none', 'block')};">
                                                    <div>
                                                      <apex:commandLink onclick="reimbursableIdToRemove = '{!reimbursableRecord.Id}'; $('#removeReimbursableActionArea').show(); return false;" styleClass="deleteLinkFloor specialDisableJQ">
                                                        <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                                      </apex:commandLink>
                                                    </div>
                                                  </div>
                                                </td>
                                              </tr>
                                          </apex:repeat>
                                      </tbody>
                                    </table>
                                  </apex:repeat>
                                </td>
                                <td style="vertical-align: top;">
                                  <apex:commandButton id="addNewProposalReimbursableBtn" value="Add New" styleClass="specialDisableJQ disableAccountingHold" onclick="changeRightPanelToReimbursable(''); return false;" disabled="{!!pwm.originalChangeOrders[0].enableAddNewService || (!isThisUserCreator && !isAssignedInternalReviewer) || !isThisUserAssignedCZAnalyst || viewOnly || !proposal.Reimbursable_Items_Basis__c}"/>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div></div></div>
                    </div>

                    <apex:outputPanel id="changeOrderTables">
                      <div class="apexp">
                        <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: none !important; border-bottom: none !important;">
                          <div class="pbHeader">
                            <table border="0" cellpadding="0" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td class="pbTitle lockedWidthJQ" style="width: 33%;">
                                    <h2 class="mainTitle">{!IF(isChangeOrder, 'Original Proposal Services', 'Services Table')}</h2>
                                  </td>
                                  <td style="text-align: right; padding-top: 0px; padding-bottom: 0px; width: 67%; padding-right: 0px;" class="pbButton">
                                    <div style="display: inline-block; padding: 0px 10px 0px 0px;">
                                      <div style="display: inline-block;">
                                        <label class="labelText" for="c2g__CODASalesTaxStatus__c" style="padding: 0px 4px 0px 0px;">Sales Tax Status:</label>
                                      </div>
                                      <div style="display: inline-block;">
                                        <input type="text" value="{!IF(billingAccount.c2g__CODASalesTaxStatus__c != null, billingAccount.c2g__CODASalesTaxStatus__c, '')}" style="width: 150px; text-align: center; padding: 0px;" disabled="true" id="c2g__CODASalesTaxStatus__c"/>
                                      </div>
                                    </div>

                                    <div style="display: inline-block; padding: 0px 10px 0px 0px;">
                                      <div style="display: inline-block;">
                                        <label style="padding: 0px 4px 0px 0px;" class="labelText">Received Signed Proposal:</label>
                                      </div>
                                      <div style="display: inline-block;">
                                        <apex:inputCheckbox value="{!proposal.Received_Signed_Proposal__c}" onclick="changeProposalReceivedDocumentStatus();" styleClass="specialDisableJQ disableAccountingHold" disabled="{!disableReceivedSignedProposalCheckbox}" />
                                      </div>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="pbBody">
                            <div>
                              <div id="servicesTableNotification">
                                <div class="message infoM3" style="display: {!IF( proposal.Is_Draft__c && !ISBLANK(proposal.sowScopeOfWork__c) && CONTAINS(proposal.sowScopeOfWork__c, 'Existing Space') && proposal.sowServicesNeededAPS__c && proposal.sowServicesNeededOther__c && (isAdmin || isPS), 'block', 'none')}; margin: 4px 4px; 4px 20px;">
                                  <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                                    <tr valign="top">
                                      <td><img alt="INFO" class="msgIcon" src="/s.gif" title="INFO"/></td>
                                      <td class="messageCell">
                                        <div class="messageText">
                                           <span style="color:#0000cc; display:inline-block; font-weight:bold;">Information:</span>
                                           <ul style="padding-left: 0px; margin: 0px;">
                                             <li>Please add Other Services from the list on the right.</li>
                                           </ul>
                                        </div>
                                      </td>
                                    </tr>
                                  </table>
                                </div>
                              </div>
                              <div id="servicesTableNotificationWrongGroup" style="display: none;">
                                <div class="message infoM3" style="margin: 4px 4px 4px 20px;">
                                  <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                                    <tr valign="top">
                                      <td><img alt="INFO" class="msgIcon" src="/s.gif" title="INFO"/></td>
                                      <td class="messageCell">
                                        <div class="messageText">
                                           <span style="color:#0000CC; display:inline-block; font-weight:bold;">Information:</span>
                                           <ul style="padding-left: 0px; margin: 0px; color: #000000;">
                                             <li>'Service Group' should contain an integer number up to 3 digits.</li>
                                           </ul>
                                        </div>
                                      </td>
                                    </tr>
                                  </table>
                                </div>
                              </div>

                              <!-- original services table -->
                              <table id="servicesTable" class="generalTableStyle servicesTableJQ disableAccountingHold">
                                <thead>
                                  <tr class="nodrop nodrag">
                                    <th style="display: {!IF( ( pwm.originalChangeOrders[0].isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( pwm.originalChangeOrders[0].isRemoveVisible && isThisUserAssignedCZAnalyst ) || ( proposal.isPhase__c && pwm.originalChangeOrders[0].isPhasesVisible && !(proposal.Status__c == 'Awarded' && !proposal.is_Change_Order__c ) ), 'table-cell', 'none')};">
                                      <apex:inputCheckbox styleClass="serviceCheckboxP specialDisableJQ disableAccountingHold" onclick="serviceParentCheckboxActionJS( '.servicesTableJQ' );" disabled="{!viewOnly}"/>
                                    </th>
                                    <th>Service Name</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')};">Floors</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isServiceGroupVisible, 'table-cell', 'none')};">Service<br/>Group</th>
                                    <th style="display: {!IF(proposal.isPhase__c && pwm.originalChangeOrders[0].isPhasesVisible, 'table-cell', 'none')};">Phase</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isPurchaseOrderVisible && rightPanelView == 'PurchaseOrder', 'table-cell', 'none')};">Purchase<br/>Order #</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isMunicipalAgencyVisible, 'table-cell', 'none')};">Municipal<br/>Agency ID#</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isUnitOfServiceVisible, 'table-cell', 'none')};">Unit of<br/>Service</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isQuantityVisible, 'table-cell', 'none')};">Quantity</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isUnitPriceVisible, 'table-cell', 'none')};">Unit<br/>Price</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isLastPriceVisible, 'table-cell', 'none')};">Last<br/>Proposed<br/>Price</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible, 'table-cell', 'none')};" class="totalServicePriceJQ">Total<br/>Service<br/>Price</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isActivityStatusVisible, 'table-cell', 'none')};">Activity<br/>Status</th>
                                    <th style="display: {!IF(pwm.originalChangeOrders[0].isRemoveVisible && isThisUserAssignedCZAnalyst, 'table-cell', 'none')};">Del</th>
                                  </tr>
                                </thead>
                                <tbody id="{!originalChangeOrderKey}" class="originalChangeOrderJQ disableAccountingHold">
                                  <apex:repeat value="{!pwm.originalChangeOrders[0].serviceModels}" var="sm">
                                    <tr id="{!sm.recordId}" recordid="{!sm.recordId}" class="{!IF(proposal.is_Change_Order__c, 'nodrop nodrag', '')}" style="{!IF(sm.serviceItemRecord.Service_Group_Key__c != null,'background-color: #EDF3F6;','')}">
                                      <td class="data" style="display: {!IF( ( pwm.originalChangeOrders[0].isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( pwm.originalChangeOrders[0].isRemoveVisible && isThisUserAssignedCZAnalyst ) || ( proposal.isPhase__c && pwm.originalChangeOrders[0].isPhasesVisible && !(proposal.Status__c == 'Awarded' && !proposal.is_Change_Order__c ) ), 'table-cell', 'none')};">
                                        <apex:inputCheckbox rendered="{!( sm.isFloorsEditable && !sm.isQuantityChangeOrder && !sm.isAmendmendDeleted ) || ( !viewOnly && sm.isRemoveEditable && !sm.isQuantityChangeOrder && (!proposal.is_Change_Order__c || (proposal.is_Change_Order__c && pwm.notApprovedChangeOrders.size > 0 && !sm.isAmendmendDeleted)) ) || ( sm.isPhasesEditable && !sm.isQuantityChangeOrder && !sm.isAmendmendDeleted )}" value="{!sm.checked}" styleClass="serviceCheckboxes specialDisableJQ disableAccountingHold" onclick="serviceCheckboxActionJS( '#servicesTable tbody' );" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                                      </td>
                                      <td class="name{!IF(proposal.is_Change_Order__c, '', ' dragHandle')}">
                                        <span style="color: {!IF(sm.isAmendmendDeleted, 'red', IF(sm.isAmendmendAdded, 'green', IF( sm.isQuantityChangeOrder, '#FF0101', 'black') ) )};">
                                          <span style="display: inline; cursor: pointer;" onClick="window.open('/{!sm.serviceItemRecord.Id}', '_blank'); return false;">[#{!serviceInfo[sm.recordId].Service_Template__r.Service_Row_Number__c} - {!serviceInfo[sm.recordId].Name}]</span>
                                          {!serviceInfo[sm.recordId].Service_Name_Full__c}
                                        </span>
                                      </td>
                                      <td class="{!IF(sm.isFloorsEditable && !sm.isQuantityChangeOrder && !sm.isAmendmendDeleted && !isAccountOrProjectOnHold, 'editableFloor', '')} disableAccountingHold" style="display: {!IF(pwm.originalChangeOrders[0].isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')}; white-space: nowrap;" onclick="if( $(this).hasClass('editableFloor') ) { prepareServiceJunctionsData( '{!sm.recordId}', serializeServices() ); }" title="{!serviceInfo[sm.recordId].Floor__c}">
                                        {!serviceInfo[sm.recordId].Floor_Concatenated__c}
                                      </td>
                                      <td class="data {!IF(sm.isServiceGroupRequired, 'required', '')}" style="display: {!IF(pwm.originalChangeOrders[0].isServiceGroupVisible, 'table-cell', 'none')};">
                                        <div><div></div><div>
                                          <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.serviceGroup}" size="2"
                                            disabled="{!!sm.isServiceGroupEditable || sm.isQuantityChangeOrder || sm.isAmendmendDeleted || proposal.is_Change_Order__c || viewOnly}" onFocus="this.priorValue = this.value;" onChange="if( {!sm.isServiceGroupRequired} ) { if( this.value == '' || this.value.replace(/^([1-9][0-9]{0,2})$/g, '') == '' ) { this.priorValue = this.value; $('#servicesTableNotificationWrongGroup').hide(); } else { this.value = this.priorValue; $('#servicesTableNotificationWrongGroup').show();} }"/>
                                        </div></div>
                                      </td>
                                      <td class="data{!IF( sm.isPhasesEditable && !sm.isQuantityChangeOrder && !sm.isAmendmendDeleted && !isAccountOrProjectOnHold, ' editablePhase', '' )}{!IF(sm.pendingPhaseSave, ' pending', '')}" style="display: {!IF(proposal.isPhase__c && pwm.originalChangeOrders[0].isPhasesVisible, 'table-cell', 'none')};" onclick="if( $(this).hasClass('editablePhase') ) { moveServicesToPhase( null, '{!sm.recordId}' ); }">
                                        {!phaseInfo[sm.phaseId].Name__c}
                                      </td>
                                      <td class="data" style="display: {!IF(AND(pwm.originalChangeOrders[0].isPurchaseOrderVisible, rightPanelView == 'PurchaseOrder'), 'table-cell', 'none')};">
                                        {!sm.purchaseOrderNumber}
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.originalChangeOrders[0].isMunicipalAgencyVisible, 'table-cell', 'none')};">
                                        <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.municipalAgency}" size="8" disabled="{!!sm.isMunicipalAgencyEditable || sm.isQuantityChangeOrder || sm.isAmendmendDeleted || viewOnly}"/>
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.originalChangeOrders[0].isUnitOfServiceVisible, 'table-cell', 'none')};">
                                        {!sm.unitOfService}
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.originalChangeOrders[0].isQuantityVisible, 'table-cell', 'none')};">
                                        <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityStr}" size="2" onfocus="this.priorValue = this.value;" onchange="changeQuantity( this.value, this.priorValue, '{!sm.recordId}', activeChangeOrderId, 'false', serializeServices() );" disabled="{!!sm.isQuantityEditable || ( !sm.isHourlyService && !sm.isQuantityEditableForSIPS ) || sm.isAmendmendDeleted || sm.isQuantityChangeOrder || ( proposal.is_Change_Order__c && pwm.notApprovedChangeOrders.size == 0 ) || viewOnly }" rendered="{!!sm.isQuantityChangeOrder}"/>
                                        <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityOldStr}" size="2" disabled="true" rendered="{!sm.isQuantityChangeOrder}"/>
                                      </td>
                                      <td class="data {!IF(sm.isUnitPriceRequired, 'required', '')}" style="display: {!IF(pwm.originalChangeOrders[0].isUnitPriceVisible, 'table-cell', 'none')};">
                                        <div><div></div><div>
                                          <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.servicePriceStr}" size="4" style="{!IF(sm.hasClientPrice, 'font-weight: bold; ', '')}" disabled="{!!sm.isUnitPriceEditable || sm.isQuantityChangeOrder || sm.isAmendmendDeleted || viewOnly}" onChange="changeServiceUnitPrice('{!sm.recordId}');"/>
                                        </div></div>
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.originalChangeOrders[0].isLastPriceVisible, 'table-cell', 'none')};">
                                        <apex:outputLink styleClass="specialDisableJQ disableAccountingHold" rendered="{!!ISBLANK(sm.lastProposalPriceId)}" target="_blank" value="/{!sm.lastProposalId}">{!sm.lastProposalPrice}</apex:outputLink>
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible, 'table-cell', 'none')};">
                                        <span>{!IF(sm.isQuantityChangeOrder, ROUND(sm.totalServicePriceOld, 2), ROUND(sm.totalServicePrice, 2) )}</span>
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.originalChangeOrders[0].isActivityStatusVisible, 'table-cell', 'none')};">
                                        {!sm.activityStatus}
                                      </td>
                                      <td style="display: {!IF(AND(pwm.originalChangeOrders[0].isRemoveVisible, isThisUserAssignedCZAnalyst), 'table-cell', 'none')}; text-align: center;">
                                        <div class="removeServiceButtonJQ">
                                          <div class="specialDisableJQ disableAccountingHold" style="cursor: pointer; display: {!IF( !viewOnly && !isAccountOrProjectOnHold && sm.isRemoveEditable && !sm.isQuantityChangeOrder && (!proposal.is_Change_Order__c || (proposal.is_Change_Order__c && pwm.notApprovedChangeOrders.size > 0 && !sm.isAmendmendDeleted)), 'block', 'none')};" onclick="removeServiceModel('{!sm.recordId}', activeChangeOrderId, serializeServices());">
                                            <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                          </div>
                                        </div>
                                      </td>
                                    </tr>
                                  </apex:repeat>
                                </tbody>

                                <!-- Approved CO services table -->
                                <apex:repeat value="{!pwm.approvedChangeOrders}" var="coModel" >
                                  <tbody id="{!coModel.changeOrderRecord.Id}" class="approvedChangeOrderJQ">
                                    <tr class="nodrop nodrag">
                                      <th class="fullTableColSpanJQ">
                                        <div style="display: inline-block; padding-top: 3px;">
                                          <span style="display: {!IF(isAdmin, 'inline', 'none')}; cursor: pointer;" onClick="window.open('/{!coModel.changeOrderRecord.Id}', '_blank'); return false;">[{!changeOrderInfo[coModel.changeOrderRecord.Id].Name}]</span>
                                          Change Order {!changeOrderInfo[coModel.changeOrderRecord.Id].Number__c},&nbsp;Approved Date:&nbsp;<apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!changeOrderInfo[coModel.changeOrderRecord.Id].Approved_Date__c}"/></apex:outputText>
                                        </div>
                                        <div style="text-align: right; display: inline-block; float: right; margin-top: 0px; margin-bottom: 0px;">
                                          <div style="display: inline-block; padding: 0px 10px 0px 0px; margin-top: 1px; margin-bottom: 0px;">
                                            <div style="display: inline-block;">
                                              <label style="padding: 0px 4px 0px 0px; position: relative; top: -2px;" class="labelText">Received Signed CO:</label>
                                            </div>
                                            <div style="display: inline-block;">
                                              <apex:inputCheckbox value="{!coModel.changeOrderRecord.Received_Signed_CO__c}" onclick="changeCOReceivedDocumentStatus('{!coModel.changeOrderRecord.Id}');" styleClass="specialDisableJQ receivedSignedCO disableAccountingHold" style="margin-top: 0px; margin-bottom: 0px;" disabled="{!disableReceivedSignedProposalCheckbox}" />
                                            </div>
                                          </div>
                                        </div>
                                      </th>
                                    </tr>
                                    <apex:repeat value="{!coModel.serviceModels}" var="sm">
                                      <tr class="nodrop nodrag" recordid="{!sm.recordId}" style="{!IF(sm.serviceItemRecord.Service_Group_Key__c != null,'background-color: #EDF3F6;','')}">
                                        <td class="data" style="display: {!IF( ( coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( coModel.isRemoveVisible ) || ( proposal.isPhase__c && coModel.isPhasesVisible ), 'table-cell', 'none')};">
                                          <apex:inputCheckbox rendered="{!( sm.isFloorsEditable && !(sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id) ) || ( !viewOnly && sm.isRemoveEditable && pwm.notApprovedChangeOrders.size > 0 && !sm.isAmendmendDeleted && !sm.isQuantityChangeOrder ) || ( sm.isPhasesEditable && !sm.isAmendmendDeleted )}" value="{!sm.checked}" styleClass="serviceCheckboxes specialDisableJQ disableAccountingHold" onclick="serviceCheckboxActionJS( '#servicesTable tbody' );" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                                        </td>
                                        <td class="name">
                                          <span style="color: {!IF( sm.isAmendmendDeleted || (sm.isQuantityChangeOrder && sm.changeOrderId == coModel.changeOrderRecord.Id) , 'red', IF(sm.isAmendmendAdded && !sm.isQuantityChangeOrder, 'green', IF( ( sm.isQuantityChangeOrder && sm.changeOrderOldId == coModel.changeOrderRecord.Id ), '#FF0101', 'black') ) )};">
                                            <span style="display: inline; cursor: pointer;" onClick="window.open('/{!sm.serviceItemRecord.Id}', '_blank'); return false;">[#{!serviceInfo[sm.recordId].Service_Template__r.Service_Row_Number__c} - {!serviceInfo[sm.recordId].Name}]</span>
                                            {!serviceInfo[sm.recordId].Service_Name_Full__c}
                                          </span>
                                        </td>
                                        <td class="{!IF(sm.isFloorsEditable && !(sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id && !isAccountOrProjectOnHold), 'editableFloor', '')} " style="display: {!IF(coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')}; white-space: nowrap;" onclick="if( $(this).hasClass('editableFloor') ) { prepareServiceJunctionsData( '{!sm.recordId}', serializeServices() ); }" title="{!serviceInfo[sm.recordId].Floor__c}">
                                          {!serviceInfo[sm.recordId].Floor_Concatenated__c}
                                        </td>
                                        <td class="data required" style="display: {!IF(coModel.isServiceGroupVisible, 'table-cell', 'none')};">
                                          <div><div></div><div>
                                            <apex:inputText styleClass="tableInput specialDisableJQ" value="{!sm.serviceGroup}" size="2" disabled="{!!sm.isServiceGroupEditable || (sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id) || viewOnly}" onFocus="this.priorValue = this.value;" onChange="if( this.value == '' || this.value.replace(/^([1-9][0-9]{0,2})$/g, '') == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; }"/>
                                          </div></div>
                                        </td>
                                        <td class="data{!IF( sm.isPhasesEditable && !sm.isAmendmendDeleted && !isAccountOrProjectOnHold, ' editablePhase', '' )}{!IF(sm.pendingPhaseSave, ' pending', '')}" style="display: {!IF(proposal.isPhase__c && coModel.isPhasesVisible, 'table-cell', 'none')};" onclick="if( $(this).hasClass('editablePhase') ) { moveServicesToPhase( null, '{!sm.recordId}' ); }">
                                           {!phaseInfo[sm.phaseId].Name__c}
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isPurchaseOrderVisible, 'table-cell', 'none')};">
                                          {!sm.purchaseOrderNumber}
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isMunicipalAgencyVisible, 'table-cell', 'none')};">
                                          <apex:inputText styleClass="tableInput specialDisableJQ" value="{!sm.municipalAgency}" size="8" disabled="{!!sm.isMunicipalAgencyEditable || (sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id) || viewOnly}"/>
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isUnitOfServiceVisible, 'table-cell', 'none')};">
                                          {!sm.unitOfService}
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isQuantityVisible, 'table-cell', 'none')};">
                                          <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityStr}" size="2" onfocus="this.priorValue = this.value;" onchange="changeQuantity( this.value, this.priorValue, '{!sm.recordId}', activeChangeOrderId, 'false', serializeServices() );" disabled="{!(!sm.isAmendmendAdded && !sm.isQuantityEditable) || sm.isAmendmendDeleted || !sm.isHourlyService || ( proposal.is_Change_Order__c && pwm.notApprovedChangeOrders.size == 0 ) || sm.isQuantityChangeOrder || viewOnly}" rendered="{!!sm.isQuantityChangeOrder}"/>
                                          <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityOldStr}" size="2" disabled="true" rendered="{!sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id}"/>
                                          <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityDiffStr}" size="2" disabled="true" rendered="{!sm.isQuantityChangeOrder && sm.changeOrderId == coModel.changeOrderRecord.Id}"/>
                                        </td>
                                        <td class="data {!IF(sm.isUnitPriceRequired, 'required', '')}" style="display: {!IF(coModel.isUnitPriceVisible, 'table-cell', 'none')}">
                                          <div><div></div><div>
                                            <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.servicePriceStr}" size="4" style="{!IF(sm.hasClientPrice, 'font-weight: bold; ', '')}" disabled="{!!sm.isUnitPriceEditable || (sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id) || viewOnly}" onChange="changeServiceUnitPrice('{!sm.recordId}');"/>
                                          </div></div>
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isLastPriceVisible, 'table-cell', 'none')}">
                                          <apex:outputLink styleClass="specialDisableJQ disableAccountingHold" rendered="{!!ISBLANK(sm.lastProposalPriceId)}" target="_blank" value="/{!sm.lastProposalId}">{!sm.lastProposalPrice}</apex:outputLink>
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isTotalPriceVisible, 'table-cell', 'none')}">
                                          <apex:outputText rendered="{!!sm.isQuantityChangeOrder}">{!IF(sm.isAmendmendDeleted && sm.changeOrderId == coModel.changeOrderRecord.Id, '-', '')}{!ROUND(sm.totalServicePrice, 2)}</apex:outputText>
                                          <apex:outputText rendered="{!sm.isQuantityChangeOrder && sm.changeOrderId != coModel.changeOrderRecord.Id}">{!ROUND(sm.totalServicePriceOld, 2)}</apex:outputText>
                                          <apex:outputText rendered="{!sm.isQuantityChangeOrder && sm.changeOrderId == coModel.changeOrderRecord.Id}">{!ROUND(sm.totalServicePriceDiff, 2)}</apex:outputText>
                                        </td>
                                        <td class="data" style="display: {!IF(coModel.isActivityStatusVisible, 'table-cell', 'none')};">
                                          {!sm.activityStatus}
                                        </td>
                                        <td style="display: {!IF(coModel.isRemoveVisible, 'table-cell', 'none')}; text-align: center;">
                                          <div class="removeServiceButtonJQ">
                                            <div class="specialDisableJQ disableAccountingHold" style="cursor: pointer; display: {!IF( !viewOnly && !isAccountOrProjectOnHold && sm.isRemoveEditable && pwm.notApprovedChangeOrders.size > 0 && !sm.isAmendmendDeleted && !sm.isQuantityChangeOrder, 'block', 'none')};" onclick="removeServiceModel('{!sm.recordId}', activeChangeOrderId, serializeServices());">
                                              <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                            </div>
                                          </div>
                                        </td>
                                      </tr>
                                    </apex:repeat>
                                  </tbody>
                                </apex:repeat>
                                <tr class="nodrop nodrag" style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible, 'table-row', 'none')}">
                                  <td class="footer footerLeftJQ">Subtotal</td>
                                  <td class="data bold"><apex:outputText value="{!ROUND(pwm.changeOrderTotalsMap['Subtotal']['Original'], 2)}"/></td>
                                  <td class="footer footerRightJQ"></td>
                                </tr>
                                <tr class="nodrop nodrag" style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible && pwm.changeOrderTotalsMap['Discount']['Original'] != 0, 'table-row', 'none')}">
                                  <td class="footer footerLeftJQ">Discount Applied</td>
                                  <td class="data bold"><apex:outputText value="{!ROUND(pwm.changeOrderTotalsMap['Discount']['Original'], 2) * -1}"/></td>
                                  <td class="footer footerRightJQ"></td>
                                </tr>
                                 <tr class="nodrop nodrag" style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible, 'table-row', 'none')}">
                                  <td class="footer footerLeftJQ">Sales Tax</td>
                                  <td class="data bold"><apex:outputText id="totalServiceSalesTax" value="{!ROUND(pwm.changeOrderTotalsMap['Sales Tax']['Original'], 2)}"/></td>
                                  <td class="footer footerRightJQ"></td>
                                </tr>
                                <tr class="nodrop nodrag" style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible, 'table-row', 'none')}">
                                  <td class="footer footerLeftJQ">Reimbursable Costs</td>
                                  <td class="data bold"><apex:outputText id="totalServiceReimbursables" value="{!ROUND(pwm.changeOrderTotalsMap['Reimbursable Costs']['Original'], 2)}"/></td>
                                  <td class="footer footerRightJQ"></td>
                                </tr>
                                <tr class="nodrop nodrag" style="display: {!IF(pwm.originalChangeOrders[0].isTotalPriceVisible, 'table-row', 'none')}">
                                  <td class="footer footerLeftJQ">Cost Of Services</td>
                                  <td class="data bold"><apex:outputText id="totalServiceCost" value="{!ROUND(pwm.changeOrderTotalsMap['Cost Of Services']['Original'], 2)}"/></td>
                                  <td class="footer footerRightJQ"></td>
                                </tr>
                              </table>
                              <div style="text-align: right;"><!--

                                Create Non-Fee Proposal
                                --><apex:outputPanel layout="block" id="createNonFeeProposalButton" rendered="{!isAdmin || isPManager2 || isPManager1}" style="display: inline;">
                                  <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" disabled="{!proposal.Status__c != 'Awarded' || viewOnly}" value="Create Non-Fee Proposal" onclick="createNonFeeProposalPDF( currentStep, getFormPosition() ); return false;"/>
                                </apex:outputPanel><!--

                                Add/Modify Client PO
                                --><apex:outputPanel layout="block" id="addClientPurchaseOrderButton" style="display: inline;">
                                  <apex:commandButton value="Add/Modify Client PO" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!isAddPurchaseOrderButtonEnabled}" disabled="{!disableAddPurchaseOrderButton || viewOnly}" onclick="showOverlay(); showAddManagePOsWindow();" reRender="none"/> <!-- MRS 6860 -->
                                </apex:outputPanel><!--

                                Move Services to Alternative Table MRS 6931
                                --><span>
                                  <apex:commandButton value="Move To Alternative" rendered="{!pwm.originalChangeOrders[0].isMovableVisible && !proposal.is_Change_Order__c}" styleClass="milroseBtnStyle movingServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="moveServiceBetweenTables( '.servicesTableJQ' ); return false;"/>
                                </span><!--

                                Delete Multiple Services
                                --><div style="display: inline;">
                                  <apex:commandButton value="Delete Services" rendered="{!pwm.originalChangeOrders[0].isRemoveVisible}" styleClass="milroseBtnStyle deleteServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="deleteServices( '.servicesTableJQ' ); return false;"/>
                                </div><!--

                                Assign Floors To Services
                                --><div style="display: inline;">
                                  <apex:commandButton value="Assign Floors To Services" rendered="{!pwm.originalChangeOrders[0].isFloorsVisible && proposal.Is_Floors_To_Services__c}" styleClass="milroseBtnStyle assignFloorsButton specialDisableJQ disableAccountingHold" disabled="true" onclick="assignServicesToFloors( '.servicesTableJQ' ); return false;"/>
                                </div><!--

                                Move Services To Phase
                                --><div style="display: inline;">
                                  <apex:commandButton value="Move Services To Phase" rendered="{!( isAnyAllowedProfile || isThisUserAssignedSIPSUser || isChangeOrderAllowedOnProjectOrServiceItemLevel ) && proposal.isPhase__c}" styleClass="milroseBtnStyle moveServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="moveServicesToPhase( '.servicesTableJQ' ); return false;"/>
                                </div><!--
                                --><apex:outputPanel layout="block" id="servicesManagementButtons" style="display: inline;"><!--

                                  Save Service Bundle
                                  --><div style="display: inline;">
                                    <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!pwm.originalChangeOrders[0].showSaveServiceBundle}" value="Save Service Bundle" onclick="changeOrderId = ''; virtualChangeOrderName = 'Original'; $('#saveServiceBundlePanelActionArea').css('display', 'block'); return false;" disabled="{!pwm.originalChangeOrders[0].serviceModels.size == 0 || !pwm.originalChangeOrders[0].enableSaveServiceBundle || !isThisUserAssignedCZAnalyst || viewOnly || ( isThisUserAssignedSIPSUser && !isAdmin && !pwm.originalChangeOrders[0].hasSIPSServices ) }" id="saveServiceBundleButtonOriginal"/>
                                  </div><!--

                                  + Add New Service MRS 7335
                                  --><div style="display: inline;">
                                    <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!pwm.originalChangeOrders[0].showAddNewService}" value="+ Add New Service" onclick="changeRightPanelToServiceItem('General', ''); return false;" disabled="{!!pwm.originalChangeOrders[0].enableAddNewService || !isThisUserAssignedCZAnalyst || viewOnly}"/>
                                  </div><!--

                                  Manage Service Bundle
                                  --><div style="display: inline;">
                                    <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!pwm.originalChangeOrders[0].showInsertServiceBundle}" value="Manage Service Bundle" onclick="changeOrderId = ''; virtualChangeOrderName = 'Original'; $('#loadServiceBundlePanelActionArea').show(); return false;" disabled="{!!pwm.originalChangeOrders[0].enableInsertServiceBundle || !isThisUserAssignedCZAnalyst || viewOnly}"/>
                                  </div><!--

                                  Add Non-Billable Reason MRS 7056
                                  --><div style="display: inline;">
                                    <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="true" value="Add Non-Billable Reason"
                                    disabled="{!!pwm.hasNonBillabale || viewOnly}" style="{!IF(pwm.hasNonBillableWithoutReason == true, 'font-weight: bold', 'font-weight: normal')}" onclick="showOverlay(); table='.servicesTableJQ'; $('#showSettingNonBillableReasonWnd').toggle();" reRender="none"/>
                                  </div><!--
                                --></apex:outputPanel><!--
                              --></div>
                              <script type="text/javascript">
                                $('table.servicesTableJQ').parents('div.bPageBlock').find('div.pbHeader td.pbTitle').not('.lockedWidthJQ').css('width', '50%');
                                attachDndToTables('.servicesTableJQ');
                                calculateTableColspans('.servicesTableJQ');
                                serviceParentCheckboxCheckJS( '.servicesTableJQ' );
                              </script>
                            </div>
                          </div>
                        </div>
                      </div></div></div>

                      <!-- Municipal Authority Fees Notes -->
                      <div class="apexp" style="display: {!IF(isThisUserCreator || isAssignedInternalReviewer, 'block', 'none')};">
                        <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-bottom: none !important;">
                          <div class="pbHeader">
                            <table border="0" cellpadding="0" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td class="pbTitle" style="width: 50%;">
                                    <h2 class="mainTitle">Municipal Authority Fees Notes</h2>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="pbBody">
                            <div style="display: table;" id="municipalAuthorityFeesArea">
                              <div style="display: table-cell;">
                                <div>
                                  <label for="ProposalWizardPage:theForm:municipalAuthorityFees" style="display: block;" class="labelText">Municipal Authority Fees:</label>
                                </div>
                                <div>
                                  <div>
                                    <apex:inputField id="municipalAuthorityFees" value="{!proposal.Municipal_Authority_Fees__c}" styleClass="disableAccountingHold" /> <!-- MRS-6886 -->
                                  </div>
                                </div>
                              </div>
                                <script>  // MRS-6886
                                    $('[id$=municipalAuthorityFees]').parent().find('select').not('[id$=municipalAuthorityFees]').each(function() { $(this).attr("style", "min-width: 300px; max-width: 300px;"); });
                                </script>
                              <div style="display: table-cell; padding-left: 10px; vertical-align: top;" id="projectedDOBFeeArea">
                                <div>
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Projected_DOB_Fee__c" style="display: block; width: 70px;" class="labelText">DOB Fee:</label> <!-- MRS-6886 -->
                                  </div>
                                  <div id="Projected_DOB_Fee__c" layout="block" style="margin-top: 10px;">
                                    <apex:inputField value="{!proposal.Projected_DOB_Fee__c}" styleClass="disableAccountingHold" style="width: 70px;" /> <!-- MRS-6886 -->
                                  </div>
                                </div>
                              </div>
                            </div>
                            <script type="text/javascript">
                              initMunicipalAuthorityFeesNotesArea();
                            </script>
                          </div>
                        </div>
                      </div></div></div>

                      <!-- General Proposal Notes -->
                      <div class="apexp" style="display: {!IF(!proposal.is_Change_Order__c && isThisUserCreator, 'block', 'none')};">
                        <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-bottom: none !important;">
                          <div class="pbHeader">
                            <table border="0" cellpadding="0" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td class="pbTitle" style="width: 50%;">
                                    <h2 class="mainTitle">General Proposal Notes</h2>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="pbBody">
                            <apex:inputField value="{!proposal.General_Proposal_Notes__c}" style="width: 100%; resize: none;" styleClass="specialDisableJQ disableAccountingHold" id="generalProposalNotes"/>
                          </div>
                        </div>
                      </div></div></div>

                      <!-- NOT Approved CO services table -->
                      <script type="text/javascript">
                        if( {!pwm.notApprovedChangeOrders.size} == 0 ) activeChangeOrderId = '';
                      </script>
                      <div class="apexp" style="display: {!IF(proposal.is_Change_Order__c && pwm.notApprovedChangeOrders.size > 0, 'block', 'none')};">
                        <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: 2px solid #3887A8 !important; border-bottom: none !important;">
                          <div class="pbHeader">
                            <table border="0" cellpadding="0" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td class="pbTitle" style="width: 50%;">
                                    <h2 class="mainTitle">
                                      Change Orders
                                    </h2>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="pbBody">
                            <div id="accordionNotApproved">
                              <apex:repeat value="{!pwm.notApprovedChangeOrders}" var="coModel">
                                <span style="width: 100%;" class="accordionHeaderJQ">
                                  <table class="generalTableStyle {!coModel.changeOrderRecord.Id} header" style="margin-bottom: 0px;" onclick="activeChangeOrderId = '{!coModel.changeOrderRecord.Id}'; modifyOriginalApprovedCoEditability( {!coModel.enableOriginalApprovedCO}, {!coModel.enableInternalCO} );">
                                    <tr style="text-align: left;">
                                      <td>
                                        <div class="accordionImage" style="display: inline-block;"></div>&nbsp;
                                        <span style="display: {!IF(isAdmin, 'inline', 'none')}; cursor: pointer;" onClick="window.open('/{!coModel.changeOrderRecord.Id}', '_blank'); return false;">[{!changeOrderInfo[coModel.changeOrderRecord.Id].Name}]</span>
                                        Change Order{!IF(changeOrderInfo[coModel.changeOrderRecord.Id].Number__c != null, ' ' + TEXT(changeOrderInfo[coModel.changeOrderRecord.Id].Number__c), '')},&nbsp;{!IF( coModel.status == 'Draft', 'Created Date:', 'Request Date:' )}&nbsp;<apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!IF(changeOrderInfo[coModel.changeOrderRecord.Id].Change_Request_Date__c == null, changeOrderInfo[coModel.changeOrderRecord.Id].CreatedDate, changeOrderInfo[coModel.changeOrderRecord.Id].Change_Request_Date__c)}"/></apex:outputText>,&nbsp;
                                        Status: {!coModel.status}
                                      </td>
                                    </tr>
                                  </table>
                                </span>
                                <div>
                                  <!-- Fees Summary -->
                                  <div class="apexp" style="display: {!IF(!enableStep2Summary, 'block', 'none')};">
                                    <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: none; !important; border-bottom: none !important;">
                                      <div class="pbHeader">
                                        <table border="0" cellpadding="0" cellspacing="0">
                                          <tbody>
                                            <tr>
                                              <td class="pbTitle" style="width: 50%;">
                                                <h2 class="mainTitle">Fees Summary</h2>
                                              </td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </div>
                                      <div class="pbBody">
                                        <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                                          <tbody>
                                            <tr>
                                              <td style="width: 50%;"> <!-- Apply Discount -->
                                                <div>
                                                  <apex:inputCheckbox value="{!coModel.changeOrderRecord.Apply_Discount__c}" onclick="updateChangeOrderDiscountData('{!coModel.changeOrderRecord.Id}');" disabled="{!!coModel.enableAddNewService || viewOnly}" styleClass="specialDisableJQ disableAccountingHold"/>
                                                  <label style="padding-right: 5px;" class="checkboxLabelText">Apply Discount</label>
                                                  <div style="display: {!IF(coModel.changeOrderRecord.Apply_Discount__c, 'inline-block', 'none')};">
                                                    <apex:inputField value="{!coModel.changeOrderRecord.Discount_Percentage__c}" style="text-align: center; width: 40px; margin-right: 3px;" onFocus="this.priorValue = this.value;" onChange="if( this.value >= 0 && this.value <= 100 && this.value.match(/^\d+$/)) { this.priorValue = this.value; updateChangeOrderDiscountData('{!coModel.changeOrderRecord.Id}'); } else { this.value = this.priorValue;}" rendered="{!coModel.enableAddNewService && !viewOnly}" styleClass="specialDisableJQ disableAccountingHold"/>
                                                    <apex:outputText value="{!coModel.changeOrderRecord.Discount_Percentage__c}" rendered="{!!coModel.enableAddNewService || viewOnly}" style="background: #EBEBE4; border: 1px solid #CCC; color: #545454; margin: 2px 3px 2px 0; padding-bottom: 1px; display: inline-block; font: 13px Arial; text-align: center; height: 15px; width: 40px;"/>%
                                                  </div>
                                                </div>
                                              </td>
                                              <td style="width: 50%;"> <!-- Include Reimbursable Costs -->
                                                <div>
                                                  <apex:inputCheckbox value="{!coModel.changeOrderRecord.Apply_Reimbursable__c}" onclick="updateChangeOrderReimbursableData('{!coModel.changeOrderRecord.Id}');" disabled="{!(!isThisUserCreator && !coModel.isInternalReviewer) || viewOnly}" styleClass="specialDisableJQ disableAccountingHold"/>
                                                  <label style="padding-right: 5px;" class="checkboxLabelText">Include Reimbursable Costs</label>
                                                  <div style="display: {!IF(coModel.changeOrderRecord.Apply_Reimbursable__c, 'inline-block', 'none')};">
                                                    <apex:inputField value="{!coModel.changeOrderRecord.Reimbursable_Percentage__c}" style="text-align: center; width: 40px; margin-right: 3px;" onFocus="this.priorValue = this.value;" onChange="if( this.value >= 0 && this.value <= 100 && this.value.match(/^\d+$/)) { this.priorValue = this.value; updateChangeOrderReimbursableData('{!coModel.changeOrderRecord.Id}'); } else { this.value = this.priorValue; }" rendered="{!(isThisUserCreator || coModel.isInternalReviewer) && !viewOnly}" styleClass="specialDisableJQ disableAccountingHold"/>
                                                    <apex:outputText value="{!coModel.changeOrderRecord.Reimbursable_Percentage__c}" rendered="{!(!isThisUserCreator && !coModel.isInternalReviewer) || viewOnly}" style="background: #EBEBE4; border: 1px solid #CCC; color: #545454; margin: 2px 3px 2px 0; padding-bottom: 1px; display: inline-block; font: 13px Arial; text-align: center; height: 15px; width: 40px;"/>%
                                                  </div>
                                                </div>
                                              </td>
                                            </tr>
                                          </tbody>
                                        </table>
                                        <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;"><!-- Additional Reimbursables -->
                                          <tbody>
                                            <tr>
                                              <td colspan="2">
                                                <span class="checkboxLabelText">Additional Reimbursables:</span>
                                              </td>
                                            </tr>
                                            <tr>
                                              <td>
                                                <table class="generalTableStyle" style="margin-bottom: 0px;">
                                                  <thead>
                                                      <tr>
                                                          <th style="width: 500px;">Description</th>
                                                          <th style="width: 120px;">Amount</th>
														  <th style="width: 120px;">Send Muni Fee Invoice</th> <!-- MRS 7298 -->
                                                          <th style="width: 50px;">Delete</th>
                                                      </tr>
                                                  </thead>
                                                  <tbody>
                                                      <apex:repeat value="{!changeOrderReimbursableMap[coModel.changeOrderRecord.Id]}" var="reimbursableRecord">
                                                        <tr>
                                                          <td>{!reimbursableRecord.Description__c}</td>
                                                          <td>{!reimbursableRecord.Amount__c}</td>
														  <td style="text-align: center;">
															<apex:inputCheckbox value="{!reimbursableRecord.Send_Muni_Fee_Invoice__c}" onchange="updateAddReimbMuniFeeInvStatus('{!reimbursableRecord.Id}', this);"/> <!-- MRS 7298 -->
														  </td>
                                                          <td style="text-align: center; padding-top: 0px; padding-bottom: 0px;">
                                                            <div style="display: {!IF(!coModel.enableAddNewService || viewOnly,  'none', 'block')};">
                                                              <div>
                                                                <apex:commandLink onclick="reimbursableIdToRemove = '{!reimbursableRecord.Id}'; $('#removeReimbursableActionArea').show(); return false;" styleClass="deleteLinkFloor specialDisableJQ disableAccountingHold">
                                                                  <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                                                </apex:commandLink>
                                                              </div>
                                                            </div>
                                                          </td>
                                                        </tr>
                                                      </apex:repeat>
                                                  </tbody>
                                                </table>
                                              </td>
                                              <td style="vertical-align: top;">
                                                <apex:commandButton value="Add New" styleClass="specialDisableJQ disableAccountingHold" onclick="changeRightPanelToReimbursable('{!coModel.changeOrderRecord.Id}'); return false;" disabled="{!!coModel.enableAddNewService || (!isThisUserCreator && !coModel.isInternalReviewer) || viewOnly || !coModel.changeOrderRecord.Apply_Reimbursable__c}"/>
                                              </td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </div>
                                    </div></div></div>
                                  </div>

                                  <table class="generalTableStyle changeOrdersTablesJQ">
                                    <thead>
                                      <tr class="nodrop nodrag">
                                        <th style="display: {!IF( ( coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( coModel.isRemoveVisible ) || ( proposal.isPhase__c && coModel.isPhasesVisible ), 'table-cell', 'none')};">
                                          <apex:inputCheckbox styleClass="serviceCheckboxP specialDisableJQ disableAccountingHold" onclick="serviceParentCheckboxActionJS( '.changeOrdersTablesJQ #{!coModel.changeOrderRecord.Id}' );" disabled="{!viewOnly}"/>
                                        </th>
                                        <th>Action</th>
                                        <th>Service Name</th>
                                        <th style="display: {!IF(coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')};">Floors</th>
                                        <th style="display: {!IF(coModel.isServiceGroupVisible, 'table-cell', 'none')};">Service<br/>Group</th>
                                        <th style="display: {!IF(proposal.isPhase__c && coModel.isPhasesVisible, 'table-cell', 'none')};">Phase</th>
                                        <th style="display: {!IF(coModel.isPurchaseOrderVisible && rightPanelView == 'PurchaseOrder', 'table-cell', 'none')};">Purchase<br/>Order #</th>
                                        <th style="display: {!IF(coModel.isMunicipalAgencyVisible, 'table-cell', 'none')};">Municipal<br/>Agency ID#</th>
                                        <th style="display: {!IF(coModel.isUnitOfServiceVisible, 'table-cell', 'none')};">Unit of<br/>Service</th>
                                        <th style="display: {!IF(coModel.isQuantityVisible, 'table-cell', 'none')};">Quantity</th>
                                        <th style="display: {!IF(coModel.isUnitPriceVisible, 'table-cell', 'none')}">Unit<br/>Price</th>
                                        <th style="display: {!IF(coModel.isLastPriceVisible, 'table-cell', 'none')}">Last<br/>Proposed<br/>Price</th>
                                        <th style="display: {!IF(coModel.isTotalPriceVisible, 'table-cell', 'none')}" class="totalServicePriceJQ">Total<br/>Service<br/>Price</th>
                                        <th style="display: {!IF(coModel.isActivityStatusVisible, 'table-cell', 'none')};">Activity<br/>Status</th>
                                        <th style="display: {!IF(coModel.isRemoveVisible, 'table-cell', 'none')};">Del</th>
                                      </tr>
                                    </thead>
                                    <tbody id="{!coModel.changeOrderRecord.Id}">
                                      <apex:repeat value="{!coModel.serviceModels}" var="sm">
                                        <tr id="{!IF(!( ( sm.isAmendmendDeleted || sm.isQuantityChangeOrder ) && sm.changeOrderOldId != coModel.changeOrderRecord.Id), sm.recordId, '')}" recordid="{!sm.recordId}" class="{!IF(!(sm.isAmendmendDeleted || sm.isQuantityChangeOrder), '', 'nodrop nodrag')}" style="{!IF(sm.serviceItemRecord.Service_Group_Key__c != null,'background-color: #EDF3F6;','')}">
                                          <td class="data" style="display: {!IF( ( coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( coModel.isRemoveVisible ) || ( proposal.isPhase__c && coModel.isPhasesVisible ), 'table-cell', 'none' )};">
                                            <apex:inputCheckbox rendered="{!( sm.isFloorsEditable ) || ( !viewOnly && sm.isRemoveEditable ) || ( sm.isPhasesEditable && !sm.isAmendmendDeleted )}" value="{!sm.checked}" styleClass="serviceCheckboxes specialDisableJQ disableAccountingHold" onclick="serviceCheckboxActionJS( '#{!coModel.changeOrderRecord.Id}' );" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                                          </td>
                                          <td class="name" style="text-align: center; font-size: 120%; font-weight: bold; line-height: 16px;">
                                            <span style="font-size: 120%; color: {!IF(sm.isAmendmendDeleted, 'red', IF( sm.isAmendmendAdded && !sm.isQuantityChangeOrder, 'green', '#FF0101') )};">{!IF(sm.isAmendmendDeleted, '-', IF( sm.isAmendmendAdded && !sm.isQuantityChangeOrder, '+', '-' ) )}</span>
                                          </td>
                                          <td class="name{!IF( !( sm.isQuantityChangeOrder || (sm.isAmendmendDeleted && sm.changeOrderOldId != coModel.changeOrderRecord.Id) ), ' dragHandle', '' )}">
                                            <span style="color: {!IF( sm.isAmendmendDeleted || sm.isQuantityChangeOrder, 'red', IF(sm.isAmendmendAdded, 'green', 'black') )};">
                                              <span style="display: inline; cursor: pointer;" onClick="window.open('/{!sm.serviceItemRecord.Id}', '_blank'); return false;">[#{!serviceInfo[sm.recordId].Service_Template__r.Service_Row_Number__c} - {!serviceInfo[sm.recordId].Name}]</span>
                                              {!serviceInfo[sm.recordId].Service_Name_Full__c}
                                            </span>
                                          </td>
                                          <td class="{!IF(sm.isFloorsEditable && !isAccountOrProjectOnHold, 'editableFloor', '')}" style="display: {!IF(coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')};{!IF(sm.isFloorsEditable, 'cursor: pointer;', '')} white-space:nowrap;" onclick="if( $(this).hasClass('editableFloor') ) { prepareServiceJunctionsData( '{!sm.recordId}', serializeServices() ); }" title="{!serviceInfo[sm.recordId].Floor__c}">
                                          {!serviceInfo[sm.recordId].Floor_Concatenated__c}
                                          </td>
                                          <td class="data {!IF(sm.isServiceGroupRequired, 'required', '')}" style="display: {!IF(coModel.isServiceGroupVisible, 'table-cell', 'none')};">
                                            <div><div></div><div>
                                              <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.serviceGroup}" size="2" disabled="{!!sm.isServiceGroupEditable || sm.isAmendmendDeleted || viewOnly}" onFocus="this.priorValue = this.value;" onChange="if( {!sm.isServiceGroupRequired} ) { if( this.value == '' || this.value.replace(/^([1-9][0-9]{0,2})$/g, '') == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; } }"/>
                                            </div></div>
                                          </td>
                                          <td class="data{!IF( sm.isPhasesEditable && !sm.isAmendmendDeleted && !isAccountOrProjectOnHold, ' editablePhase', '' )}{!IF(sm.pendingPhaseSave, ' pending', '')}" style="display: {!IF(proposal.isPhase__c && coModel.isPhasesVisible, 'table-cell', 'none')};" onclick="if( $(this).hasClass('editablePhase') ) { moveServicesToPhase( null, '{!sm.recordId}' ); }">
                                            {!phaseInfo[sm.phaseId].Name__c}
                                          </td>
                                          <td class="data" style="display: {!IF(AND(coModel.isPurchaseOrderVisible, rightPanelView == 'PurchaseOrder'), 'table-cell', 'none')};">
                                            {!sm.purchaseOrderNumber}
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isMunicipalAgencyVisible, 'table-cell', 'none')};">
                                            <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.municipalAgency}" size="8" disabled="{!!sm.isMunicipalAgencyEditable || sm.isAmendmendDeleted || viewOnly}"/>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isUnitOfServiceVisible, 'table-cell', 'none')};">
                                            {!sm.unitOfService}
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isQuantityVisible, 'table-cell', 'none')};">
                                            <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityStr}" size="2" onfocus="this.priorValue = this.value;" onchange="changeQuantity( this.value, this.priorValue, '{!sm.recordId}', activeChangeOrderId, 'false', serializeServices() );" disabled="{!!sm.isQuantityEditable || !sm.isHourlyService || sm.isAmendmendDeleted || viewOnly}" rendered="{!!sm.isQuantityChangeOrder}"/>
                                            <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityDiffStr}" size="2" onfocus="this.priorValue = this.value;" onchange="changeQuantity( this.value, this.priorValue, '{!sm.recordId}', activeChangeOrderId, 'true', serializeServices() );" disabled="{!!sm.isQuantityEditable || !sm.isHourlyService || viewOnly}" rendered="{!sm.isQuantityChangeOrder}"/>
                                          </td>
                                          <td class="data {!IF(sm.isUnitPriceRequired, 'required', '')}" style="display: {!IF(coModel.isUnitPriceVisible, 'table-cell', 'none')}">
                                            <div><div></div><div>
                                              <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.servicePriceStr}" size="4" style="{!IF(sm.hasClientPrice, 'font-weight: bold; ', '')}" disabled="{!!sm.isUnitPriceEditable || sm.isAmendmendDeleted || viewOnly}" onChange="changeServiceUnitPrice('{!sm.recordId}');"/>
                                            </div></div>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isLastPriceVisible, 'table-cell', 'none')}">
                                            <apex:outputLink styleClass="specialDisableJQ disableAccountingHold" rendered="{!!ISBLANK(sm.lastProposalPriceId)}" target="_blank" value="/{!sm.lastProposalId}">{!sm.lastProposalPrice}</apex:outputLink>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isTotalPriceVisible, 'table-cell', 'none')}">
                                            <apex:outputText rendered="{!!sm.isQuantityChangeOrder}">{!IF(sm.isAmendmendDeleted && sm.changeOrderId == coModel.changeOrderRecord.Id, '-', '')}{!ROUND(sm.totalServicePrice, 2)}</apex:outputText>
                                            <apex:outputText rendered="{!sm.isQuantityChangeOrder}">{!ROUND(sm.totalServicePriceDiff, 2)}</apex:outputText>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isActivityStatusVisible, 'table-cell', 'none')};">
                                            {!sm.activityStatus}
                                          </td>
                                          <td style="display: {!IF(coModel.isRemoveVisible, 'table-cell', 'none')}; text-align: center;">
                                            <div class="removeServiceButtonJQ">
                                              <div class="specialDisableJQ disableAccountingHold" style="cursor: pointer; display: {!IF( !viewOnly && !isAccountOrProjectOnHold && sm.isRemoveEditable, 'block', 'none')};" onclick="removeServiceModel('{!sm.recordId}', activeChangeOrderId, serializeServices());">
                                                <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                              </div>
                                            </div>
                                          </td>
                                        </tr>
                                      </apex:repeat>
                                    </tbody>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Subtotal</td>
                                      <td class="data bold"><apex:outputText value="{!ROUND(pwm.changeOrderTotalsMap['Subtotal'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible && coModel.changeOrderRecord.Apply_Discount__c && coModel.changeOrderRecord.Discount_Percentage__c > 0, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Discount Applied</td>
                                      <td class="data bold"><apex:outputText value="{!ROUND(pwm.changeOrderTotalsMap['Discount'][coModel.changeOrderRecord.Id], 2) * -1}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Sales Tax</td>
                                      <td class="data bold"><apex:outputText id="totalServiceSalesTax" value="{!ROUND(pwm.changeOrderTotalsMap['Sales Tax'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Reimbursable Costs</td>
                                      <td class="data bold"><apex:outputText id="totalServiceReimbursables" value="{!ROUND(pwm.changeOrderTotalsMap['Reimbursable Costs'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Cost Of Services</td>
                                      <td class="data bold"><apex:outputText id="totalServiceCost" value="{!ROUND(pwm.changeOrderTotalsMap['Cost Of Services'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                  </table>

                                  <div style="display: {!IF(isThisUserCreator || coModel.isInternalReviewer, 'block', 'none')};"> <!-- Municipal Authority Fees -->
                                    <label class="labelTextBlock">Municipal Authority Fees:</label>
                                    <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                                      <tbody>
                                        <tr>
                                          <td class="dataCol dataCell">
                                            <div style="display: table;" class="municipalAuthorityFeesArea">
                                              <div style="display: table-cell;">
                                                <apex:inputField id="municipalAuthorityFeesCO" styleClass="specialDisableJQ disableAccountingHold" value="{!coModel.changeOrderRecord.Municipal_Authority_Fees__c}" /> <!-- MRS-6886 -->
                                              </div>
                                              <script>  // MRS-6886
                                                    $('[id$=municipalAuthorityFeesCO]').parent().find('select').not('[id$=municipalAuthorityFeesCO]').each(function() { $(this).attr("style", "min-width: 300px; max-width: 300px; "); });
                                              </script>
                                              <div style="display: table-cell; padding-left: 10px; vertical-align: top;" class="projectedDOBFeeArea">
                                                <span>
                                                  <span>
                                                    <label style="display: block; width: 70px;" class="labelText">DOB Fee:</label> <!-- MRS-6886 -->
                                                  </span>
                                                  <div style="margin-top: 10px;">
                                                    <apex:inputField styleClass="specialDisableJQ disableAccountingHold" value="{!coModel.changeOrderRecord.Projected_DOB_Fee__c}" style="width: 70px;"/> <!-- MRS-6886 -->
                                                  </div>
                                                </span>
                                              </div>
                                            </div>
                                          </td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </div>

                                  <div style="display: {!IF(isThisUserCreator, 'block', 'none')};"> <!-- General Change Order Notes -->
                                    <label class="labelTextBlock">General Change Order Notes:</label>
                                    <apex:inputField value="{!changeOrderInfo[coModel.changeOrderRecord.Id].General_Change_Order_Notes__c}" style="width: 99%; resize: none;" styleClass="specialDisableJQ" onchange="saveGeneralChangeOrderNotes( '{!coModel.changeOrderRecord.Id}', this.value );"/>
                                  </div>

                                  <div style="text-align: right;">
                                    <apex:outputPanel layout="block" id="servicesManagementButtonsNotApproved" style="text-align: right; display: inline-block; width: 100%;">

                                      <apex:commandButton value="Preview PDF" styleClass="milroseBtnStyle specialDisableJQ" onclick="previewPdf(serializeServices(), serializePhases(), activeChangeOrderId); return false;" disabled="{!isPreviewPdfDisabled}" style="border: 2px solid #3887A8 !important; float: left;"/>

                                      <span style="display: {!IF(coModel.isCZAssignmentVisible, 'inline', 'none')};">
                                        <label style="margin-right: 5px; display: inline;" class="labelTextBlock">Code &amp; Zoning Analyst:</label>
                                        <apex:selectList value="{!coModel.changeOrderRecord.Code_Zoning_Analyst__c}" styleClass="codeZoningAnalystForCOJQ disableAccountingHold" size="1" id="CO_Code_Zoning_Analyst__c" onchange="updateCZAnalystEmailOnChangeOrder('{!coModel.changeOrderRecord.Id}');">
                                          <apex:selectOptions value="{!cZAnalysts}"/>
                                          <!--apex:actionSupport event="onchange" rerender="" onsubmit="updateCZAnalystEmailOnChangeOrder('{!coModel.changeOrderRecord.Id}');" status="overlay"/-->
                                        </apex:selectList>
                                      </span>
                                      <span style="display: {!IF(coModel.isSIPSAssignmentVisible, 'inline', 'none')};">
                                        <label style="margin-right: 5px; display: inline;" class="labelTextBlock">SIPS Coordinator:</label>
                                        <apex:selectList value="{!coModel.changeOrderRecord.SIPS_Coordinator__c}" styleClass="codeZoningAnalystForCOJQ disableAccountingHold" size="1" id="SIPS_Coordinator__c" onchange="updateSIPSCoordinatorOnChangeOrder('{!coModel.changeOrderRecord.Id}');">
                                          <apex:selectOptions value="{!sipsCoordinators}"/>
                                          <!--apex:actionSupport event="onchange" rerender="msgs" reRender="assignSIPSCoordinatorForCOButton" status="overlay"/-->
                                        </apex:selectList>
                                      </span>
                                      <span>
                                        <apex:inputCheckbox styleClass="specialDisableJQ disableAccountingHold" id="Disable_Followups__c" value="{!coModel.changeOrderRecord.Disable_Followups__c}" onchange="manageFollowups('{!coModel.changeOrderRecord.Id}');" disabled="{!!coModel.enableAutomaticFollowUps}"/>
                                        <label for="ProposalWizardPage:theForm:Disable_Followups__c" class="labelText">Shut Off Automatic Follow-Up</label>
                                      </span><!--

                                      Assign Floors To Services
                                      --><div style="display: inline;">
                                        <apex:commandButton value="Assign Floors To Services" rendered="{!coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c}" styleClass="milroseBtnStyle assignFloorsButton specialDisableJQ disableAccountingHold" disabled="true" onclick="assignServicesToFloors( '.changeOrdersTablesJQ #{!coModel.changeOrderRecord.Id}' ); return false;"/>
                                      </div><!--

                                      Delete Multiple Services
                                      --><span>
                                        <apex:commandButton value="Delete Services" rendered="{!coModel.isRemoveVisible}" styleClass="milroseBtnStyle deleteServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="deleteServices( '.changeOrdersTablesJQ #{!coModel.changeOrderRecord.Id}' ); return false;"/>
                                      </span><!--

                                      Move Services To Phase
                                      --><span>
                                        <apex:commandButton value="Move Services To Phase" rendered="{!coModel.showMoveServices && proposal.isPhase__c}" disabled="true" styleClass="milroseBtnStyle moveServicesButton specialDisableJQ disableAccountingHold" onclick="moveServicesToPhase( '.changeOrdersTablesJQ #{!coModel.changeOrderRecord.Id}' ); return false;"/>
                                      </span><!--

                                      Save Service Bundle
                                      --><apex:commandButton styleClass="milroseBtnStyle specialDisableJQ" rendered="{!coModel.showSaveServiceBundle && !coModel.isSIPSOnly}"
                                      disabled="{!coModel.serviceModels.size == 0 || !coModel.enableSaveServiceBundle || viewOnly}"
                                      value="Save Service Bundle"
                                      onclick="changeOrderId = '{!coModel.changeOrderRecord.Id}'; virtualChangeOrderName = ''; $('#saveServiceBundlePanelActionArea').css('display', 'block'); return false;" id="saveServiceBundleButtonNotApproved"/><!--

                                      + Add New Service MRS 7335
                                      --><apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!coModel.showAddNewService}" disabled="{!!coModel.enableAddNewService || viewOnly}" value="+ Add New Service" onclick="changeRightPanelToServiceItem('General', '{!coModel.changeOrderRecord.Id}'); return false;" /><!--

                                      Manage Service Bundle
                                      --><apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!coModel.showInsertServiceBundle}" disabled="{!!coModel.enableInsertServiceBundle || viewOnly}" value="Manage Service Bundle" onclick="changeOrderId = '{!coModel.changeOrderRecord.Id}'; virtualChangeOrderName = ''; $('#loadServiceBundlePanelActionArea').css('display', 'block'); return false;"/>
                                      <div><!--

                                        Cancel CO Request (Delete)
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Cancel CO Request" rendered="{!coModel.showRemoveChangeOrder}" disabled="{!!coModel.enableRemoveChangeOrder || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="removeChangeOrderAction('{!coModel.changeOrderRecord.Id}'); if('{!rightPanelView}' != 'Notes') { changeRightPanelToNotes(); } return false;" reRender=""/>
                                        </div><!--

                                        Cancel CO Request
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Cancel CO Request" rendered="{!coModel.showCancelCORequest}" disabled="{!!coModel.enableCancelCORequest || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Canceled', serializeServices(), serializePhases(), false); return false;" reRender=""/>
                                        </div><!--

                                        Submit CO Request
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Submit CO Request" rendered="{!coModel.showSubmitCORequest}" disabled="{!!coModel.enableSubmitCORequest || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Change Order Requested', serializeServices(), serializePhases(), true); return false;"/>
                                        </div><!--

                                        Send for C&Z Review
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Send for C&Z Review" rendered="{!coModel.showSendForCZReview}" disabled="{!!coModel.enableSendForCZReview || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'In C&Z Scope Review', serializeServices(), serializePhases(), false); return false;"/>
                                        </div><!--

                                        Complete
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Complete" rendered="{!coModel.showComplete}" disabled="{!!coModel.enableComplete || viewOnly || isAccountOrProjectOnHold}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'C&Z Scope Review Complete', serializeServices(), serializePhases(), false); return false;"/>
                                        </div><!--

                                        Complete (for SIPS)
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Complete" rendered="{!coModel.showCompleteSIPS}" disabled="{!viewOnly || isAccountOrProjectOnHold}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Passed Internal Review', serializeServices(), serializePhases(), true); return false;"/>
                                        </div><!--

                                        Send for Internal Review
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Send for Internal Review" rendered="{!coModel.showSendForInternalReview}" disabled="{!!coModel.enableSendForInternalReview || viewOnly || isAccountOrProjectOnHold}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="$('.changeOrderInternalReviewerPanel').show(); return false;"/>
                                        </div><!--

                                        Send to Client
                                        --><div style="display: inline-block;">
                                            <apex:commandButton id="sendToClientCO" value="Send to Client" rendered="{!coModel.showSendToClient}" disabled="{!!coModel.enableSendToClient || viewOnly || eSignatureAndNoSigners}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="showConfirmSendToClientCOPanel( '', '{!coModel.changeOrderRecord.Id}', {!coModel.changeOrderRecord.Disable_Followups__c} ); return false;"/> <!-- MRS 7180 -->
                                        </div><!--

                                        Resend to Client
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Resend to Client" rendered="{!coModel.showReSendToClient}" disabled="{!!coModel.enableReSendToClient || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="showConfirmSendToClientCOPanel( 'Email (Resend)', '{!coModel.changeOrderRecord.Id}', {!coModel.changeOrderRecord.Disable_Followups__c} ); return false;"/>
                                        </div><!--

                                        CO Follow-up
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="CO Follow-up" rendered="{!coModel.showFollowUp}" disabled="{!!coModel.enableFollowUp}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="showConfirmSendToClientCOPanel( 'Email (Follow Up)', '{!coModel.changeOrderRecord.Id}', {!coModel.changeOrderRecord.Disable_Followups__c} ); return false;"/>
                                        </div><!--

                                        Reject Change Order (IR)
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Reject Change Order" rendered="{!coModel.showRejectChangeOrderIR}" disabled="{!!coModel.enableRejectChangeOrderIR || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Failed Internal Review', serializeServices(), serializePhases(), false); return false;"/>
                                        </div><!--

                                        Approve Change Order (IR)
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Approve Change Order" rendered="{!coModel.showApproveChangeOrderIR}" disabled="{!!coModel.enableApproveChangeOrderIR || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Passed Internal Review', serializeServices(), serializePhases(), false); return false;"/>
                                        </div><!--

                                        Approve Change Order (Client)
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Approve Change Order" rendered="{!coModel.showApproveChangeOrderPS}" disabled="{!!coModel.enableApproveChangeOrderPS || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Change Order Approved', serializeServices(), serializePhases(), false); return false;"/>
                                        </div><!--

                                        Reject Change Order (Client)
                                        --><div style="display: inline-block;">
                                          <apex:commandButton value="Reject Change Order" rendered="{!coModel.showRejectChangeOrderPS}" disabled="{!!coModel.enableRejectChangeOrderPS || viewOnly}" styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" onclick="changeCOStatus('{!coModel.changeOrderRecord.Id}', 'Change Order Rejected', serializeServices(), serializePhases(), false); return false;"/><!--

                                          Add Non-Billable Reason MRS 7056
                                          --><div style="display: inline-block;">
                                            <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="true" value="Add Non-Billable Reason"
                                            disabled="{!!coModel.hasNonBillabale}" style="{!IF(coModel.hasNonBillableWithoutReason == true, 'font-weight: bold', 'font-weight: normal')}" onclick="showOverlay(); table='.changeOrdersTablesJQ #{!coModel.changeOrderRecord.Id}'; $('#showSettingNonBillableReasonWnd').toggle();" reRender="none"/>
                                          </div>
                                        </div>
                                      </div>
                                    </apex:outputPanel>
                                  </div>
                                </div>
                                <script type="text/javascript">
                                  serviceParentCheckboxCheckJS( '.changeOrdersTablesJQ #{!coModel.changeOrderRecord.Id}' );
                                </script>
                              </apex:repeat>
                            </div>
                            <script type="text/javascript">
                              $("#accordionNotApproved").accordion({
                                header: "span.accordionHeaderJQ",
                                autoHeight: false,
                                animated: false,
                                icons: false,
                                create: function( event, ui ) {
                                    if( $('#accordionNotApproved table.generalTableStyle.header.'+activeChangeOrderId).size() > 0 ) {
                                      $('#accordionNotApproved table.generalTableStyle.header.'+activeChangeOrderId).click();
                                    } else {
                                    if( $('#accordionNotApproved table.generalTableStyle.header').size() > 0 ) {
                                      $('#accordionNotApproved table.generalTableStyle.header').first().click();
                                    } else {
                                      activeChangeOrderId = '';
                                    }
                                  }
                                }
                              });
                              attachDndToTables('.changeOrdersTablesJQ');
                              calculateTableColspans('.changeOrdersTablesJQ');

                              initMunicipalAuthorityFeesNotesCOArea();
                            </script>
                          </div>
                        </div>
                      </div></div></div>

                      <!-- Canceled CO services table -->
                      <div class="apexp" style="display: {!IF(proposal.is_Change_Order__c && pwm.canceledChangeOrders.size > 0, 'block', 'none')};">
                        <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: 2px solid #3887A8 !important; border-bottom: none !important;">
                          <div class="pbHeader">
                            <table border="0" cellpadding="0" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td class="pbTitle" style="width: 50%;">
                                    <h2 class="mainTitle">Canceled Change Orders</h2>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="pbBody">
                            <div id="accordionCanceled">
                              <apex:repeat value="{!pwm.canceledChangeOrders}" var="coModel">
                                <span style="width: 100%;" class="accordionCanceledHeaderJQ">
                                  <table class="generalTableStyle {!coModel.changeOrderRecord.Id} header" style="margin-bottom: 0px;">
                                    <tr style="text-align: left;">
                                      <td>
                                        <div class="accordionImage" style="display: inline-block;"></div>&nbsp;
                                        <span style="display: {!IF(isAdmin, 'inline', 'none')}; cursor: pointer;" onClick="window.open('/{!coModel.changeOrderRecord.Id}', '_blank'); return false;">[{!changeOrderInfo[coModel.changeOrderRecord.Id].Name}]</span>
                                        Change Order {!changeOrderInfo[coModel.changeOrderRecord.Id].Number__c},&nbsp;Request Date:&nbsp;<apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!changeOrderInfo[coModel.changeOrderRecord.Id].CreatedDate}"/></apex:outputText>,&nbsp;
                                        Status: {!coModel.status}
                                      </td>
                                    </tr>
                                  </table>
                                </span>
                                <div>
                                  <table class="generalTableStyle changeOrdersTablesCanceledJQ">
                                    <thead>
                                      <tr class="nodrop nodrag">
                                        <th style="display: {!IF( ( coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( proposal.isPhase__c && coModel.isPhasesVisible ), 'table-cell', 'none')};">
                                          <apex:inputCheckbox styleClass="serviceCheckboxP specialDisableJQ" onclick="serviceParentCheckboxActionJS( '.changeOrdersTablesCanceledJQ #{!coModel.changeOrderRecord.Id}' );" disabled="{!viewOnly}"/>
                                        </th>
                                        <th>Action</th>
                                        <th>Service Name</th>
                                        <th style="display: {!IF(coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')};">Floors</th>
                                        <th style="display: {!IF(coModel.isServiceGroupVisible, 'table-cell', 'none')};">Service<br/>Group</th>
                                        <th style="display: {!IF(proposal.isPhase__c && coModel.isPhasesVisible, 'table-cell', 'none')};">Phase</th>
                                        <th style="display: {!IF(coModel.isPurchaseOrderVisible && rightPanelView == 'PurchaseOrder', 'table-cell', 'none')};">Purchase<br/>Order #</th>
                                        <th style="display: {!IF(coModel.isMunicipalAgencyVisible, 'table-cell', 'none')};">Municipal<br/>Agency ID#</th>
                                        <th style="display: {!IF(coModel.isUnitOfServiceVisible, 'table-cell', 'none')};">Unit of<br/>Service</th>
                                        <th style="display: {!IF(coModel.isQuantityVisible, 'table-cell', 'none')};">Quantity</th>
                                        <th style="display: {!IF(coModel.isUnitPriceVisible, 'table-cell', 'none')}">Unit<br/>Price</th>
                                        <th style="display: {!IF(coModel.isLastPriceVisible, 'table-cell', 'none')}">Last<br/>Proposed<br/>Price</th>
                                        <th style="display: {!IF(coModel.isTotalPriceVisible, 'table-cell', 'none')}" class="totalServicePriceJQ">Total<br/>Service<br/>Price</th>
                                        <th style="display: {!IF(coModel.isActivityStatusVisible, 'table-cell', 'none')};">Activity<br/>Status</th>
                                      </tr>
                                    </thead>
                                    <tbody id="{!coModel.changeOrderRecord.Id}">
                                      <apex:repeat value="{!coModel.serviceModels}" var="sm">
                                        <tr id="{!IF(!(sm.isAmendmendDeleted && sm.changeOrderOldId != coModel.changeOrderRecord.Id), sm.recordId, '')}" recordid="{!sm.recordId}" class="{!IF(!(sm.isAmendmendDeleted && sm.changeOrderOldId != coModel.changeOrderRecord.Id), '', 'nodrop nodrag')}" style="{!IF(sm.serviceItemRecord.Service_Group_Key__c != null,'background-color: #EDF3F6;','')}">
                                          <td class="data" style="display: {!IF( ( coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c ) || ( proposal.isPhase__c && coModel.isPhasesVisible ), 'table-cell', 'none')};">
                                            <apex:inputCheckbox rendered="{!( sm.isFloorsEditable ) || ( sm.isPhasesEditable && !sm.isAmendmendDeleted )}" value="{!sm.checked}" styleClass="serviceCheckboxes specialDisableJQ" onclick="serviceCheckboxActionJS( '#{!coModel.changeOrderRecord.Id}' );" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                                          </td>
                                          <td class="name" style="text-align: center; font-size: 120%; font-weight: bold; line-height: 16px;">
                                            <span style="font-size: 120%; color: {!IF(sm.isAmendmendDeleted, 'red', 'green')}">{!IF(sm.isAmendmendDeleted, '-', '+')}</span>
                                          </td>
                                          <td class="name{!IF(!(sm.isAmendmendDeleted && sm.changeOrderOldId != coModel.changeOrderRecord.Id), ' dragHandle', '')}">
                                            <span style="color: {!IF( sm.isAmendmendDeleted , 'red', IF(sm.isAmendmendAdded, 'green', 'black'))};">
                                              <span style="display: inline; cursor: pointer;" onClick="window.open('/{!sm.serviceItemRecord.Id}', '_blank'); return false;">[#{!serviceInfo[sm.recordId].Service_Template__r.Service_Row_Number__c} - {!serviceInfo[sm.recordId].Name}]</span>
                                              {!serviceInfo[sm.recordId].Service_Name_Full__c}
                                            </span>
                                          </td>
                                          <td class="{!IF(sm.isFloorsEditable && !isAccountOrProjectOnHold, 'editableFloor', '')}" style="display: {!IF(coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c, 'table-cell', 'none')};{!IF(sm.isFloorsEditable, 'cursor: pointer;', '')} white-space:nowrap;" onclick="if( $(this).hasClass('editableFloor') ) { prepareServiceJunctionsData( '{!sm.recordId}', serializeServices() ); }" title="{!serviceInfo[sm.recordId].Floor__c}">
                                            {!serviceInfo[sm.recordId].Floor_Concatenated__c}
                                          </td>
                                          <td class="data required" style="display: {!IF(coModel.isServiceGroupVisible, 'table-cell', 'none')};">
                                            <div><div></div><div>
                                              <apex:inputText styleClass="tableInput specialDisableJQ" value="{!sm.serviceGroup}" size="2" disabled="{!!sm.isServiceGroupEditable || viewOnly}" onFocus="this.priorValue = this.value;" onChange="if( this.value == '' || this.value.replace(/^([1-9][0-9]{0,2})$/g, '') == '' ) { this.priorValue = this.value; } else { this.value = this.priorValue; }"/>
                                            </div></div>
                                          </td>
                                          <td class="data{!IF( sm.isPhasesEditable && !sm.isAmendmendDeleted && !isAccountOrProjectOnHold, ' editablePhase', '' )}{!IF(sm.pendingPhaseSave, ' pending', '')}" style="display: {!IF(proposal.isPhase__c && coModel.isPhasesVisible, 'table-cell', 'none')};" onclick="if( $(this).hasClass('editablePhase') ) { moveServicesToPhase( null, '{!sm.recordId}' ); }">
                                            {!phaseInfo[sm.phaseId].Name__c}
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isPurchaseOrderVisible && rightPanelView == 'PurchaseOrder', 'table-cell', 'none')};">
                                            {!sm.purchaseOrderNumber}
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isMunicipalAgencyVisible, 'table-cell', 'none')};">
                                            <apex:inputText styleClass="tableInput specialDisableJQ" value="{!sm.municipalAgency}" size="8" disabled="{!!sm.isMunicipalAgencyEditable || viewOnly}"/>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isUnitOfServiceVisible, 'table-cell', 'none')};">
                                            {!sm.unitOfService}
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isQuantityVisible, 'table-cell', 'none')};">
                                            <apex:inputText styleClass="tableInput specialDisableJQ" value="{!sm.quantityStr}" size="2" onchange="changeServiceUnitPrice('{!sm.recordId}');" disabled="{!!sm.isQuantityEditable || !sm.isHourlyService || viewOnly}"/>
                                          </td>
                                          <td class="data {!IF(sm.isUnitPriceRequired, 'required', '')}" style="display: {!IF(coModel.isUnitPriceVisible, 'table-cell', 'none')}">
                                            <div><div></div><div>
                                              <apex:inputText styleClass="tableInput specialDisableJQ" value="{!sm.servicePriceStr}" size="4" style="{!IF(sm.hasClientPrice, 'font-weight: bold; ', '')}" disabled="{!!sm.isUnitPriceEditable || viewOnly}" onChange="changeServiceUnitPrice('{!sm.recordId}');"/>
                                            </div></div>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isLastPriceVisible, 'table-cell', 'none')}">
                                            <apex:outputLink styleClass="specialDisableJQ" rendered="{!!ISBLANK(sm.lastProposalPriceId)}" target="_blank" value="/{!sm.lastProposalId}">{!sm.lastProposalPrice}</apex:outputLink>
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isTotalPriceVisible, 'table-cell', 'none')}">
                                            {!ROUND(sm.totalServicePrice, 2)}
                                          </td>
                                          <td class="data" style="display: {!IF(coModel.isActivityStatusVisible, 'table-cell', 'none')};">
                                            {!sm.activityStatus}
                                          </td>
                                        </tr>
                                      </apex:repeat>
                                    </tbody>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Subtotal</td>
                                      <td class="data bold"><apex:outputText value="{!ROUND(pwm.changeOrderTotalsMap['Subtotal'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                     <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Sales Tax</td>
                                      <td class="data bold"><apex:outputText id="totalServiceSalesTax" value="{!ROUND(pwm.changeOrderTotalsMap['Sales Tax'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Reimbursable Costs</td>
                                      <td class="data bold"><apex:outputText id="totalServiceReimbursables" value="{!ROUND(pwm.changeOrderTotalsMap['Reimbursable Costs'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                    <tr class="nodrop nodrag" style="display: {!IF(coModel.isTotalPriceVisible, 'table-row', 'none')}">
                                      <td class="footer footerLeftJQ">Cost Of Services</td>
                                      <td class="data bold"><apex:outputText id="totalServiceCost" value="{!ROUND(pwm.changeOrderTotalsMap['Cost Of Services'][coModel.changeOrderRecord.Id], 2)}"/></td>
                                      <td class="footer footerRightJQ"></td>
                                    </tr>
                                  </table>
                                  <!-- General Change Order Notes -->
                                  <div style="display: {!IF(isThisUserCreator, 'block', 'none')};">
                                    <label class="labelTextBlock">General Change Order Notes:</label>
                                    <apex:inputField value="{!changeOrderInfo[coModel.changeOrderRecord.Id].General_Change_Order_Notes__c}" style="width: 99%; resize: none;" onchange="saveGeneralChangeOrderNotes( '{!coModel.changeOrderRecord.Id}', this.value );"/>
                                  </div>
                                  <div style="text-align: right;"><!--

                                    Assign Floors To Services
                                    --><div style="display: inline;">
                                      <apex:commandButton value="Assign Floors To Services" rendered="{!coModel.isFloorsVisible && proposal.Is_Floors_To_Services__c}" styleClass="milroseBtnStyle assignFloorsButton specialDisableJQ disableAccountingHold" disabled="true" onclick="assignServicesToFloors( '.changeOrdersTablesCanceledJQ #{!coModel.changeOrderRecord.Id}' ); return false;"/>
                                    </div><!--

                                    Move Services To Phase
                                    --><span>
                                      <apex:commandButton value="Move Services To Phase" rendered="{!coModel.showMoveServices && proposal.isPhase__c}" styleClass="milroseBtnStyle moveServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="moveServicesToPhase( ''.changeOrdersTablesCanceledJQ #{!coModel.changeOrderRecord.Id}' ); return false;"/>
                                    </span><!--

                                    Save Service bundle
                                    --><apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!coModel.showSaveServiceBundle}" disabled="{!coModel.serviceModels.size == 0 || !coModel.enableSaveServiceBundle || viewOnly}" value="Save Service Bundle" onclick="changeOrderId = '{!coModel.changeOrderRecord.Id}'; virtualChangeOrderName = ''; $('#saveServiceBundlePanelActionArea').css('display', 'block'); return false;"/>
                                  </div>
                                </div>
                                <script type="text/javascript">
                                  serviceParentCheckboxCheckJS( '.changeOrdersTablesCanceledJQ #{!coModel.changeOrderRecord.Id}' );
                                </script>
                              </apex:repeat>
                            </div>
                            <script type="text/javascript">
                              calculateTableColspans('.changeOrdersTablesCanceledJQ');
                              $("#accordionCanceled").accordion({
                                header: "span.accordionCanceledHeaderJQ",
                                autoHeight: false,
                                animated: false,
                                icons: false,
                                collapsible: true,
                                active: false
                              });
                            </script>
                          </div>
                        </div>
                      </div></div></div>

                      <!-- Alternative CO services table -->
                      <div class="apexp" style="display: {!IF(showAlternativeServicesTable && !proposal.is_Change_Order__c, 'block', 'none')};"> <!-- MRS 6931 -->
                        <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette" style="border-top: 2px solid #3887A8 !important; border-bottom: none !important;">
                          <div class="pbHeader">
                            <table border="0" cellpadding="0" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td class="pbTitle" style="width: 50%;">
                                    <h2 class="mainTitle">Alternative Services</h2>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          <div class="pbBody">
                            <div>
                              <table id="servicesTableAlt" class="generalTableStyle alternativeServicesJQ">
                                <thead>
                                  <tr class="nodrop nodrag">
                                    <th style="display: {!IF( ( pwm.alternativeChangeOrders[0].isRemoveVisible ) || ( proposal.isPhase__c && pwm.alternativeChangeOrders[0].isPhasesVisible ), 'table-cell', 'none')};">
                                      <apex:inputCheckbox styleClass="serviceCheckboxP specialDisableJQ disableAccountingHold" onclick="serviceParentCheckboxActionJS( '.alternativeServicesJQ' );" disabled="{!viewOnly}"/>
                                    </th>
                                    <th>Service Name</th>
                                    <th style="display: {!IF(proposal.isPhase__c && pwm.alternativeChangeOrders[0].isPhasesVisible, 'table-cell', 'none')};">Phase</th>
                                    <th style="display: {!IF(pwm.alternativeChangeOrders[0].isUnitOfServiceVisible, 'table-cell', 'none')};">Unit of<br/>Service</th>
                                    <th style="display: {!IF(pwm.alternativeChangeOrders[0].isQuantityVisible, 'table-cell', 'none')};">Quantity</th>
                                    <th style="display: {!IF(pwm.alternativeChangeOrders[0].isUnitPriceVisible, 'table-cell', 'none')}">Unit<br/>Price</th>
                                    <th style="display: {!IF(pwm.alternativeChangeOrders[0].isLastPriceVisible, 'table-cell', 'none')}">Last<br/>Proposed<br/>Price</th>
                                    <th style="display: {!IF(pwm.alternativeChangeOrders[0].isTotalPriceVisible, 'table-cell', 'none')}">Total<br/>Service<br/>Price</th>
                                    <th style="display: {!IF(pwm.alternativeChangeOrders[0].isRemoveVisible, 'table-cell', 'none')}">Del</th>
                                  </tr>
                                </thead>
                                <tbody id="{!alternativeChangeOrderKey}">
                                  <apex:repeat value="{!pwm.alternativeChangeOrders[0].serviceModels}" var="sm">
                                    <tr id="{!sm.recordId}" recordid="{!sm.recordId}" style="{!IF(sm.serviceItemRecord.Service_Group_Key__c != null,'background-color: #EDF3F6;','')}">
                                      <td class="data" style="display: {!IF( ( pwm.alternativeChangeOrders[0].isRemoveVisible ) || ( proposal.isPhase__c && pwm.alternativeChangeOrders[0].isPhasesVisible ), 'table-cell', 'none')};">
                                        <apex:inputCheckbox rendered="{!( !viewOnly && sm.isRemoveEditable ) || ( sm.isPhasesEditable && !sm.isAmendmendDeleted )}" value="{!sm.checked}" styleClass="serviceCheckboxes specialDisableJQ disableAccountingHold" onclick="serviceCheckboxActionJS( '#servicesTableAlt tbody' );" disabled="{!viewOnly}"/>
                                      </td>
                                      <td class="name dragHandle">
                                        <span style="display: inline; cursor: pointer;" onClick="window.open('/{!sm.serviceItemRecord.Id}', '_blank'); return false;">[#{!serviceInfo[sm.recordId].Service_Template__r.Service_Row_Number__c} - {!serviceInfo[sm.recordId].Name}]</span>
                                        {!serviceInfo[sm.recordId].Service_Name_Full__c}
                                      </td>
                                      <td class="data{!IF( sm.isPhasesEditable && !isAccountOrProjectOnHold, ' editablePhase', '' )}{!IF(sm.pendingPhaseSave, ' pending', '')}" style="display: {!IF(proposal.isPhase__c && pwm.alternativeChangeOrders[0].isPhasesVisible, 'table-cell', 'none')};" onclick="if( $(this).hasClass('editablePhase') ) { moveServicesToPhase( null, '{!sm.recordId}' ); }">
                                        {!phaseInfo[sm.phaseId].Name__c}
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.alternativeChangeOrders[0].isUnitOfServiceVisible, 'table-cell', 'none')};">
                                        {!sm.unitOfService}
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.alternativeChangeOrders[0].isQuantityVisible, 'table-cell', 'none')};">
                                        <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.quantityStr}" size="2" onfocus="this.priorValue = this.value;" onchange="changeQuantity( this.value, this.priorValue, '{!sm.recordId}', activeChangeOrderId, 'false', serializeServices() );" disabled="{!!sm.isQuantityEditable || ( !sm.isHourlyService && !sm.isQuantityEditableForSIPS ) || sm.isAmendmendDeleted || sm.isQuantityChangeOrder || ( proposal.is_Change_Order__c && pwm.notApprovedChangeOrders.size == 0 ) || viewOnly }" rendered="{!!sm.isQuantityChangeOrder}"/>
                                      </td>
                                      <td class="data {!IF(sm.isUnitPriceRequired, 'required', '')}" style="display: {!IF(pwm.alternativeChangeOrders[0].isUnitPriceVisible, 'table-cell', 'none')}">
                                        <div><div></div><div>
                                          <apex:inputText styleClass="tableInput specialDisableJQ disableAccountingHold" value="{!sm.servicePriceStr}" size="4" style="{!IF(sm.hasClientPrice, 'font-weight: bold; ', '')}" disabled="{!!sm.isUnitPriceEditable || viewOnly}" onChange="changeServiceUnitPrice('{!sm.recordId}');"/>
                                        </div></div>
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.alternativeChangeOrders[0].isLastPriceVisible, 'table-cell', 'none')}">
                                        <apex:outputLink styleClass="specialDisableJQ disableAccountingHold" rendered="{!!ISBLANK(sm.lastProposalPriceId)}" target="_blank" value="/{!sm.lastProposalId}">{!sm.lastProposalPrice}</apex:outputLink>
                                      </td>
                                      <td class="data" style="display: {!IF(pwm.alternativeChangeOrders[0].isTotalPriceVisible, 'table-cell', 'none')}">
                                        {!ROUND(sm.totalServicePrice, 2)}
                                      </td>
                                      <td style="display: {!IF(pwm.alternativeChangeOrders[0].isRemoveVisible, 'table-cell', 'none')}; text-align: center;">
                                        <div class="removeServiceButtonJQ">
                                          <div class="specialDisableJQ disableAccountingHold" style="cursor: pointer; display: {!IF( !viewOnly && !isAccountOrProjectOnHold && sm.isRemoveEditable, 'block', 'none')};" onclick="removeServiceModel('{!sm.recordId}', activeChangeOrderId, serializeServices());">
                                            <img src="/img/func_icons/remove12.gif" alt="Delete" title="Delete" class="deleteItemImage" onmouseover="this.src='/img/func_icons/remove12_on.gif'" onmouseout="this.src='/img/func_icons/remove12.gif'"/>
                                          </div>
                                        </div>
                                      </td>
                                    </tr>
                                  </apex:repeat>
                                </tbody>
                              </table>
                              <div style="text-align: right;">

                                <!-- Move Services to Service Table --> <!-- MRS 6931 -->
                                <span>
                                  <apex:commandButton value="Move To Services" rendered="{!pwm.alternativeChangeOrders[0].isMovableVisible}" styleClass="milroseBtnStyle movingServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="moveServiceBetweenTables( '.alternativeServicesJQ' ); return false;"/>
                                </span>

                                <!-- Delete Multiple Services -->
                                <span>
                                  <apex:commandButton value="Delete Services" rendered="{!pwm.alternativeChangeOrders[0].isRemoveVisible}" styleClass="milroseBtnStyle deleteServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="deleteServices( '.alternativeServicesJQ' ); return false;"/>
                                </span><!--

                                <!-- Move Services To Phase -->
                                <span>
                                  <apex:commandButton value="Move Services To Phase" rendered="{!( isAnyAllowedProfile || isThisUserAssignedSIPSUser || isChangeOrderAllowedOnProjectOrServiceItemLevel ) && proposal.isPhase__c}" styleClass="milroseBtnStyle moveServicesButton specialDisableJQ disableAccountingHold" disabled="true" onclick="moveServicesToPhase( '.alternativeServicesJQ' ); return false;"/>
                                </span>

                                <!-- Save Service Bundle -->
                                <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!pwm.alternativeChangeOrders[0].showAddNewService}" disabled="{!pwm.alternativeChangeOrders[0].serviceModels.size == 0 || !pwm.alternativeChangeOrders[0].enableAddNewService || viewOnly}" value="Save Service Bundle"
                                onclick="changeOrderId = ''; virtualChangeOrderName = 'Alternative'; $('#saveServiceBundlePanelActionArea').show(); return false;" id="saveServiceBundleButtonAlternative"/>

                                <!-- + Add New Service MRS 7335 -->
                                <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!pwm.alternativeChangeOrders[0].showAddNewService}" disabled="{!!pwm.alternativeChangeOrders[0].enableAddNewService || viewOnly}" value="+ Add New Service" onclick="changeRightPanelToServiceItem('Alternative', ''); return false;" />

                                <!-- Manage Service Bundle -->
                                <apex:commandButton styleClass="milroseBtnStyle specialDisableJQ disableAccountingHold" rendered="{!pwm.alternativeChangeOrders[0].showAddNewService}" disabled="{!!pwm.alternativeChangeOrders[0].enableAddNewService || viewOnly}" value="Manage Service Bundle" onclick="changeOrderId = ''; virtualChangeOrderName = 'Alternative'; $('#loadServiceBundlePanelActionArea').show(); return false;"/>
                              </div>
                            </div>
                            <script type="text/javascript">
                              attachDndToTables( '.alternativeServicesJQ' );
                              serviceParentCheckboxCheckJS( '.alternativeServicesJQ' );
                            </script>
                          </div>
                        </div>
                      </div></div></div>
                      <script type="text/javascript">
                        disableInputsByStatus({!proposal.Primary_Client_is_Billing_Client__c},{!isAccountOrProjectOnHold});
                        $("#step3Block .multiSelectPicklistTable select").css('width', '200px');
                      </script>
                    </apex:outputPanel>
                  </apex:outputPanel>
                </div>

                <!-- step 4 -->
                <div style="display: {!IF(proposal.Step__c == 4, 'block', 'none')};" class="mainStyle" id="step4Block">
                  <apex:outputPanel id="step4" layout="block">

                    <div class="apexp"> <!-- Proposal Detail -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Proposal Detail</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Version -->
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Version__c" class="labelTextBlock">Version:</label>
                                    <apex:inputText value="{!proposalVersion}" styleClass="inputFieldStdDisabled" disabled="true" id="Version__c"/>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Status -->
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Status__c" class="labelTextBlock">Status:</label>
                                    <apex:inputText value="{!proposal.Status__c}" styleClass="inputFieldStdDisabled" disabled="true" id="Status__c"/>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Proposal Type -->
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Proposal_Type__c" class="labelTextBlock">Proposal Type:</label>
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <apex:selectList value="{!proposal.Proposal_Type__c}" size="1" styleClass="inputFieldExt disableAccountingHold" id="Proposal_Type__c" onchange="proposalTypeChangedJS();"> <!-- MRS 7335 -->
                                      <apex:selectOptions value="{!proposalTypes}"/>
                                    </apex:selectList>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Proposal Expiration Date -->
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Proposal_Expiration_Date__c" class="labelText">Proposal Expiration Date:</label>
                                    <div class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    <div class="inputDateTimeFieldWrapper">
                                      <apex:inputField rendered="{!isPS || isAM || isAdmin}" value="{!proposal.Proposal_Expiration_Date__c}" styleClass="inputDateField disableAccountingHold" onchange="recalculateCompleteness();" id="Proposal_Expiration_Date__c"/>
                                      <apex:inputText id="TextProposal_Expiration_Date__c" disabled="true" rendered="{!!(isPS || isAM || isAdmin)}" value="{!proposalExpirationDate}" styleClass="inputDateField"/> <!-- MRS 7369 -->
                                    </div>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Proposal Awarded Date -->
                                  <div style="display: {!IF(showProposalAwardedDate, 'block', 'none')};">
                                    <label class="labelText">Proposal Awarded Date:</label>
                                    <div class="inputDateTimeFieldWrapper">
                                      <apex:inputField styleClass="disableAccountingHold" value="{!Proposal__c.Proposal_Awarded_Date__c}"/>
                                    </div>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Empty -->
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell" colspan="3"> <!-- RFP Attachments -->
                                  <apex:outputPanel layout="block" id="documentAttachments" style="display: {!IF(proposal.Proposal_Type__c == 'RFP', 'block', 'none')};">
                                    <label for="ProposalWizardPage:theForm:RFP_Attachments__c" class="labelTextBlock">RFP Attachments:</label>
                                    <table class="generalTableStyle">
                                      <tr>
                                        <th colspan="3">Attach Document(s)</th>
                                      </tr>
                                      <tr>
                                        <td colspan="3" style="padding: 0px; margin: 0px;">
                                          <div style="max-height: 200px; overflow:auto; width: 100%; margin:0px;">
                                            <table style="width:100%; padding: 0px; margin: 0px; border-collapse: collapse; border: none;">
                                              <tr>
                                                <th style="border-top: none; border-left: none;"><img src="/img/func_icons/util/checkmark16.gif"/></th>
                                                <th style="border-top: none;">Document Name</th>
                                                <th style="border-top: none; border-right: none;">Description</th>
                                              </tr>
                                              <apex:repeat value="{!pwm.documentWrapperList}" var="documentItem">
                                                <tr>
                                                  <td style="width: 20px; border-left: none; border-bottom: none;">
                                                    <apex:inputCheckbox value="{!documentItem.isAttached}" id="documentItemRow" onclick="updateAttachedDocuments();" />
                                                  </td>
                                                  <td style="border-bottom: none;">
                                                    <apex:outputLink target="_blank" value="/servlet/servlet.FileDownload?file={!documentItem.documentId}">{!documentInfo[documentItem.documentId].Name}</apex:outputLink>
                                                  </td>
                                                  <td style="border-right: none; border-bottom: none;">
                                                    <span>{!documentInfo[documentItem.documentId].Description}</span>
                                                  </td>
                                                </tr>
                                              </apex:repeat>
                                            </table>
                                          </div>
                                        </td>
                                      </tr>
                                    </table>
                                  </apex:outputPanel>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell" colspan="3"> <!-- Drawloop Attachments -->
                                  <div>
                                    <apex:inputCheckbox styleClass="specialDisableJQ" id="Additional_Documents__c" value="{!proposal.Additional_Documents__c}" onchange="createDeleteAdditionalDocumentsFolder();"/>
                                    <label for="ProposalWizardPage:theForm:Additional_Documents__c" class="labelText">Attach Additional Documents To Email</label>
                                    <apex:iframe scrolling="true" height="300" src="{!iFrameAdditionalDocumentsPageReference}" rendered="{!proposal.Additional_Documents__c}"/>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>

                    <div class="apexp recipientsBlock"> <!-- Recipients -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Recipients</h2>
                                </td>
                                <td class="pbTitle" style="width: 50%; text-align: right; font-size: 100%; display: {!IF(!isChangeOrder, 'table-cell', 'none')};">
                                  <apex:inputCheckbox styleClass="specialDisableJQ disableAccountingHold" id="Disable_Followups__c" value="{!proposal.Disable_Followups__c}" onchange="manageFollowups('');" disabled="{!!enableAutomaticFollowUps}"/>
                                  <label for="ProposalWizardPage:theForm:Disable_Followups__c" class="labelText">Shut Off Automatic Follow-Up</label>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell" colspan="3">
                                  <apex:outputPanel id="recipientsPanel">
                                    <table class="generalTableStyle">
                                      <thead>
                                        <tr>
                                          <th title="Approver" class="approverColumn approverColumnHeader">A</th>
                                          <th title="Recipient (Signer)" class="signerColumn signerColumnHeader">To</th>
                                          <th title="Carbon Copy">Cc</th>
                                          <th>Type</th>
                                          <th>Full Name</th>
                                          <th>DND</th> <!-- MRS 7237 -->
                                          <th>Email</th>
                                          <th>Address</th>
                                          <th>Send Reminder<br/>to Recipient on</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <apex:repeat value="{!pwr.rosters}" var="roster">
                                          <tr style="display: {!IF(roster.isActive, 'table-row', 'none')};">
                                            <td class="approverColumn approverColumnData" style="text-align: center;">
                                              <apex:inputCheckbox styleClass="specialDisableJQ disableAccountingHold" disabled="{!((disableInputs && (proposal.Status__c != 'Awarded') && (proposal.Status__c != 'Pending Client Approval')) || viewOnly) && !(proposal.is_Change_Order__c && (isPS || isAdmin)) || roster.record.Contact__c == null || roster.notAvaliableForToOrAOrS}" value="{!roster.record.Approver__c}" onclick="if( this.checked ) { $( '.approverColumnData input[type=checkbox]' ).not( $(this) ).removeAttr('checked'); }"/> <!-- MRS 7465 -->
                                            </td>
                                            <td class="signerColumn signerColumnData" style="text-align: center;">
                                                <apex:inputCheckbox styleClass="specialDisableJQ disableAccountingHold " disabled="{!((disableInputs && (proposal.Status__c != 'Awarded') && (proposal.Status__c != 'Pending Client Approval')) || viewOnly) && !(proposal.is_Change_Order__c && (isPS || isAdmin)) || roster.record.Contact__c == null || roster.notAvaliableForToOrAOrS}" value="{!roster.record.To__c}" onclick="if( this.checked ) { $( '.signerColumnData input[type=checkbox]' ).not( $(this) ).removeAttr('checked'); } disableSendToClientIfESignAndNoSigners();"/> <!-- MRS 7180 --> <!-- MRS 7465 -->
                                            </td>
                                            <td style="text-align: center;">
                                              <apex:inputCheckbox styleClass="specialDisableJQ disableAccountingHold" disabled="{!((disableInputs && (proposal.Status__c != 'Awarded') && (proposal.Status__c != 'Pending Client Approval')) || viewOnly) && !(proposal.is_Change_Order__c && (isPS || isAdmin))}" value="{!roster.record.Cc__c}"/>
                                            </td>
                                            <td>{!roster.record.Role__c}</td>
                                            <td><a href="/{!IF(roster.record.User__c == null, roster.contact.Id, roster.record.User__c)}" target="_blank">{!roster.contactName}</a></td>
                                            <td width="1%" style="text-align: center;"> <!-- MRS 7237 -->
                                                <input type="checkbox" disabled="disabled" checked="checked" style="display: {!IF(roster.isContact && roster.dnd, 'inline-block', 'none')};"/>
                                                <input type="checkbox" disabled="disabled" style="display: {!IF(roster.isContact && !roster.dnd, 'inline-block', 'none')};"/>
                                            </td>
                                            <td>{!roster.email}</td>
                                            <td>{!roster.contact.MailingStreet}</td>
                                            <td style="text-align: center;" class="sendReminderToRecipientDateFieldJQ">
                                              <apex:inputField value="{!roster.record.Send_Reminder__c}" styleClass="inputDateField specialDisableJQ disableAccountingHold"/>
                                            </td>
                                          </tr>
                                        </apex:repeat>
                                      </tbody>
                                    </table>
                                    <script>
                                      modifySendReminderToRecipientEditability( {!proposal.UseDocusign__c} );
                                    </script>
                                  </apex:outputPanel>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>

                    <div class="apexp"> <!-- Review and Send -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Review and Send</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Internal Reviewer Required -->
                                  <div>
                                    <apex:inputField value="{!proposal.Partner_Approval_Required__c}" id="Partner_Approval_Required__c" styleClass="disableAccountingHold" onchange="if($('[id$=partnerApprovalRequired').css('display') == 'block') { $('[id$=partnerApprovalRequired').css('display', 'none'); } else { $('[id$=partnerApprovalRequired').css('display', 'block'); } recalculateCompleteness();"> <!-- MRS 7112 -->
                                      <!-- <apex:actionSupport event="onclick" reRender="internalReviewerPanel, footer" /> MRS 7112 --> 
                                    </apex:inputField>
                                    <label for="ProposalWizardPage:theForm:Partner_Approval_Required__c" class="checkboxLabelText">Internal Reviewer Required</label>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell">
                                  <div>
                                    <apex:inputCheckbox value="{!proposal.UseDocusign__c}" id="UseDocusign__c" styleClass="specialDisableJQ disableAccountingHold" disabled="{!!isUseDocusignEditable}" onchange="useDocusign = this.checked == true; modifySendReminderToRecipientEditability( useDocusign ); disableSendToClientIfESignAndNoSigners();"/> <!-- MRS 7180 -->
                                    <label for="ProposalWizardPage:theForm:UseDocusign__c" class="checkboxLabelText">Send via eSignature</label>
                                    <script>
                                      useDocusign = {!proposal.UseDocusign__c};
                                    </script>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Internal Reviewer -->
                                  <div class="internalReviewerPanel">
                                    <label for="ProposalWizardPage:theForm:Internal_Reviewer__c" class="labelText">Internal Reviewer:</label>
                                    <apex:outputPanel id="internalReviewerPanel">
                                      <div id="partnerApprovalRequired" style="display: {!IF(proposal.Partner_Approval_Required__c, 'block', 'none')};" class="requiredBlockWrapper"><div class="requiredBlockMarker"></div></div>
                                    </apex:outputPanel>
                                    <apex:actionFunction name="internalReviewerChangeAction" reRender="completeness, footer"/> <!-- MRS 7335 -->
                                    <apex:inputField value="{!proposal.Internal_Reviewer__c}" styleClass="inputFieldStd disableAccountingHold" id="Internal_Reviewer__c" onfocus="internalReviewerText = this.value;" onblur="var $elem = $('[id$=Internal_Reviewer__c005_autoCompleteBoxId]'); if( $elem.length == 0 || ( $elem.eq(0).css('display') == 'none' && ( internalReviewerText == this.value || internalReviewerText == '' || this.value == '' ) ) ) { internalReviewerChangeAction(); }">
                                    </apex:inputField>
                                    <script type="text/javascript">
                                      $('div.internalReviewerPanel div.inputFieldStd select').hide();
                                    </script>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Internal Reviewer Reminder -->
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Internal_Reviewer_Reminder__c" style="display: block;" class="labelText">Internal Reviewer Reminder:</label>
                                    <apex:inputField value="{!proposal.Internal_Reviewer_Reminder__c}" id="Internal_Reviewer_Reminder__c" styleClass="disableAccountingHold"/>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <td class="dataCol dataCell"> <!-- Reminders for Proposal Creator -->
                                  <div>
                                    <label for="ProposalWizardPage:theForm:Send_Reminder_To_Creator__c" style="display: block;" class="labelText">Reminders for Proposal Creator:</label>
                                    <apex:inputField value="{!proposal.Send_Reminder_To_Creator__c}" styleClass="inputDateField disableAccountingHold" id="Send_Reminder_To_Creator__c"/>
                                  </div>
                                </td>
                                <td class="splitter"></td>
                                <td class="dataCol dataCell"> <!-- Empty -->
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>

                    <div class="apexp" style="display: {!IF(enableSendProposalPdf, 'block', 'none')};"> <!-- Preview PDF -->
                      <div class="individualPalette"><div class="Custom43Block"><div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette">
                        <div class="pbHeader">
                          <table border="0" cellpadding="0" cellspacing="0">
                            <tbody>
                              <tr>
                                <td class="pbTitle" style="width: 50%;">
                                  <h2 class="mainTitle">Preview PDF</h2>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="pbBody"><div class="pbSubsection">
                          <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                            <tbody>
                              <tr>
                                <td class="dataCol dataCell" colspan="3">
                                  <div style="padding: 0px;">
                                    <apex:commandButton value="Preview PDF" styleClass="specialDisableJQ" onclick="previewPdf(serializeServices(), serializePhases()); return false;" disabled="{!isPreviewPdfDisabled}" style="border: 2px solid #3887A8 !important;"/>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div></div>
                      </div></div></div>
                    </div>
                  </apex:outputpanel>
                </div>

              </apex:outputpanel>
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <!-- footer -->
            <apex:outputPanel id="footer">
              <div class="footer">
                <div class="footerInnerPadding">
                  <div class="footerButtonLeft">
                    <div class="footerTextPadding" style="color: #808080; cursor: default;">Information:</div>
                    <div class="checkboxLabelText" style="font-size: .9em; font-family: 'Arial','Helvetica',sans-serif; color: #808080; padding: 0px 5px 0px 6px;">
                      <div style="display: inline-block;">
                        <div style="cursor: default;">Proposal #:</div>
                        <div><a href="/{!IF(!ISBLANK(proposal.Id), proposal.Id, 'apex/ProposalWizard')}" target="_blank" style="color: #808080; cursor: pointer; text-decoration: none;">{!IF( isAdmin, IF(!ISBLANK(proposal.Id), LEFT(proposal.Id, 15), 'New Proposal'), IF(!ISBLANK(proposal.Id), Proposal.Name, 'New Proposal') )}</a></div>
                      </div>
                      <div style="display: {!IF(!ISBLANK(proposal.Mi3_MRC__c), 'inline-block', 'none')}; padding-left: 3px;">
                        <div style="cursor: default;">Mi3 MRC#</div>
                        <div><span style="color: #808080; cursor: pointer; text-decoration: none;">{!proposal.Mi3_MRC__c}</span></div>
                      </div>
                      <div style="display: {!IF(!ISBLANK(proposal.Project_Profile__c), 'inline-block', 'none')}; padding-left: 3px;">
                        <div style="cursor: default;">WAVE MRC#:</div>
                        <div><a href="/{!IF(!ISBLANK(proposal.Project_Profile__c), proposal.Project_Profile__c, 'apex/ProposalWizard')}" target="_blank" style="color: #808080; cursor: pointer; text-decoration: none;">{!IF(isAdmin,IF(!ISBLANK(proposal.Project_Profile__c),LEFT(proposal.Project_Profile__c, 15), ''),IF(!ISBLANK(proposal.Project_Profile__r.Name),proposal.Project_Profile__r.Name,''))}</a></div>
                      </div>
                    </div>
                  </div>
                  <div class="footerButtonLeft" style="display: {!IF(isAdmin, 'block', 'none')};">
                    <div class="footerTextPadding" style="color: #808080; cursor: default;">Admin Tools:</div>
                    <div class="checkboxLabelText" style="cursor: default; font-size: .9em; font-family: 'Arial','Helvetica',sans-serif; color: #808080; padding: 0px 5px 0px 6px;">
                      <div style="display: inline-block; vertical-align: top; cursor: default;">
                        <div style="cursor: default;">View State:</div>
                        <div>
                          <span style="cursor: default;" id="viewState"></span>
                          <span style="cursor: pointer;" onclick="getViewState();">&#8634;</span>
                        </div>
                      </div>
                      <div style="display: inline-block; vertical-align: top; cursor: default; padding-left: 3px;">
                        <div id="viewStatePercentage" style="cursor: default; height: 24px; width: 30px; vertical-align: middle; text-align: center; display: table-cell; border: 1px solid #CCC;"></div>
                        <script> getViewState(); </script> <!-- MRS 7280 -->
                      </div>
                    </div>
                  </div>


                  <div class="footerButtonRight">
                    <div style="{!$Label.CopyRightInfoStyle}">{!$Label.CopyrightInfo}</div>
                    <div class="footerTextPadding">Actions:</div>
                    <div style="display: inline-block;">
                      <apex:commandButton value="Close" action="{!close}" reRender="msgs"/>
                    </div><!--

                    Save Notes
                    --><div style="display: inline-block;">
                      <apex:commandButton value="Save Notes" onclick="saveNotes( serializeServices(), serializePhases(), currentStep ); return false;"/>
                    </div><!--

                    Save Draft
                    --><div style="display: {!IF(isSaveDraftButtonVisible, 'inline-block', 'none' )};"> <!-- MRS 6915 -->
                      <apex:commandButton value="Save Draft" onclick="saveDraft(serializeServices(), serializePhases(), currentStep, false, getFormPosition(), getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr()); return false;" reRender="footer, header, mainform, msgs" disabled="{!viewOnly}"/>
                    </div><!--

                    Save
                    --><div style="display: {!IF(isSaveButtonVisible, 'inline-block', 'none' )};"> <!-- MRS 6915 -->
                      <apex:commandButton value="Save" onclick="completeProposal(serializeServices(), serializePhases(), currentStep, true, getFormPosition(), getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr()); return false;" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || (proposal.is_Change_Order__c && !isMaxCompleteness)}"/>
                    </div><!--

                    Awarded (Assign Project Team)
                    --><div style="display: inline-block;">
                      <apex:commandButton id="assignProjectTeamButton" rendered="{!showAssignProjectTeamButton}" value="Assign" onclick="setProjectTeam( currentStep, getFormPosition() ); return false;" reRender="assignProjectTeamButton, step1, step4, msgs" disabled="{!ISBLANK(proposal.Project_Team__c) || !canAssignProjectTeam || isAccountOrProjectOnHold}"/>
                    </div><!--

                    In CZ Review (Assign CZ Analyst)
                    --><div style="display: inline-block;">
                      <apex:commandButton id="assignCZAnalystButton" rendered="{!canAssignCZAnalyst}" value="Assign" disabled="{!(ISBLANK(proposal.Code_Zoning_Analyst__c) && !canAssignCZAnalyst) || isAccountOrProjectOnHold}" onclick="assignCZAnalyst( getFormPosition() ); return false;"/>
                    </div><!--

                    In SIPS Review (Assign SIPS Coordinator)
                    --><div style="display: inline-block;">
                      <apex:commandButton id="assignSIPSCoordinatorButton" rendered="{!canAssignSIPSCoordinator}" value="Assign" disabled="{!ISBLANK(proposal.SIPS_Coordinator__c) || !canAssignSIPSCoordinator || isAccountOrProjectOnHold}" action="{!assignSIPSCoordinator}" reRender="assignSIPSCoordinatorButton, addNewServiceOutputPanel, completeButton, completeSIPSButton, notesRightOutputPanel, msgs" status="overlay"/>
                    </div><!--

                    Complete MRS 7094
                    --><div style="display: {!IF(isCompleteButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton id="completeButton" value="Complete" onclick="changeProposalStatusAndSaveRowPositions( 'C&Z Scope Review Complete', serializeServices(), serializePhases(), false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || !isThisUserAssignedCZAnalyst || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Complete (by SIPS) MRS 7094
                    --><div style="display: {!IF(isThisUserAssignedSIPSUser, 'inline-block', 'none')};">
                      <apex:commandButton id="completeSIPSButton" value="Complete" onclick="changeProposalStatusAndSaveRowPositions( 'Passed Internal Review', serializeServices(), serializePhases(), true, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || !isThisUserAssignedSIPSUser || !isMaxCompleteness || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Send to Client MRS 7094
                    --><div style="display: inline-block;">
                      <div style="display: {!IF(isSendToClientButtonVisible && !isMi3, 'inline-block', 'none')};">
                        <apex:commandButton id="sendToClientProposal" value="Send to Client" onclick="showOverlay(); emailType = ''; sendToClientAndSaveRowPositions( 'Pending Client Approval', serializeServices(), serializePhases(), emailType, true, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" reRender="footer, header, mainform, msgs" disabled="{!proposal.Partner_Approval_Required__c || !isMaxCompleteness || viewOnly || isAccountOrProjectOnHold || eSignatureAndNoSigners}"/> <!-- MRS 7180 -->
                      </div>
                    </div><!--

                    Resend to Client
                    --><apex:outputPanel layout="block" style="display: inline-block;" id="reSendToClientButton">
                        <div style="display: {!IF(isReSendToClientButtonVisible, 'inline-block', 'none')};">
                            <apex:commandButton value="Resend to Client" onclick="showOverlay(); emailType = 'Email (Resend)'; changeOrderId = ''; reSendProposalPdf(emailType); return false;" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                        </div>
                    </apex:outputPanel><!--

                    Proposal Follow-Up
                    --><apex:outputPanel layout="block" style="display: inline-block;">
                        <div style="display: {!IF(isFollowUpButtonVisible && !isMi3, 'inline-block', 'none')};">
                            <apex:commandButton value="Proposal Follow-Up" onclick="showOverlay(); emailType = 'Email (Follow Up)'; changeOrderId = ''; reSendProposalPdf( emailType, currentStep , true); return false;" reRender="footer, header, mainform, msgs" disabled="{!isAccountOrProjectOnHold}"/> <!-- MRS 7406 -->
                        </div>
                    </apex:outputPanel><!--

                    Send for Internal Review  MRS 7094
                    --><div style="display: inline-block;">
                      <div style="display: {!IF(isSendForInternalReviewButtonVisible && !isMi3, 'inline-block', 'none')};">
                        <apex:commandButton value="Send for Internal Review" onclick="changeProposalStatusAndSaveRowPositions( 'In Internal Review', serializeServices(), serializePhases(), true, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="sendToInternalReviewerButton" reRender="footer, header, mainform, msgs" disabled="{!!proposal.Partner_Approval_Required__c || !isMaxCompleteness || viewOnly || isAccountOrProjectOnHold}"/>
                      </div>
                    </div><!--

                    Reject MRS-7094
                    --><div style="display: {!IF(isRejectButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Reject" onclick="changeProposalStatus( 'Failed Internal Review', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="reject" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || !isRejectButtonEnabled || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Approve MRS-7094
                    --><div style="display: {!IF(isApproveButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Approve" onclick="changeProposalStatus( 'Passed Internal Review', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="approved" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || !isApproveButtonEnabled || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Canceled MRS-7094 MRS 6835
                    --><div style="display: {!IF(isCanceledButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Canceled" onclick="changeProposalStatus( 'Canceled', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="canceled" reRender="reasonInputNotificationPanel, footer, header, mainform, msgs" disabled="{!viewOnly || hasNoID || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Rejected With Notes MRS-7094
                    --><div style="display: {!IF(isRejectedWithNotesButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Rejected With Notes" onclick="changeProposalStatus( 'Rejected', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="rejectedwithnotes" reRender="reasonInputNotificationPanel, footer, header, mainform, msgs" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Withdrawn MRS-7094 MRS 6835
                    --><div style="display: {!IF(isWithdrawnButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Withdrawn" onclick="changeProposalStatus( 'Withdrawn', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="withdrawn" reRender="reasonInputNotificationPanel, footer, header, mainform, msgs" disabled="{!viewOnly || hasNoID}"/>
                    </div><!--

                    Not Awarded MRS-7094
                    --><div style="display: {!IF(isNotAwardedButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Not Awarded" onclick="changeProposalStatus( 'Not Awarded', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="notAward" reRender="reasonInputNotificationPanel, footer, header, mainform, msgs" disabled="{!viewOnly || isAccountOrProjectOnHold}"/>
                    </div><!--

                    Awarded MRS-7094
                    --><div style="display: {!IF(isAwardedButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton value="Awarded" onclick="changeProposalStatus( 'Awarded', false, getFormPosition(), currentStep, getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() ); return false;" id="award" reRender="footer, header, mainform, msgs" disabled="{!viewOnly || isAccountOrProjectOnHold}" oncomplete="hideErrorMessages(); return false;"/>
                    </div><!--

                    Submit (for Step 2) MRS 7094
                    --><div style="display: {!IF(isSubmitButtonVisible && !isMi3, 'inline-block', 'none')};" id="submitButton">
                      <apex:commandButton onclick="setConfirmServicesTuneSubmit( getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() );" value="Submit" id="applyStep2" disabled="{!!isSubmitButtonEnabled || viewOnly || isAccountOrProjectOnHold}" reRender="none"/>
                    </div><script type="text/javascript">if( currentStep != 2 ) { $('#submitButton').hide(); }</script><!--

                    Send for C&Z Scope Review MRS-7094
                    --><div style="display: {!IF(isSendForCZScopingReviewButtonVisible, 'inline-block', 'none')};">
                      <apex:commandButton onclick="setConfirmServicesTune( getPrimCInstr(), getBillCInstr(), getAccCInstr(), getBuildInstr(), getBillInstr() );" disabled="{!!isSubmitButtonEnabled || viewOnly || isAccountOrProjectOnHold}" value="Send for C&Z Scope Review" id="applyCzStep2" reRender="none"/>
                    </div><!--

                    Create MI3 Project
                    --><div style="display: {!IF(isMi3 && !ISBLANK(proposal.Id) && proposal.Is_Draft__c && !proposal.Is_Mi3_Project_Created__c, 'inline-block', 'none')};">
                      <apex:commandButton value="Create Project" onclick="showOverlay(); createMI3Project( serializeServices(), serializePhases(), getFormPosition() ); return false;" reRender="" disabled="{!(canAssignProjectTeam && ISBLANK(proposal.Project_Team__c)) || !ISBLANK(proposal.Project_Profile__c) || !isMaxCompleteness || (!isPS && !isAdmin && !isPManager1 && !isPManager2)}"/>
                    </div>
                  </div>
                </div>
              </div>
            </apex:outputpanel>
          </td>
        </tr>
      </table>

      <!-- save service bundle panel -->
      <apex:outputpanel id="saveServiceBundlePanel">
        <div id="saveServiceBundlePanelActionArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Please enter the name of your service bundle and press save.</b></span>
            <br/><br/>
            <apex:inputText size="50" value="{!serviceBundleName}" styleClass="serviceBundleNameInput" onkeyup="if( $(this).val().length > 0 ) { $('#saveServiceBundleCommandButton input').removeAttr('disabled').addClass('btn').removeClass('btnDisabled'); } else { $('#saveServiceBundleCommandButton input').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn'); }"/>
            <br/><br/>
            <span id="saveServiceBundleCommandButton">
              <apex:commandButton disabled="true" Id="saveServiceBundleBtn" value="Save" onclick="saveServiceBundleAction(serializeServices(), changeOrderId, virtualChangeOrderName); $('#saveServiceBundlePanelActionArea').css('display', 'none'); $('.serviceBundleNameInput').val(''); $(this).attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn'); return false;"/>
            </span>
            <apex:commandButton style="display: inline-block;" value="Cancel" onclick="$('#saveServiceBundlePanelActionArea').css('display', 'none'); $('.serviceBundleNameInput').val(''); $('#saveServiceBundleCommandButton input').attr('disabled', 'disabled').addClass('btnDisabled').removeClass('btn'); return false;"/>
          </div></div></div>
        </div>
      </apex:outputPanel>

      <!-- load service bundle panel -->
      <apex:outputpanel id="loadServiceBundlePanel">
        <div id="loadServiceBundlePanelActionArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Please select the desired Service Bundle.</b></span>
            <br/><br/>
            <apex:selectList value="{!serviceBundleChosen}" size="10" style="width: 470px;" id="serviceBundleSelectList">
              <apex:selectOptions value="{!serviceBundlesToChoose}"/>
            </apex:selectList>
            <br/><br/>
            <span id="loadServiceBundleCommandButton">
              <apex:commandButton Id="loadServiceBundleBtn" value="Insert" onclick="loadServiceBundleAction(serializeServices(), serializePhases(), changeOrderId, virtualChangeOrderName); $('#loadServiceBundlePanelActionArea').css('display', 'none'); return false;" disabled="{!serviceBundlesToChoose.size == 0}"/>
            </span>
            <span id="deleteServiceBundleCommandButton">
              <apex:commandButton Id="deleteServiceBundleBtn" value="Delete" onclick="makeRerender(); return false;" disabled="{!serviceBundlesToChoose.size == 0}"/>
            </span>
            <apex:commandButton style="display: inline-block;" value="Cancel" onclick="$('#loadServiceBundlePanelActionArea').css('display', 'none'); return false;"/>
          </div></div></div>
        </div>
        <script type="text/javascript">
        $("[id$=serviceBundleSelectList] option").each(function() { $(this).attr("title", this.text); });
        </script>
      </apex:outputPanel>

      <!-- delete service bundle panel -->
      <span>
        <div id="deleteServiceBundlePanelActionArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Are you sure you want to delete selected bundle?</b></span>
            <br/><br/>
            <apex:commandButton Id="deleteForSureServiceBundleBtn" style="display: inline-block;" value="Delete" onclick="deleteServiceBundleAction(serializeServices(), changeOrderId); $('#deleteServiceBundlePanelActionArea').css('display', 'none'); return false;" />
            <apex:commandButton style="display: inline-block;" value="Cancel" onclick="$('#deleteServiceBundlePanelActionArea').css('display', 'none'); return false;"/>
          </div></div></div>
        </div>
      </span>

      <span>
        <div id="cannotDeleteServiceBundlePanelActionArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Chosen Bundle cannot be deleted. This is read only bundle.</b></span>
            <br/><br/>
            <apex:commandButton style="display: inline-block;" value="Ok" onclick="$('#cannotDeleteServiceBundlePanelActionArea').css('display', 'none'); return false;"/>
          </div></div></div>
        </div>
      </span>

      <!-- Confirm Send CO to client -->
      <span>
        <div id="confirmSendToClientCOPanelArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Have you checked the recipients of the Email on Step 4?</b></span>
            <br/><br/>
            <apex:outputPanel >
              <div style="margin-bottom: 15px;">
                <label for="ProposalWizardPage:theForm:Reminder_for_Creator__c" class="labelText">Reminder for Change Order Creator:</label>
                <apex:inputField value="{!pwm.dummyChangeOrder.Reminder_for_Creator__c}" styleClass="coReminderInput Reminder_for_Creator__c" id="Reminder_for_Creator__c" onclick="correctDateField();"/>
              </div>
            </apex:outputPanel>
            <div style="display: table; width: 100%;">
              <div id="changeOrderDocTypeWrapper" style="display: table-cell; padding-bottom: 10px;">
                <label for="automaticFollowUp" class="labelText">Document type:</label>
                <input type="radio" name="changeOrderDocType" id="changeOrderLightDocType" checked="checked"><label for="changeOrderLightDocType" class="labelText">Light</label></input>
                <input type="radio" name="changeOrderDocType" id="changeOrderFullDocType"><label for="changeOrderFullDocType" class="labelText">Full</label></input>
              </div>
              <div id="automaticFollowUpWrapper" style="display: table-cell; padding-bottom: 10px;">
                <input type="checkbox" id="automaticFollowUp" defaultValue="false"/>
                <label for="automaticFollowUp" class="labelText">Shut Off Automatic Follow-Up</label>
              </div>
            </div>
            <apex:commandButton style="display: inline-block;" value="Yes. Send" onclick="$('#confirmSendToClientCOPanelArea').hide(); showOverlay(); sendToClientAndChangeCOStatus( changeOrderId, 'Pending Client Approval', serializeServices(), serializePhases(), emailType, true, $('#automaticFollowUp').prop('checked'), $('#changeOrderLightDocType').attr( 'checked' ) == 'checked' ); $('[id$=Reminder_for_Creator__c]').val(''); return false;"/>
            <apex:commandButton style="display: inline-block;" value="Go to Step 4" onclick="$('#confirmSendToClientCOPanelArea').hide(); goToStep(4); $('[id$=Reminder_for_Creator__c]').val(''); return false;"/>
          </div></div></div>
        </div>
        <script>
          function correctDateField() {
            DatePicker.prototype.position = function() {
              $('div.datePicker').css('top', $('[id$=Reminder_for_Creator__c]').offset().top - 87);
              $('div.datePicker').css('left', $('[id$=Reminder_for_Creator__c]').offset().left - 9);
            }
          }
        </script>
      </span>

      <!-- Assign floors for services panel -->
      <apex:outputpanel id="selectFloorsForServicesPanel">
        <div id="selectFloorsForServicesArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Please choose floors that will be associated with this service:</b></span>
            <br/><br/>
            <table id="selectFloorsForServices" class="generalTableStyle">
              <tr>
                <th>Construction Floor Type</th>
                <th>Construction Floor #</th>
              </tr>
              <apex:repeat var="floor" value="{!FloorWrapperList}">
                <tr id="{!floor.floorId}" class="floorNotSelected" style='border: 1px solid #8AE; padding: 3px;' onclick="if( $(this).hasClass('floorPartial') ) { $(this).removeClass('floorPartial'); $(this).addClass('wasPartial'); } else if( $(this).hasClass('floorSelected') ) { $(this).removeClass('floorSelected'); if( $(this).hasClass('wasPartial') ) { $(this).removeClass('wasPartial'); $(this).addClass('floorPartial'); } } else { $(this).addClass('floorSelected'); }">
                  <td style='padding: 3px;'>{!floor.floorType}</td>
                  <td style='padding: 3px;'>{!floor.specificationName}</td>
                </tr>
              </apex:repeat>
            </table>
            <br/>
            <span id="selectFloorsForServicesCommandButton">
              <apex:commandButton Id="selectFloorsForServicesBtn" value="OK" onclick="selectFloorsForServices(); return false;" rerender=""/>
            </span>
            <apex:commandButton style="display: inline-block;" value="Cancel" onclick="$('#selectFloorsForServicesArea').hide(); return false;" reRender=""/>
          </div></div></div>
        </div>
      </apex:outputPanel>

      <!-- Remove reimbursables panel -->
      <span>
        <div id="removeReimbursableActionArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Do you really want to remove this Reimbursable?</b></span>
            <br/><br/>
            <apex:commandButton styleClass="disableAccountingHold" value="Yes" onclick="deleteReimbursableAction( reimbursableIdToRemove ); $('#removeReimbursableActionArea').hide(); return false;" reRender=""/>
            <apex:commandButton style="display: inline-block;" value="No" onclick="$('#removeReimbursableActionArea').hide(); return false;" reRender=""/>
          </div></div></div>
        </div>
      </span>

      <!-- remove floors panel -->
      <span>
        <div id="removeFloorActionArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>Do you really want to remove this Floor?</b></span>
            <br/><br/>
            <span id="removeFloorCommandButton">
              <apex:commandButton Id="removeFloorBtn" value="Yes" onclick="removeFloorAction( floorIdToRemove ); floorIdToRemove = ''; $('#removeFloorActionArea').hide(); return false;" oncomplete="recalculateCompleteness();" rerender="footer"/>
            </span>
            <apex:commandButton style="display: inline-block;" value="No" onclick="floorIdToRemove = ''; $('#removeFloorActionArea').hide(); return false;" reRender=""/>
          </div></div></div>
        </div>
      </span>

      <!-- move services to different phases -->
      <apex:outputpanel id="moveServicesToPhasesPanel">
        <div id="moveServicesToPhasesPanelArea" class="popupDialog" style="display: none;">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div style="width: 610px;"><div>
            <div style="display: block">
              <span><b>Please choose the phase you want to move services to.</b></span>
              <br/><br/>
              <apex:selectList value="{!chosenPhase}" multiselect="false" size="{!IF(phaseSelectOption.size > 25, 25, phaseSelectOption.size)}" style="margin: 5px 0px 0px 0px; width: 100%;">
                <apex:selectOptions value="{!phaseSelectOption}"/>
              </apex:selectList>
            </div>
            <br/><br/>
            <apex:commandButton value="Apply" style="display: inline-block;" onclick="$('#moveServicesToPhasesPanelArea').hide(); if( isSingleServiceForPhase ) { moveServiceToPhaseAction( serviceIdsForMoveToPhase, serializeServices() ); } else { moveServicesToPhaseAction( serviceIdsForMoveToPhase, serializeServices() ); } return false;"/>
            <apex:commandButton value="Cancel" style="display: inline-block;" onclick="$('#moveServicesToPhasesPanelArea').hide(); return false;"/>
          </div></div></div>
        </div>
      </apex:outputPanel>

      <!-- notification about a need to enter notes -->
      <apex:outputpanel id="reasonInputNotificationPanel">
        <div id="reasonInputNotificationPanelArea" class="popupDialog" style="display: {!IF(rejectionReasonPanelView, 'block', 'none')};">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <div style="display: block">
              <span><b>You have to enter notes to proceed.</b></span>
              <div style="display: {!IF( ISBLANK(proposal.sowScopeOfWork__c) || (isCZSpesialistRequired && ISBLANK(noteBody)) || ISBLANK(proposal.Address__c) || ISBLANK(proposal.Billing_Company_Name__c) || FloorWrapperList.size == 0 || ISBLANK(proposal.Expected_Construction_Start_Date__c), 'block' ,'none')};">
              <br/><br/>
                <div class="message errorM3">
                  <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                    <tr valign="top">
                      <td><img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/></td>
                      <td class="messageCell">
                        <div class="messageText" style="text-align:left;">
                          <div style="display: block;">
                            <ul style="padding-left: 0px;">
                              <li>
                                <span>{!IF(ISBLANK(rejectionReasonMessageNotification), 'You cannot proceed until providing notes on this project in the Proposal Notes section.', rejectionReasonMessageNotification)}</span>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
            <br/><br/>
            <apex:commandButton style="display: inline-block;" value="OK" onclick="$('#reasonInputNotificationPanelArea').hide(); return false;" />
          </div></div></div>
        </div>
      </apex:outputPanel>

      <!-- Set Change Order Internal Reviewer Pannel -->
      <span style="display: none;" class="changeOrderInternalReviewerPanel">
        <div id="changeOrderInternalReviewerPanelArea" class="popupDialog">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <div style="display: block">
              <span><b>Please Select Internal Reviewer for Current Change Order:</b></span>
            </div>
            <apex:outputPanel id="changeOrderInternalReviewerData">
              <div style="margin-top: 15px;">
                <label for="ProposalWizardPage:theForm:CO_Internal_Reviewer__c" class="labelText">Internal Reviewer:</label>
                <div style="display:block; float: left; top: 15px; left: 140px;" class="requiredBlockWrapper"><div class="requiredBlockMarker" style="left: -2px; top: 1px;"></div></div>
                <apex:inputField value="{!pwm.dummyChangeOrder.Internal_Reviewer__c}" styleClass="coReminderInput disableAccountingHold" id="CO_Internal_Reviewer__c" onblur="if( $(this).prop('tagName').toLowerCase() == 'input' ) { disableSubmitCOReviewer( $(this).val().length == 0 ); }" onkeyup="if( $(this).prop('tagName').toLowerCase() == 'input' ){ disableSubmitCOReviewer( $(this).val().length == 0 ); }"/>
              </div>
              <div style="margin-top: 15px;">
                <label for="ProposalWizardPage:theForm:CO_Internal_Reviewer_Reminder__c" style="display: block;" class="labelText">Internal Reviewer Reminder:</label>
                <apex:inputField value="{!pwm.dummyChangeOrder.Internal_Reviewer_Reminder__c}" id="CO_Internal_Reviewer_Reminder__c" styleClass="CO_Internal_Reviewer_Reminder__c"/>
              </div>
              <script type="text/javascript">
                $('.changeOrderInternalReviewerPanel div.coReminderInput select').hide();
                disableSubmitCOReviewer( $('[id$=CO_Internal_Reviewer__c]').val().length == 0 );
              </script>
            </apex:outputPanel>
            <div style="margin-top: 15px;">
              <apex:commandButton value="Submit" onclick="changeCOStatus(activeChangeOrderId, 'In Internal Review', serializeServices(), serializePhases(), false); $('.changeOrderInternalReviewerPanel').hide(); rerenderChangeOrderInternalReviewerData(); return false;" styleClass="submitCOReviewerButton"/>
              <apex:commandButton style="display: inline-block;" value="Cancel" onclick="$('[id$=CO_Internal_Reviewer__c]').val(''); cancelChangeOrderInternalReviewer(); return false;"/>
              <script type="text/javascript">
                if( $('div.coReminderInput span.lookupInput input').length != 0 && $('div.coReminderInput span.lookupInput input').val().length == 0 ) {
                  $('.submitCOReviewerButton').attr('disabled', true).removeClass('btn').addClass('btnDisabled');
                } else {
                  $('.submitCOReviewerButton').removeAttr('disabled').removeClass('btnDisabled').addClass('btn');
                }
              </script>
            </div>
          </div>
        </div></div></div>
      </span>

      <!-- Confirmation of a CZ specialist request -->
      <apex:outputpanel id="confirmServiceTune">
        <div id="confirmServiceTuneInputArea" class="popupDialog" style="display: {!IF(confirmServiceTune, 'block', 'none')};">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <div style="display: block">
              <span style="font-weight: bold; display: {!IF(isCZSpesialistRequired || !proposal.Is_Draft__c, 'inline', 'none')};">This proposal will be sent to the C&amp;Z Specialist for determination of scope and selection of services. You will not be able to edit it until the C&amp;Z Specialist makes these changes.</span>
              <span style="font-weight: bold; display: {!IF(!(isCZSpesialistRequired || !proposal.Is_Draft__c), 'inline', 'none')};">You are about to apply your Scope of Work choices to the proposal.</span>
              <div style="display: {!IF( (proposal.Is_Draft__c && ISBLANK(proposal.sowScopeOfWork__c)) || (isCZSpesialistRequired && isNoteBodyEmpty) || ISBLANK(proposal.Address__c) || ISBLANK(proposal.Billing_Company_Name__c) || FloorWrapperList.size == 0 || ISBLANK(proposal.Expected_Construction_Start_Date__c), 'block', 'none')};">
                <br/><br/>
                <div class="message errorM3">
                  <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                    <tr valign="top">
                      <td><img alt="ERROR" class="msgIcon" src="/s.gif" title="ERROR"/></td>
                      <td class="messageCell">
                        <div class="messageText" style="text-align:left;">
                          <span style="color:#CC0000; display:inline-block; font-weight:bold;">Error:</span>
                          <div style="display: {!IF(proposal.Is_Draft__c && ISBLANK(proposal.sowScopeOfWork__c), 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>You have to choose an option in 'The scope of work involves' section to proceed further.</li></ul>
                          </div>
                          <div style="display: {!IF(ISBLANK(proposal.Billing_Company_Name__c), 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>Billing company should be chosen before applying settings. Please go to Step 1 and choose the Billing Company.</li></ul>
                          </div>
                          <div style="display: {!IF(ISBLANK(proposal.Address__c), 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>Most services depend on the building type. The building is not selected on the Step 1. Please do it.</li></ul>
                          </div>
                          <div style="display: {!IF( FloorWrapperList.size == 0, 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>Please add at least one floor on Step 1 to proceed further.</li></ul>
                          </div>
                          <div style="display: {!IF(ISBLANK(proposal.Expected_Construction_Start_Date__c), 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>Please set the Expected Construction Start Date on Step 1 before proceeding further.</li></ul>
                          </div>
                          <div style="display: {!IF(isCZSpesialistRequired && isNoteBodyEmpty && (( !ISBLANK(proposal.sowScopeOfWork__c) && !CONTAINS(proposal.sowScopeOfWork__c, 'HUB Project')) || !proposal.Is_Draft__c ), 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>You cannot proceed until providing notes on this project in the Proposal Notes section.</li></ul>
                          </div>
                          <div style="display: {!IF(isCZSpesialistRequired && isNoteBodyEmpty && !ISBLANK(proposal.sowScopeOfWork__c) && CONTAINS(proposal.sowScopeOfWork__c, 'HUB Project'), 'block', 'none')};">
                            <ul style="padding-left: 0px;"><li>You cannot proceed to the next step until providing notes on this HUB project in the Proposal Notes section.</li></ul>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
            <br/><br/>
            <apex:outputPanel id="confirmServiceTuneApplyButton" style="display: inline-block;">
              <apex:commandButton rendered="{!isCZSpesialistRequired || !proposal.Is_Draft__c}" disabled="{!!canUseSendToCZSpecialistButton || floorWrapperList.size == 0 || isAccountOrProjectOnHold}" Id="sendToCZSpecialistButton" value="Send for C&Z Scope Review" onclick="sendToCZSpecialist( currentStep, getFormPosition() ); return false;"/>
              <apex:commandButton rendered="{!( isCZSpesialistRequired || !proposal.Is_Draft__c) && !ISBLANK(proposal.sowScopeOfWork__c) && CONTAINS(proposal.sowScopeOfWork__c, 'New Building') && fromSubmitButton == true}" disabled="{!floorWrapperList.size == 0}" Id="skipCZSpecialistButton" value="Skip Sending" onclick="skipSendingToCZSpecialist( getFormPosition() ); return false;"/>
              <apex:commandButton rendered="{!!(isCZSpesialistRequired || !proposal.Is_Draft__c)}" disabled="{!!canUseCreateServicesButton || floorWrapperList.size == 0}" Id="createServicesButton" value="Confirm" onclick="populateServicesFromStepTwo( getFormPosition() ); return false;"/>
            </apex:outputPanel>
            <apex:commandButton style="display: inline-block;" value="Cancel" onclick="$('#confirmServiceTuneInputArea').hide(); return false;" />
          </div>
        </div></div></div>
      </apex:outputPanel>

      <!-- Confirmation of a quantity change -->
      <apex:outputpanel id="confirmQuantityChange">
        <div id="confirmQuantityChangeInputArea" class="popupDialog" style="display: {!IF(isConfirmationNeeded, 'block', 'none')};">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <div style="display: block">
              <span><b>Confirmation on quantity change needed</b></span>
              <div style="display: block;">
                <br/><br/>
                <div class="message infoM3">
                  <table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;">
                    <tr valign="top">
                      <td><img alt="INFO" class="msgIcon" src="/s.gif" title="INFO"/></td>
                      <td class="messageCell">
                        <div class="messageText" style="text-align:left;">
                          <span style="color:#0000CC; display:inline-block; font-weight:bold;">Note:</span>
                          <div>
                            <ul style="padding-left: 0px;"><li>Billings already exceed the new quantity for service #{!IF(serviceIdToChange != null, serviceInfo[serviceIdToChange].Name, '')}. Do you still want to continue?</li></ul>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
            <br/><br/>
            <apex:outputPanel id="confirmQuantityChangeApplyButton" style="display: inline-block;">
              <apex:commandButton value="Yes" action="{!changeQuantityApprove}" reRender="changeOrderTables, saveServiceBundleButton, completeness, footer, servicesManagementButtonsNotApproved, confirmQuantityChange" oncomplete="return false;" status="overlay"/>
              <apex:commandButton value="No" action="{!changeQuantityCancel}" reRender="changeOrderTables, saveServiceBundleButton, completeness, footer, servicesManagementButtonsNotApproved, confirmQuantityChange" oncomplete="return false;" status="overlay"/>
            </apex:outputPanel>
          </div>
        </div></div></div>
      </apex:outputPanel>

      <!-- Cannot send to client notification -->
      <apex:outputpanel id="cannotSendToClientPanel">
        <div id="cannotSendToClientArea" class="popupDialog" style="display: {!IF(showAdditionalToCcMessage, 'block', 'none')};">
          <div class="modalBackground"></div>
          <div class="modalForeground"><div><div>
            <span><b>You must select an External Contact to send the Proposal/CO to</b></span>
            <br/><br/>
            <apex:commandButton style="display: inline-block;" value="Got it" onclick=" $('#cannotSendToClientArea').hide(); return false;" reRender=""/>
          </div></div></div>
        </div>
      </apex:outputPanel>

      <!-- general message -->
      <div id="generalMessagePanel" class="popupDialog" style="display: none;">
        <div class="modalBackground"></div>
        <div class="modalForeground"><div><div>
          <span id="generalMessageText" style="font-weight: bold;"></span>
          <br/><br/>
          <input type="button" class="btn" style="display: inline-block;" value="OK" onclick="$('#generalMessagePanel').hide(); $('#generalMessageText').empty(); return false;"/>
        </div></div></div>
      </div>
    </div>
  </apex:form>
</apex:page>